.\" FRDP path ./usr.bin/units/units.1
.\" FRDP githash b2c76c41be32f904179efed29c0ca04d53f3996c
.\" FRDP hash256 f1767778eb06e168978a2a23ad970920bca1dc9566a9b9571f3de61c29090a18
.Dd 17 марта 2020
.Dt UNITS 1
.Os
.Sh ИМЯ
.Nm units
.Nd калькулятор преобразования единиц
.Sh СИНТАКСИС
.Nm
.Op Fl ehqtUVv
.Op Fl f Ar файл_единиц
.Op Fl o Ar формат
.Op Ar из в
.Sh ОПИСАНИЕ
Программа
.Nm
преобразует величины, выраженные в различных шкалах,
в их эквиваленты в других шкалах.
Она может обрабатывать только мультипликативные или аффинные изменения шкалы.
.Pp
.Nm
может работать интерактивно, запрашивая ввод у пользователя
.Pq см. раздел Sx ПРИМЕРЫ
или неинтерактивно, выполняя преобразование для заданных аргументов
.Ar из
и
.Ar в .
.Pp
Доступны следующие опции:
.It Fl e , Fl -exponential
То же, что
.Fl o
.Cm %6e
(см. описание флага
.Fl o ).
.It Fl f Ar файл_единиц , Fl -file Ar файл_единиц
Указать имя загружаемого файла данных с единицами.
Эту опцию можно указывать несколько раз.
.It Fl H Ar файл_истории , Fl -history Ar файл_истории
Игнорируется для совместимости с GNU units.
.It Fl h , Fl -help
Показать обзор опций.
.It Fl o Ar формат , Fl -output-format Ar формат
Выбрать строку формата вывода, по которой печатаются числа.
По умолчанию
.Dq Li %.8g .
.It Fl q , Fl -quiet
Отключить запросы пользователю о единицах и вывод статистики
о количестве загруженных единиц.
.It Fl t , Fl -terse
Печатать только результат.
Используется при вызове
.Nm
из других программ для удобного разбора результатов.
.It Fl U , Fl -unitsfile
Напечатать расположение файла единиц по умолчанию, если он существует.
В противном случае напечатать
.Dq Файл данных единиц не найден .
.It Fl V , Fl -version
Напечатать номер версии
.Pq который фиксирован как Dq Fx units ,
путь к файлу данных единиц и выйти.
.It Fl v , Fl -verbose
Печатать единицы в выводе преобразования.
Быть более подробным в целом.
.It Ar из в
Позволяет выполнить прямое преобразование единиц из командной строки.
Программа не будет выводить подсказки.
Она выведет результат указанного преобразования.
Оба аргумента, т.е.
.Ar из
и
.Ar в ,
могут быть просто единицей
.Pq например, Dq Cm см ,
величиной
.Pq например, Dq Cm 42 ,
или величиной с единицей
.Pq например, Dq Cm 42 см
.El
.Ss Математические операторы
.Bl -dash -compact
.It
Степени единиц можно указывать с помощью символа
.Dq Ic ^
, как показано в примере, или простым объединением:
.Dq Ic см3
эквивалентно
.Dq Ic см^3 .
См. раздел
.Sx ИЗВЕСТНЫЕ ОШИБКИ
для подробностей об ограничениях значений показателей степени.
.It
Умножение единиц можно указывать с помощью пробелов,
тире
.Pq Dq -
или звёздочки
.Pq Dq * .
.It
Деление единиц обозначается косой чертой
.Pq Dq Ic / .
.It
Деление чисел
должно указываться с помощью вертикальной черты
.Pq Dq Ic \&| Ns .
.El
.Pp
Обратите внимание, что умножение имеет более высокий приоритет, чем деление,
поэтому
.Dq Ic м/с/с
это то же самое, что
.Dq Ic м/с^2
или
.Dq Ic м/с с .
.Ss Единицы
Информация о преобразовании считывается из файла данных единиц.
Файл по умолчанию включает определения наиболее распространённых единиц,
сокращений и метрических префиксов.
Некоторые включённые константы природы:
.Pp
.El
.Pp
Единица
.Dq Ic фунт
— это единица массы.
Составные названия пишутся слитно,
поэтому
.Dq Ic фунт-сила
— это единица силы.
Единица
.Dq Ic унция
также является единицей массы.
Жидкая унция —
.Dq Ic жидкая_унция .
Британские единицы, отличающиеся от
американских аналогов, имеют префикс
.Dq бр ,
а валюты имеют префикс в виде названия страны:
.Dq Ic бельгийский_франк ,
.Dq Ic британский_фунт .
При поиске
единицы, если указанная строка не встречается в точности как имя
единицы, то
.Nm
попытается удалить завершающую
.Dq s
или
.Dq es
и проверить снова на совпадение.
.Ss Формат файла единиц
Чтобы узнать, какие единицы доступны, прочитайте стандартный файл единиц.
Если вы хотите добавить свои собственные единицы, вы можете предоставить
свой файл.
Единица задаётся в одной строке указанием
её имени и эквивалентности.
Будьте осторожны, определяя
новые единицы через старые, чтобы приведение приводило к
примитивным единицам, которые помечены символами
.Dq \&!
.
Программа
.Nm
не обнаружит бесконечных циклов, которые могут быть вызваны
неаккуратными определениями единиц.
Комментарии в файле определений единиц
начинаются с символа
.Dq #
или
.Dq /
в начале строки.
.Pp
Префиксы определяются так же, как стандартные единицы, но с
добавлением тире
.Pq Dq -
в конце имени префикса.
Если единица не найдена
даже после удаления завершающих
.Dq s
или
.Dq es ,
то она будет проверена по списку префиксов.
Префиксы будут удаляться до тех пор, пока не будет идентифицирована
базовая единица.
.Sh ОКРУЖЕНИЕ
.Bl -tag -width PATH
.It Ev PATH
Разделённый двоеточиями список корневых каталогов, в которых
.Nm
пытается найти
.Pa /usr/share/misc/definitions.units .
.Pp
Например, если
.Ev PATH
установлен в
.Dq Li /tmp:/:/usr/local ,
флаги
.Fl f
не предоставлены и файл
.Pa /usr/share/misc/definitions.units
отсутствует, то
.Nm
пытается открыть следующие файлы в качестве файла единиц по умолчанию:
.Pa /tmp/usr/share/misc/definitions.units ,
.Pa /usr/share/misc/definitions.units ,
и
.Pa /usr/local/usr/share/misc/definitions.units .
.El
.Sh FILES
.Bl -tag -width /usr/share/misc/definitions.units -compact
.It Pa /usr/share/misc/definitions.units
Стандартный файл единиц.
.El
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh ПРИМЕРЫ
.Bl -tag -width 0n
.It Sy Пример 1 : No Простое преобразование единиц
.Pp
Этот пример показывает, как выполнить простое преобразование, например, из гигабайтов
в байты:
.Bd -literal -offset 2n
.Li $ Ic units -o %0.f -t '4 гигабайта' байты
4294967296
.Ed
.Pp
Часть команды
.Fl o Cm %0.f
необходима для вывода результата в неэкспоненциальной
нотации (например, 4294967296 вместо 4.29497e+09).
.It Sy Пример 2 : No Интерактивное использование
.Pp
Вот пример интерактивного сеанса, где пользователю предлагается ввести
единицы:
.Bd -literal -offset 2n
.Li Вы имеете : Ic метров
.Li Вы хотите : Ic футов
        * 3.2808399
        / 0.3048

.Li Вы имеете : Ic см^3
.Li Вы хотите : Ic галлонов
        * 0.00026417205
        / 3785.4118

.Li Вы имеете : Ic метров/с
.Li Вы хотите : Ic фарлонгов/фортнайт
        * 6012.8848
        / 0.00016630952

.Li Вы имеете : Ic 1|2 дюйма
.Li Вы хотите : Ic см
        * 1.27
        / 0.78740157

.Li Вы имеете : Ic 85 градF
.Li Вы хотите : Ic градC
        29.444444
.Ed
.It Sy Пример 3 : No Разница между Do Ic \&| Dc No и Do Ic / Dc No делением
.Pp
Следующая команда показывает, как преобразовать полметра в сантиметры.
.Bd -literal -offset 2n
.Li $ Ic units '1|2 метр' см
        * 50
        / 0.02
.Ed
.Pp
.Nm
печатает ожидаемый результат, потому что был использован оператор деления для чисел
.Pq Dq Li \&| .
.Pp
Использование оператора деления для единиц
.Pq Dq Li /
приведёт к ошибке:
.Bd -literal -offset 2n
.Li $ Ic units '1/2 метр' см
ошибка соответствия единиц
        0.5 / м
        0.01 м
.Ed
.Pp
Это потому, что
.Nm
интерпретирует
.Dq Ic 1/2 метр
как
.Dq Ic 0.5/метр ,
что не соответствует
.Dq Ic см .
.It Sy Пример 4 : No Простой файл единиц
Вот пример короткого файла единиц, определяющего некоторые основные
единицы:
.Pp
.El
.It Sy Пример 5 : No Просмотр единиц и преобразований из файла единиц по умолчанию
Следующая однострочная команда оболочки позволяет пользователю просмотреть содержимое
файла единиц по умолчанию:
.Bd -literal -offset 2n
.Ed
.El
.Sh DIAGNOSTICS
.Bl -diag
.It не удаётся найти файл единиц '%s'
Файл единиц по умолчанию отсутствует в своём стандартном расположении
.Pq см. раздел Sx FILES
и не присутствует в каком-либо дереве файлов, начинающемся с корней в каталогах из
.Ev PATH
.Pq см. раздел Sx ОКРУЖЕНИЕ .
.It cap_rights_limit\&() не выполнена
См.
.Xr capsicum  4 .
.It ошибка соответствия единиц
Невозможно привести данные единицы к одной общей единице:
они не соответствуют.
Вместо преобразования
.Nm
отобразит приведённую форму для каждой предоставленной единицы:
.Bd -literal -offset 2n
.Li Вы имеете : Ic эрг/час
.Li Вы хотите : Ic фатомов кг^2 / день
ошибка соответствия единиц
        2.7777778e-11 кг м^2 / сек^3
        2.1166667e-05 кг^2 м / сек
.Ed
.It Не удалось инициализировать историю
См.
.Xr editline 3 .
.It dupstr
.Xr strdup 3
не выполнена.
.It память для префиксов превышена в строке %d
Определено более 100 префиксов.
.It память для единиц превышена в строке %d
Определено более 1000 префиксов.
.It переполнение памяти при приведении единиц
Запрошенное преобразование включает слишком много единиц
.Pq см. раздел Sx ИЗВЕСТНЫЕ ОШИБКИ .
.It переопределение префикса '%s' в строке %d проигнорировано
.It переопределение единицы '%s' в строке %d проигнорировано
.It неожиданный конец префикса в строке %d
.It неожиданный конец единицы в строке %d
.It Файл данных единиц не найден
Файл единиц по умолчанию отсутствует.
.It не удаётся войти в режим возможностей (capability mode)
См.
.Xr capsicum  4 .
.It не удаётся открыть файл единиц '%s'
Не удаётся открыть один из указанных пользователем файлов единиц.
.It единица приводится к нулю
.It неизвестная единица '%s'
Указанная единица не найдена в файле единиц.
.It ПРЕДУПРЕЖДЕНИЕ: преобразование непропорциональных величин.
.Nm
может не выполнить преобразование
.Ar из
в
.Ar в ,
потому что единицы не пропорциональны.
Предупреждение выводится, когда величина является частью аргумента
.Ar в .
Это можно проиллюстрировать на примере преобразования из Фаренгейта в Цельсий:
.Bd -literal -offset 2n
         (-> x*0.55555556g -17.777778g)
         (<- y*1.8g 32g)
ПРЕДУПРЕЖДЕНИЕ: преобразование непропорциональных величин.
         (-> x*0.55555556g -17.777778g)
         (<- y*1.8g 32g)
ПРЕДУПРЕЖДЕНИЕ: преобразование непропорциональных величин.
        -17.222222
.Ed
.El
.Sh СМ. ТАКЖЕ
.Xr bc 1
.Sh ИСТОРИЯ
.Nm
впервые появилась в
.Nx
и была портирована в
.Fx 2.2.0 .
.Pp
Страница руководства была значительно переписана в
.Fx 13.0
.An Mateusz Piotrowski Aq Mt 0mp@FreeBSD.org .
.Sh АВТОРЫ
.An Adrian Mariano Aq Mt adrian@cam.cornell.edu
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Эффект включения
.Dq /
в префикс неожиданный.
.Pp
Показатели степени, вводимые пользователем, могут быть только однозначными.
Вы можете обойти это, перемножив несколько членов.
.Pp
Пользователь должен использовать
.Dq Ic \&|
для обозначения деления чисел и
.Dq Ic /
для обозначения деления символов.
Это различие не должно
быть необходимым.
.Pp
Программа содержит различные произвольные ограничения на длину
преобразуемых единиц и на длину файла данных.
.Pp
Программа должна использовать хеш-таблицу для хранения единиц, чтобы
не занимать так много времени загрузка списка единиц и проверка
на дублирование.
.Pp
Невозможно преобразовать отрицательное значение.
.Pp
Программа
.Nm
не очень хорошо обрабатывает приведение длинных списков единиц:
.Bd -literal -offset 2n
        * 1e+308
        / 1e-308
        * inf
        / 0
units: переполнение памяти при приведении единиц
ошибка соответствия единиц
        1 м^500
        1 санти см^499
units: переполнение памяти при приведении единиц
units: переполнение памяти при приведении единиц
units: переполнение памяти при приведении единиц
ошибка соответствия единиц
        1 м^500
        1 санти см^499
.Ed
