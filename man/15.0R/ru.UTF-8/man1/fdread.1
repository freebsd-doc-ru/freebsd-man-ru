.\"
.\" Copyright (c) 2001 Joerg Wunsch
.\"
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE DEVELOPERS ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE DEVELOPERS BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\"
.\" FRDP path ./usr.sbin/fdread/fdread.1
.\" FRDP githash fa9896e082a1046ff4fbc75fcba4d18d1f2efc19
.\" FRDP hash256 9686c5dfac87d203a2f0a4dd096ace6c1674b0dcdb6d5c368c313c018064458f
.Dd 14 мая 2001
.Dt FDREAD 1
.Os
.Sh ИМЯ
.Nm fdread
.Nd чтение гибких дисков
.Sh СИНТАКСИС
.Nm
.Op Fl qr
.Op Fl d Ar устройство
.Op Fl f Ar байт_заполнения
.Op Fl o Ar файл
.Nm
.Op Fl d Ar устройство
.Fl I Ar кол_секторов
.Op Fl t Ar номер_дорожки
.Sh ОПИСАНИЕ
Утилита
.Nm
читает гибкие диски.
Выполняется эффективное чтение с блокировкой на основе размера дорожки,
и может быть включено специальное восстановление ошибочных блоков для гибких дисков.
.Pp
Утилита
.Nm
всегда читает всё содержимое гибкого носителя и записывает его в
соответствующий выходной файл.
В отличие от других инструментов, таких как
.Xr dd 1 ,
.Nm
автоматически использует размер блока чтения, который более эффективен, чем
чтение одиночных блоков (обычно за раз читается одна дорожка данных), но
переходит к чтению одиночных секторов гибкого диска в случае ошибки ввода-вывода,
чтобы получить как можно больше корректных данных.
Пока
.Nm
работает, вывод ошибок ядра для ошибок гибкого диска отключён, поэтому
консоль и/или системный журнал не переполняются сообщениями об ошибках ядра.
.Pp
Утилита
.Nm
принимает следующие опции:
.Bl -tag -width indent
.It Fl q
Включить тихий режим.
По умолчанию параметры носителя устройства
выводятся в стандартный поток ошибок, прогресс будет отображаться
приблизительным количеством килобайт, прочитанных на данный момент, а ошибки будут
подробно выводиться, включая информацию о местоположении
восстановленных данных в выходном файле.
В тихом режиме ни одно из этих сообщений
генерироваться не будет.
.It Fl r
Включить восстановление ошибок.
По умолчанию
.Nm
останавливается после первой неустранимой ошибки чтения, подобно
.Xr dd 1 .
Однако в режиме восстановления будет предпринято одно из двух действий:
.Bl -bullet
.It
Если ошибкой была ошибка CRC в поле данных,
ядру сообщается игнорировать ошибку, и данные всё равно передаются в
выходной файл.
.Bf -emphasis
Обратите внимание, что это приведёт к включению ошибочных данных
в выходной файл!
.Ef
Тем не менее, это лучшее действие по восстановлению, которое вообще можно предпринять.
.It
Все остальные ошибки действительно фатальны (обычно контроллер гибких дисков не нашёл
полей идентификаторов секторов), поэтому в выходной файл будет включён
фиктивный блок с байтами заполнения.
.El
.Pp
Если не работает в тихом режиме, предпринятое действие и местоположение
ошибки в выходном файле будут отображены.
.It Fl d Ar устройство
Задать устройство гибкого диска для чтения, по умолчанию
.Pa /dev/fd0 .
Параметр
.Ar устройство
должен быть корректным устройством гибкого диска.
.It Fl f Ar байт_заполнения
Значение байта заполнения, используемого для фиктивных блоков в выходном файле в
режиме восстановления.
По умолчанию
.Ql 0xf0 .
(Мнемоническое:
.Dq foo . )
Значение может быть указано с использованием обычной для языка C нотации
основания системы счисления.
.It Fl o Ar файл
Задать выходной файл как
.Ar файл .
По умолчанию данные будут записываться в стандартный вывод.
.It Fl I Ar кол_секторов
Прочитать
.Ar кол_секторов
полей идентификаторов секторов и вывести их содержимое в стандартный вывод.
Каждое поле идентификатора сектора содержит записанные значения для номера цилиндра
.Pq Ql C ,
номера головки
.Pq Ql H ,
номера записи (номер сектора, начиная с 1)
.Pq Ql R ,
и
.Em значения смещения сектора
(0 = 128 байт, 1 = 256 байт, 2 = 512 байт, 3 = 1024 байта)
.Pq Ql N .
Опция
.Fl I
является взаимоисключающей со всеми другими опциями, кроме
.Fl d Ar устройство
и
.Fl t Ar номер_дорожки .
.It Fl t Ar номер_дорожки
Задать номер дорожки (номер цилиндра * количество головок + номер
головки) для чтения полей идентификаторов секторов; допустимо только вместе с
опцией
.Fl I Ar кол_секторов .
.El
.Sh ФАЙЛЫ
.Bl -tag -width /dev/fd0
.It Pa /dev/fd0
Устройство по умолчанию для чтения.
.El
.Sh СТАТУС ВЫХОДА
Утилита
.Nm
устанавливает значение выхода в соответствии с
.Xr sysexits 3 .
В режиме восстановления значение выхода будет установлено в
.Dv EX_IOERR ,
если во время обработки произошла любая ошибка (даже в тихом режиме).
.Sh ДИАГНОСТИКА
Если не работает в тихом режиме, при возникновении ошибки будет
выведено состояние контроллера гибких дисков (FDC), как в
шестнадцатеричной форме, так и с текстовым описанием, которое переводит
эти значения в удобочитаемую форму для наиболее распространённых случаев ошибок,
которые могут произойти в среде PC.
.Pp
Статус ошибки FDC включает три регистра состояния FDC
.Ql ST0 ,
.Ql ST1 ,
и
.Ql ST2 ,
а также местоположение ошибки (физический цилиндр, головка и номер сектора,
а также, соответственно,
.Dq значение смещения сектора ).
Подробности о содержимом регистров состояния см. в руководстве по NE765 или совместимому.
.Pp
Затем статус FDC анализируется, чтобы определить, считается ли ошибка
устранимой.
Если было запрошено восстановление ошибок,
местоположение плохого блока в выходном файле указывается его
(шестнадцатеричными) границами.
Также перед выходом будет выведена сводная строка, указывающая общее количество
ошибок передачи.
.Sh СМ. ТАКЖЕ
.Xr dd 1 ,
.Xr fdwrite 1 ,
.Xr sysexits 3 ,
.Xr fdc 4 ,
.Xr fdcontrol 8
.Sh ИСТОРИЯ
Утилита
.Nm
была написана в основном для того, чтобы предоставить средство восстановления хотя бы части
данных на повреждённых носителях и избавить от необходимости вызывать
.Xr dd 1
со слишком большим количеством сложно запоминаемых опций, которые могут быть полезны для работы
с гибким диском.
.Pp
Команда появилась в
.Fx 5.0 .
.Sh АВТОРЫ
Программа и страница руководства от
.An J\(:org Wunsch .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Одновременная активность на втором приводе гибких дисков, подключённом к тому же FDC,
сделает попытки восстановления ошибок бессмысленными, так как статус FDC,
полученный после возникновения ошибки чтения, не может быть гарантированно относящимся
к ошибочной передаче.
Таким образом, использование опции
.Fl r
надёжно только если
.Ar устройство
является единственным активным приводом на этом контроллере.
.Pp
Не предпринимается попыток выйти за рамки механизма повторных попыток при ошибках гибкого диска в
.Xr fdc 4 ,
чтобы проверить, можно ли всё ещё прочитать плохие сектора
без ошибок, попробовав несколько раз.
.Pp
Биты, которые (уже) недоступны на гибком носителе, не могут быть
угаданы
.Nm .
