.\" Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
.\" See https://llvm.org/LICENSE.txt for license information.
.\" SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
.\"
.\" This man page documents only lld's ELF linking support, obtained originally
.\" from FreeBSD.
.\" FRDP path ./contrib/llvm-project/lld/docs/ld.lld.1
.\" FRDP githash 0fca6ea1d4eea4c934cfff25ac9ee8ad6fe95583
.\" FRDP hash256 55a050dd5b511c5877fe569e12395b3eb60f6ec1ba2dce87a0804deca2e2f437
.Dd 25 июля 2023
.Dt LD.LLD 1
.Os
.Sh ИМЯ
.Nm ld.lld
.Nd ELF-компоновщик из проекта LLVM
.Sh СИНТАКСИС
.Nm ld.lld
.Op Ar опции
.Ar объектный_файл ...
.Sh ОПИСАНИЕ
Компоновщик принимает один или несколько объектных, архивных и библиотечных файлов и объединяет
их в выходной файл (исполняемый файл, разделяемую библиотеку или другой объектный файл).
Он перемещает код и данные из входных файлов и разрешает ссылки на символы
между ними.
.Pp
.Nm
является полной заменой компоновщиков GNU BFD и gold.
Он принимает большинство тех же аргументов командной строки и скриптов компоновки,
что и компоновщики GNU.
.Pp
.Nm
в настоящее время поддерживает цели i386, x86-64, ARM, AArch64, LoongArch, PowerPC32,
PowerPC64, MIPS32, MIPS64, RISC-V, AMDGPU, Hexagon и SPARC V9.
.Nm
действует как совместимый с Microsoft link.exe компоновщик, если вызван как
.Nm lld-link,
и как ld в macOS, если вызван как
.Nm ld.ld64.
Все эти цели всегда поддерживаются независимо от того, как был собран
.Nm ,
поэтому вы всегда можете использовать
.Nm
как нативный компоновщик, так и кросскомпоновщик.
.Sh ОПЦИИ
Многие опции имеют как краткую, так и длинную форму.
При использовании длинной формы опций, кроме начинающихся с буквы
.Cm o ,
можно указывать с одним или двумя дефисами перед именем опции.
Длинные опции, начинающиеся с
.Cm o ,
требуют двух дефисов, чтобы избежать путаницы с опцией
.Fl o Ar путь .
.Pp
.Bl -tag -width indent
.It Fl -allow-multiple-definition
Не вызывать ошибку, если символ определён несколько раз.
Будет использовано первое определение.
.It Fl -allow-shlib-undefined
Разрешить неразрешённые ссылки в разделяемых библиотеках.
Эта опция включена по умолчанию при компоновке разделяемой библиотеки.
.It Fl -apply-dynamic-relocs
Применять значения времени компоновки для динамических перемещений.
.It Fl -as-needed
Устанавливать
.Dv DT_NEEDED
для разделяемых библиотек только при использовании.
.It Fl -auxiliary Ns = Ns Ar значение
Установить поле
.Dv DT_AUXILIARY
в указанное имя.
.It Fl -Bdynamic , Fl -dy
Компоновать с разделяемыми библиотеками.
.It Fl -Bstatic , Fl -static , Fl -dn
Не компоновать с разделяемыми библиотеками.
.It Fl Bno-symbolic
Не связывать символы с видимостью по умолчанию локально для
.Fl shared
(по умолчанию).
.It Fl Bsymbolic
Связывать символы с видимостью по умолчанию локально для
.Fl shared .
Также устанавливает флаг
.Dv DF_SYMBOLIC .
.It Fl Bsymbolic-non-weak
Связывать определённые символы STB_GLOBAL с видимостью по умолчанию локально для
.Fl shared .
.It Fl Bsymbolic-functions
Связывать определённые символы функций с видимостью по умолчанию локально для
.Fl shared .
.It Fl Bsymbolic-non-weak-functions
Связывать определённые символы функций STB_GLOBAL с видимостью по умолчанию локально для
.Fl shared .
.It Fl --be8
Записывать файл ELF с обратным порядком байтов в формате BE8 (только AArch32)
.It Fl -build-id Ns = Ns Ar значение
Генерировать заметку build ID.
.Ar значение
может быть одним из
.Cm fast ,
.Cm md5 ,
.Cm sha1 ,
.Cm tree ,
.Cm uuid ,
.Cm 0x Ns Ar шестнадцатеричная_строка ,
и
.Cm none .
.Cm tree
является псевдонимом для
.Cm sha1 .
Build-ID типа
.Cm fast ,
.Cm md5 ,
.Cm sha1 ,
и
.Cm tree
вычисляются из содержимого объектов.
.Cm fast
не предназначен для криптографической безопасности.
.It Fl -build-id
Синоним для
.Fl -build-id Ns = Ns Cm sha1 .
.It Fl -call-graph-profile-sort Ns = Ns Ar алгоритм
.Ar алгоритм
может быть:
.Pp
.Bl -tag -width 2n -compact
.It Cm none
Игнорировать профиль графа вызовов.
.It Cm hfsort
Использовать hfsort.
.It Cm cdsort
Использовать cdsort (по умолчанию).
.El
.Pp
.It Fl -color-diagnostics Ns = Ns Ar значение
Использовать цвета в диагностике.
.Ar значение
может быть одним из
.Cm always ,
.Cm auto ,
и
.Cm never .
.Cm auto
включает цвет, если и только если вывод направлен на терминал.
.It Fl -color-diagnostics
Псевдоним для
.Fl -color-diagnostics Ns = Ns Cm auto .
.It Fl -compress-debug-sections Ns = Ns Ar значение
Сжимать DWARF-секции отладки.
Секции остаются несжатыми, если сжатое содержимое будет больше.
.Cm значение
может быть
.Pp
.Bl -tag -width 2n -compact
.It Cm none
Без сжатия.
.It Cm zlib
Уровень сжатия по умолчанию равен 1 (самый быстрый), так как отладочная информация обычно
хорошо сжимается на этом уровне.
.It Cm zstd
Использовать уровень сжатия по умолчанию в zstd.
.El
.Pp
.It Fl -compress-sections Ns = Ns Ar глоб_секций={none,zlib,zstd}[:уровень]
Сжимать выходные секции, соответствующие шаблону и не имеющие флага SHF_ALLOC.
Соответствующие секции остаются несжатыми, если сжатое содержимое будет больше.
Уровень сжатия равен
.Cm уровню
(если указан) или уровню по умолчанию, ориентированному на скорость.
Это похоже на обобщённый
.Cm --compress-debug-sections .
.It Fl -cref
Выводить таблицу перекрёстных ссылок. Если указан
.Fl Map ,
печатать в файл карты.
.It Fl -debug-names
Генерировать объединённую секцию
.Li .debug_names .
.It Fl -default-script Ns = Ns Ar файл , Fl dT Ar файл
При отсутствии
.Fl -script ,
читать этот скрипт компоновки по умолчанию.
.It Fl -defsym Ns = Ns Ar символ Ns = Ns Ar выражение
Определить псевдоним символа.
.Ar выражение
может быть другим символом или выражением скрипта компоновки.
Например,
.Ql --defsym=foo=bar
или
.Ql --defsym=foo=bar+0x100 .
.It Fl -demangle
Деманглировать имена символов.
.It Fl -disable-new-dtags
Отключить новые динамические теги.
.It Fl -discard-all , Fl x
Удалить все локальные символы.
.It Fl -discard-locals , Fl X
Удалить временные локальные символы.
.It Fl -discard-none
Сохранять все символы в таблице символов.
.It Fl -dynamic-linker Ns = Ns Ar значение
Указать динамический компоновщик, который будет использоваться для динамически компонуемого исполняемого файла.
Записывается в сегменте ELF типа
.Dv PT_INTERP .
.It Fl -dynamic-list Ns = Ns Ar файл
Аналогично
.Cm --export-dynamic-symbol-list .
При создании разделяемого объекта подразумевает
.Cm -Bsymbolic ,
но не устанавливает DF_SYMBOLIC.
.It Fl -EB
Выбрать формат с обратным порядком байтов в команде OUTPUT_FORMAT.
.It Fl -EL
Выбрать формат с прямым порядком байтов в команде OUTPUT_FORMAT.
.It Fl -eh-frame-hdr
Запросить создание секции
.Li .eh_frame_hdr
и заголовка сегмента
.Dv PT_GNU_EH_FRAME .
.It Fl -emit-relocs , Fl q
Генерировать перемещения в выходном файле.
.It Fl -enable-new-dtags
Включить новые динамические теги.
.It Fl -enable-non-contiguous-regions
Размещать входные секции в последующих соответствующих выходных секциях, чтобы избежать переполнения области памяти.
.It Fl -end-lib
Завершить группировку объектов, которые должны обрабатываться так, как если бы они были вместе
в архиве.
.It Fl -entry Ns = Ns Ar точка_входа
Имя символа точки входа.
.It Fl -error-limit Ns = Ns Ar значение
Максимальное количество ошибок для вывода перед остановкой.
Значение ноль указывает на отсутствие ограничения.
.It Fl -error-unresolved-symbols
Сообщать о неразрешённых символах как об ошибках.
.It Fl -error-handing-script Ns = Ns Ar путь_скрипта
Вызывать скрипт
.Ar путь_скрипта
при возникновении некоторой ошибки, с
.Ar тегом
в качестве первого аргумента и дополнительным параметром в качестве второго аргумента. Ожидается, что скрипт
вернёт 0 при успехе. Любое другое значение считается общей ошибкой.
.Ar тег
может быть
.Cm missing-lib
с последующим именем отсутствующей библиотеки или
.Cm undefined-symbol
с последующим именем неопределённого символа.
.It Fl -execute-only
Помечать исполняемые секции как недоступные для чтения.
Эта опция в настоящее время поддерживается только на AArch64.
.It Fl -exclude-libs Ns = Ns Ar значение
Исключать статические библиотеки из автоматического экспорта.
.It Fl -export-dynamic , Fl E
Помещать символы в динамическую таблицу символов.
.It Fl -export-dynamic-symbol Ns = Ns Ar шаблон
(исполняемый файл) Помещать соответствующие нелокальные определённые символы в динамическую таблицу символов.
(разделяемый объект) Ссылки на соответствующие нелокальные символы STV_DEFAULT не должны привязываться к определениям внутри разделяемого объекта, даже если они были бы привязаны из-за
.Cm -Bsymbolic ,
.Cm -Bsymbolic-functions
или
.Cm --dynamic-list .
.It Fl -export-dynamic-symbol-list Ns = Ns Ar файл
Прочитать список шаблонов динамических символов из
.Ar файла .
Применить
.Cm --export-dynamic-symbol
на каждом шаблоне.
.It Fl -fatal-warnings
Рассматривать предупреждения как ошибки.
.It Fl -filter Ns = Ns Ar значение , Fl F Ar значение
Установить поле
.Dv DT_FILTER
в указанное значение.
.It Fl -fini Ns = Ns Ar символ
Указать функцию финализатора.
.It Fl -force-group-allocation
Имеет смысл только для -r. Группы секций отбрасываются. Если два члена группы секций размещены в одной выходной секции, объединить их перемещения.
.It Fl -format Ns = Ns Ar формат_ввода , Fl b Ar формат_ввода
Указать формат входных данных, следующих за этой опцией.
.Ar формат_ввода
может быть одним из
.Cm binary ,
.Cm elf ,
и
.Cm default .
.Cm default
является синонимом для
.Cm elf .
.It Fl -gc-sections
Включить сборку мусора неиспользуемых секций.
.It Fl -gdb-index
Генерировать секцию
.Li .gdb_index .
.It Fl -hash-style Ns = Ns Ar значение
Указать стиль хэша.
.Ar значение
может быть
.Cm sysv ,
.Cm gnu ,
или
.Cm both .
.Cm both
используется по умолчанию.
.It Fl -help
Вывести справочное сообщение.
.It Fl -icf Ns = Ns Cm all
Включить свёртывание идентичного кода.
.It Fl -icf Ns = Ns Cm safe
Включить безопасное свёртывание идентичного кода.
.It Fl -icf Ns = Ns Cm none
Отключить свёртывание идентичного кода.
.It Fl -ignore-data-address-equality
Игнорировать равенство адресов данных. C/C++ требует, чтобы каждые данные имели уникальный
адрес.
Эта опция позволяет lld выполнять небезопасную оптимизацию, нарушающую это
требование: создавать копии данных только для чтения или объединять два или более данных только для чтения,
которые имеют одинаковое значение.
.It Fl -ignore-function-address-equality
Игнорировать равенство адресов функций.
Эта опция позволяет некорректным вызовам (non-PIC) функции с невидимостью по умолчанию в
разделяемом объекте.
Функция может иметь разные адреса внутри исполняемого файла и внутри
разделяемого объекта.
.It Fl -image-base Ns = Ns Ar значение
Установить базовый адрес в
.Ar значение .
.It Fl -init Ns = Ns Ar символ
Указать функцию инициализатора.
.It Fl -keep-unique Ns = Ns Ar символ
Не сворачивать
.Ar символ
во время ICF.
.It Fl l Ar имя_библиотеки, Fl -library Ns = Ns Ar имя_библиотеки
Корневое имя используемой библиотеки.
.It Fl L Ar каталог , Fl -library-path Ns = Ns Ar каталог
Добавить каталог в путь поиска библиотек.
.It Fl -lto-aa-pipeline Ns = Ns Ar значение
AA-пайплайн для выполнения во время LTO.
Используется вместе с
.Fl -lto-newpm-passes .
.It Fl -lto-newpm-passes Ns = Ns Ar значение
Проходы для выполнения во время LTO.
.It Fl -lto-O Ns Ar уровень_оптимизации
Уровень оптимизации для LTO.
.It Fl -lto-partitions Ns = Ns Ar значение
Количество разделов кодогенерации LTO.
.It Fl m Ar значение
Установить эмуляцию цели.
.It Fl -Map Ns = Ns Ar файл , Fl M Ar файл
Вывести карту компоновки в
.Ar файл .
.It Fl -nmagic , Fl n
Не выравнивать секции по страницам, компоновать со статическими библиотеками.
.It Fl -no-allow-shlib-undefined
Не разрешать неразрешённые ссылки в разделяемых библиотеках.
Эта опция включена по умолчанию при компоновке исполняемого файла.
.It Fl -no-as-needed
Всегда устанавливать
.Dv DT_NEEDED
для разделяемых библиотек.
.It Fl -no-color-diagnostics
Не использовать цвета в диагностике.
.It Fl -no-demangle
Не деманглировать имена символов.
.It Fl -no-dynamic-linker
Запретить вывод секции
.Li .interp .
.It Fl -no-fortran-common
Не искать определения в членах архивов для переопределения символов COMMON.
.It Fl -no-gc-sections
Отключить сборку мусора неиспользуемых секций.
.It Fl -no-gnu-unique
Отключить привязку символов STB_GNU_UNIQUE.
.It Fl -no-merge-exidx-entries
Отключить объединение записей .ARM.exidx.
.It Fl -no-nmagic
Выравнивать секции по страницам.
.It Fl -no-omagic
Не устанавливать секции текста и данных как доступные для записи, выравнивать секции по страницам.
.It Fl -no-relax
Отключить релаксации, специфичные для цели. Для x86-64 это отключает оптимизацию GOT R_X86_64_GOTPCRELX и R_X86_64_REX_GOTPCRELX.
.It Fl -no-rosegment
Не помещать секции только для чтения, неисполняемые, в собственный сегмент.
.It Fl -undefined-version
Не сообщать о скриптах версий, которые ссылаются на неопределённые символы.
.It Fl -no-undefined
Сообщать о неразрешённых символах, даже если компоновщик создаёт разделяемую библиотеку.
.It Fl -no-warn-mismatch
Не отклонять неизвестные типы секций.
.It Fl -no-warn-symbol-ordering
Не предупреждать о проблемах с файлом упорядочивания символов или профилем графа вызовов.
.It Fl -no-warnings , Fl w
Подавлять предупреждения и отменять
.Cm --fatal-warnings .
.It Fl -no-whole-archive
Восстановить поведение по умолчанию загрузки членов архивов.
.It Fl -no-pie , Fl -no-pic-executable
Не создавать позиционно-независимый исполняемый файл.
.It Fl -noinhibit-exec
Сохранять выходной исполняемый файл, когда он всё ещё пригоден для использования.
.It Fl -nostdlib
Искать только в каталогах, указанных в командной строке.
.It Fl o Ar путь
Записать выходной исполняемый файл, библиотеку или объект в
.Ar путь .
Если не указано, по умолчанию используется
.Dv a.out .
.It Fl O Ns Ar значение
Оптимизировать размер выходного файла.
.Ar значение
может быть:
.Pp
.Bl -tag -width 2n -compact
.It Cm 0
Отключить слияние строк.
.It Cm 1
Включить слияние строк.
.It Cm 2
Включить слияние хвостов строк.
.El
.Pp
.Fl O Ns Cm 1
используется по умолчанию.
.It Fl -oformat Ns = Ns Ar формат
Указать формат для выходного объектного файла.
Единственный поддерживаемый
.Ar формат
это
.Cm binary ,
который создаёт вывод без заголовка ELF.
.It Fl -omagic , Fl N
Установить секции текста и данных как доступные для чтения и записи, не выравнивать секции по страницам,
компоновать со статическими библиотеками.
.It Fl -opt-remarks-filename Ar файл
Записывать замечания об оптимизации в формате YAML в
.Ar файл .
.It Fl -opt-remarks-passes Ar регулярное_выражение_проходов
Фильтровать замечания об оптимизации, разрешая только проходы, соответствующие
.Ar регулярному_выражению_проходов .
.It Fl -opt-remarks-with-hotness
Включать информацию о горячести в файл замечаний об оптимизации.
.It Fl -orphan-handling Ns = Ns Ar режим
Управлять обработкой сиротских секций.
Сиротская секция — это секция, не указанная явно в скрипте компоновки.
.Ar режим
может быть:
.Pp
.Bl -tag -width 2n -compact
.It Cm place
Размещать сиротские секции в подходящих выходных секциях.
.It Cm warn
Размещать сиротские секции как для
.Cm place ,
а также выдавать предупреждение.
.It Cm error
Размещать сиротские секции как для
.Cm place ,
а также выдавать ошибку.
.El
.Pp
.Cm place
используется по умолчанию.
.It Fl -pack-dyn-relocs Ns = Ns Ar формат
Упаковывать динамические перемещения в заданном формате.
.Ar формат
может быть:
.Pp
.Bl -tag -width 2n -compact
.It Cm none
Не упаковывать.
Динамические перемещения кодируются в SHT_REL(A).
.It Cm android
Упаковывать динамические перемещения в SHT_ANDROID_REL(A).
.It Cm relr
Упаковывать относительные перемещения в SHT_RELR, а остальные динамические перемещения в
SHT_REL(A).
.It Cm android+relr
Упаковывать относительные перемещения в SHT_RELR, а остальные динамические перемещения в
SHT_ANDROID_REL(A).
.El
.Pp
.Cm none
используется по умолчанию.
Если указано
.Fl -use-android-relr-tags ,
использовать SHT_ANDROID_RELR вместо SHT_RELR.
.Pp
.It Fl -pic-veneer
Всегда генерировать позиционно-независимые заглушки.
.It Fl -pie , Fl -pic-executable
Создавать позиционно-независимый исполняемый файл.
.It Fl -power10-stubs Ns = Ns Cm режим
Использовать ли инструкции Power10 в заглушках вызовов для R_PPC64_REL24_NOTOC и взаимодействия TOC/NOTOC.
.Ar режим
может быть:
.Pp
.Bl -tag -width 2n -compact
.It Cm yes
(по умолчанию) Использовать.
.It Cm auto
В настоящее время то же, что и yes.
.It Cm no
Не использовать.
.El

.It Fl -print-gc-sections
Выводить список удалённых неиспользуемых секций.
.It Fl -print-icf-sections
Выводить список свёрнутых идентичных секций.
.It Fl -print-map
Выводить карту компоновки на стандартный вывод.
.It Fl -print-archive-stats Ns = Ns Ar файл
Записывать статистику использования архивов в указанный файл.
Выводить количество членов и извлечённых членов для каждого архива.
.It Fl -push-state
Сохранить текущее состояние
.Fl -as-needed ,
.Fl -static ,
и
.Fl -whole-archive .
.It Fl -pop-state
Восстановить состояния, сохранённые с помощью
.Fl -push-state .
.It Fl --relax-gp
Включить релаксацию глобального указателя для RISC-V.
.It Fl -relocatable , Fl r
Создавать перемещаемый объектный файл.
.It Fl -remap-inputs Ns = Ns Ar исходный_шаблон=целевой_файл
Входные файлы, соответствующие
.Cm исходный_шаблон ,
отображаются на
.Cm целевой_файл .
Используйте
.Cm /dev/null
для игнорирования входного файла.
.It Fl -remap-inputs-file Ns = Ns Ar файл
Переназначать входные файлы на основе шаблонов в
.Ar файле .
Каждая строка в файле переназначения имеет формат
.Cm исходный_шаблон=целевой_файл
или комментарий, начинающийся с
.Cm # .
.It Fl -reproduce Ns = Ns Ar путь
Записать tar-архив в
.Ar путь ,
содержащий все входные файлы, необходимые для воспроизведения компоновки, текстовый файл с именем
response.txt, содержащий параметры командной строки, и текстовый файл с именем
version.txt, содержащий вывод ld.lld --version.
Распакованный архив может
быть использован для повторного запуска компоновщика с теми же опциями и входными файлами.
.It Fl -retain-symbols-file Ns = Ns Ar файл
Сохранять только символы, перечисленные в файле.
.It Fl -rpath Ns = Ns Ar значение , Fl R Ar значение
Добавить
.Dv DT_RUNPATH
в вывод.
.It Fl -rsp-quoting Ns = Ns Ar значение
Стиль кавычек для файлов ответов.
Поддерживаемые значения:
.Cm windows
и
.Cm posix .
.It Fl -script Ns = Ns Ar файл , Fl T Ar файл
Прочитать скрипт компоновки из
.Ar файла .
Если указано несколько скриптов компоновки, они обрабатываются так, как если бы они
были объединены в порядке их появления в командной строке.
.It Fl -section-start Ns = Ns Ar секция Ns = Ns Ar адрес
Установить адрес секции.
.It Fl -shared , Fl -Bsharable
Собрать разделяемый объект.
.It Fl -shuffle-sections Ns = Ns Ar зерно
Перемешивать соответствующие секции с использованием заданного зерна перед отображением их в выходные секции.
Если -1, обратить порядок секций. Если 0, использовать случайное зерно.
.It Fl -soname Ns = Ns Ar значение , Fl h Ar значение
Установить
.Dv DT_SONAME
в
.Ar значение .
.It Fl -sort-common
Эта опция игнорируется для совместимости с GNU.
.It Fl -sort-section Ns = Ns Ar значение
Указывает правило сортировки секций при использовании скрипта компоновки.
.It Fl -start-lib
Начать группировку объектов, которые должны обрабатываться так, как если бы они были вместе
в архиве.
.It Fl -strip-all , Fl s
Удалить все символы.
Подразумевает
.Fl -strip-debug .
.It Fl -strip-debug , Fl S
Удалить отладочную информацию.
.It Fl -symbol-ordering-file Ns = Ns Ar файл
Размещать секции в порядке, указанном в
.Ar файле .
.It Fl -sysroot Ns = Ns Ar значение
Установить корневую файловую систему.
.It Fl -target1-abs
Интерпретировать
.Dv R_ARM_TARGET1
как
.Dv R_ARM_ABS32 .
.It Fl -target1-rel
Интерпретировать
.Dv R_ARM_TARGET1
как
.Dv R_ARM_REL32 .
.It Fl -target2 Ns = Ns Ar тип
Интерпретировать
.Dv R_ARM_TARGET2
как
.Ar тип ,
где
.Ar тип
может быть одним из
.Cm rel ,
.Cm abs ,
или
.Cm got-rel .
.It Fl -Tbss Ns = Ns Ar значение
То же, что и
.Fl -section-start
с
.Li .bss
в качестве имени секции.
.It Fl -Tdata Ns = Ns Ar значение
То же, что и
.Fl -section-start
с
.Li .data
в качестве имени секции.
.It Fl -Ttext Ns = Ns Ar значение
То же, что и
.Fl -section-start
с
.Li .text
в качестве имени секции.
.It Fl -thinlto-cache-dir Ns = Ns Ar значение
Путь к каталогу кэшированных объектных файлов ThinLTO.
.It Fl -thinlto-cache-policy Ns = Ns Ar значение
Политика очистки для кэша ThinLTO.
.It Fl -thinlto-jobs Ns = Ns Ar значение
Количество заданий ThinLTO.
.It Fl -threads Ns = Ns Ar N
Количество потоков.
.Cm all
(по умолчанию) означает все поддерживаемые параллельные потоки.
.Cm 1
отключает многопоточность.
.It Fl -fat-lto-objects
Использовать секцию .llvm.lto, которая содержит биткод LLVM, в толстых LTO-объектных файлах для выполнения LTO.
.It Fl -no-fat-lto-objects
Игнорировать секцию .llvm.lto в перемещаемых объектных файлах (по умолчанию).
.It Fl -time-trace
Записывать временную трассировку.
.It Fl -time-trace-file Ns = Ns Ar файл
Записывать вывод временной трассировки в
.Ar файл .
.It Fl -time-trace-granularity Ns = Ns Ar значение
Минимальная детализация времени (в микросекундах), записываемая временным профилировщиком.
.It Fl -trace
Выводить имена входных файлов.
.It Fl -trace-symbol Ns = Ns Ar символ , Fl y Ar символ
Трассировать ссылки на
.Ar символ .
.It Fl -undefined Ns = Ns Ar символ , Fl u Ar символ
Если
.Ar символ
не определён после разрешения символов и существует статическая библиотека,
содержащая объектный файл, определяющий символ, загрузить член
для включения объектного файла в выходной файл.
.It Fl -undefined-glob Ns = Ns Ar шаблон
Синоним для
.Fl -undefined ,
за исключением того, что принимает шаблон подстановки.
В шаблоне подстановки
.Cm *
соответствует нулю или более символам,
.Cm ?
соответствует любому одиночному символу, а
.Cm [...]
соответствует символам в скобках.
Все символы, соответствующие
заданному шаблону, обрабатываются так, как если бы они были заданы в качестве аргументов
.Fl -undefined .
.It Fl -unique
Создавать отдельную выходную секцию для каждой сиротской входной секции.
.It Fl -unresolved-symbols Ns = Ns Ar значение
Определять, как обрабатывать неразрешённые символы.
.It Fl -use-android-relr-tags
Использовать теги SHT_ANDROID_RELR / DT_ANDROID_RELR* вместо SHT_RELR / DT_RELR*.
.It Fl v , Fl V
Отобразить номер версии и продолжить компоновку, если указаны объектные файлы.
.It Fl -version
Отобразить номер версии и выйти.
.It Fl -verbose
Режим подробного вывода.
.It Fl -version-script Ns = Ns Ar файл
Прочитать скрипт версий из
.Ar файла .
.It Fl -warn-backrefs
Предупреждать об обратных или циклических зависимостях к статическим архивам или между ними.
Это может быть использовано для обеспечения совместимости вызова компоновщика с
традиционными компоновщиками в стиле Unix.
.It Fl -warn-backrefs-exclude Ns = Ns Ar шаблон
Шаблон, описывающий архив (или объектный файл внутри --start-lib),
который следует игнорировать для
.Fl -warn-backrefs .
.It Fl -warn-common
Предупреждать о дублирующихся общих символах.
.It Fl -warn-ifunc-textrel
Предупреждать об использовании символов ifunc в сочетании с перемещениями текста.
Более старые версии библиотеки glibc (2.28 и ранее) имеют ошибку, из-за которой
сегмент, включающий символы ifunc, помечается как неисполняемый, когда
они перемещаются.
В результате, хотя программа компилируется и компонуется
успешно, она даёт ошибку сегментации, когда указатель инструкции достигает
символа ifunc.
Используйте -warn-ifunc-textrel, чтобы позволить lld выдавать предупреждение, если
код может включать символы ifunc, может выполнять перемещения текста и компоноваться с
более старой версией glibc.
В противном случае нет необходимости использовать это, так как значение по умолчанию не выдаёт
предупреждения.
Этот флаг был введён в конце 2018 года, не имеет аналога в компоновщиках ld и gold
и может быть удалён в будущем.
.It Fl -warn-unresolved-symbols
Сообщать о неразрешённых символах как о предупреждениях.
.It Fl -whole-archive
Принудительно загружать всех членов в статической библиотеке.
.It Fl -why-extract Ns = Ns Ar файл
Записывать в файл информацию о том, почему члены архивов извлекаются.
.It Fl -wrap Ns = Ns Ar символ
Перенаправлять ссылки на
.Ar символ
на
.Ar __wrap_symbol ,
а ссылки на
.Ar __real_symbol
на
.Ar символ .
.It Fl z Ar опция
Расширения опций компоновщика.
.Bl -tag -width indent -compact
.Pp
.It Cm dead-reloc-in-nonalloc Ns = Ns Ar глоб_секций=значение
Разрешить перемещение в соответствующей не-SHF_ALLOC секции, ссылающееся на отброшенный символ, в
.Ar значение .
Принимает шаблоны подстановки; в случае, если секция соответствует более чем одной опции, последняя
опция имеет приоритет. Рекомендуется порядок от наименее специфичного к наиболее специфичному соответствию.
.Pp
.It Cm execstack
Сделать основной стек исполняемым.
Разрешения стека записываются в сегменте
.Dv PT_GNU_STACK .
.Pp
.It Cm bti-report Ns = Ns Ar [none|warning|error]
Указать, как сообщать об отсутствии свойства GNU_PROPERTY_AARCH64_FEATURE_1_BTI.
.Cm none
используется по умолчанию, компоновщик не будет сообщать об отсутствующем свойстве, иначе будет сообщаться как предупреждение или ошибка.
.Pp
.It Cm cet-report Ns = Ns Ar [none|warning|error]
Указать, как сообщать об отсутствии свойств GNU_PROPERTY_X86_FEATURE_1_IBT или GNU_PROPERTY_X86_FEATURE_1_SHSTK.
.Cm none
используется по умолчанию, компоновщик не будет сообщать об отсутствующем свойстве, иначе будет сообщаться как предупреждение или ошибка.
.Pp
.It Cm pauth-report Ns = Ns Ar [none|warning|error]
Указать, как сообщать об отсутствии свойства GNU_PROPERTY_AARCH64_FEATURE_PAUTH.
.Cm none
используется по умолчанию, компоновщик не будет сообщать об отсутствующем свойстве, иначе будет сообщаться как предупреждение или ошибка.
.Pp
.It Cm force-bti
Принудительно включить инструкцию AArch64 BTI в PLT, предупреждать, если входной файл ELF не имеет свойства GNU_PROPERTY_AARCH64_FEATURE_1_BTI.
.Pp
.It Cm force-ibt
Принудительно включить отслеживание косвенных ветвлений Intel (Indirect Branch Tracking) в PLT, предупреждать, если входной файл ELF
не имеет свойства GNU_PROPERTY_X86_FEATURE_1_IBT.
.Pp
.It Cm global
Устанавливает флаг
.Dv DF_1_GLOBAL
в секции
.Dv DYNAMIC .
Различные загрузчики могут самостоятельно решать, как обрабатывать этот флаг.
.Pp
.It Cm ifunc-noplt
Не создавать записи PLT для символов ifunc.
Вместо этого создавать перемещения текста, ссылающиеся на распознаватель.
Это экспериментальная оптимизация и подходит только для автономных
сред, где перемещения текста не имеют обычных недостатков.
Эта опция должна комбинироваться с опцией
.Fl z Li notext .
.Pp
.It Cm initfirst
Устанавливает флаг
.Dv DF_1_INITFIRST ,
чтобы указать, что модуль должен быть инициализирован первым.
.Pp
.It Cm interpose
Установить флаг
.Dv DF_1_INTERPOSE ,
чтобы указать загрузчику времени выполнения, что объект является подставным.
Во время разрешения символов подставные объекты ищутся после приложения,
но перед другими зависимостями.
.Pp
.It Cm lrodata-after-bss
Размещать .lrodata после .bss.
.Pp
.It Cm muldefs
Не вызывать ошибку, если символ определён несколько раз.
Будет использовано первое определение.
Это синоним для
.Fl -allow-multiple-definition .
.Pp
.It Cm nocombreloc
Отключить объединение и сортировку нескольких секций перемещений.
.Pp
.It Cm nocopyreloc
Отключить создание копирующих перемещений.
.Pp
.It Cm nodefaultlib
Установить флаг
.Dv DF_1_NODEFLIB ,
чтобы указать, что пути поиска библиотек по умолчанию должны игнорироваться.
.Pp
.It Cm nodelete
Установить флаг
.Dv DF_1_NODELETE ,
чтобы указать, что объект не может быть выгружен из процесса.
.Pp
.It Cm nodlopen
Установить флаг
.Dv DF_1_NOOPEN ,
чтобы указать, что объект не может быть открыт с помощью
.Xr dlopen 3 .
.Pp
.It Cm nognustack
Не создавать сегмент
.Dv PT_GNU_STACK .
.Pp
.It Cm norelro
Не указывать, что части объекта должны быть отображены только для чтения
после начальной обработки перемещений.
Объект будет опускать сегмент
.Dv PT_GNU_RELRO .
.Pp
.It Cm notext
Разрешить перемещения против сегментов только для чтения.
Устанавливает флаг
.Dv DT_TEXTREL
в секции
.Dv DYNAMIC .
.Pp
.It Cm now
Установить флаг
.Dv DF_BIND_NOW ,
чтобы указать, что загрузчик времени выполнения должен выполнить всю обработку перемещений
как часть инициализации объекта.
По умолчанию перемещения могут выполняться по требованию.
.Pp
.It Cm origin
Установить флаг
.Dv DF_ORIGIN ,
чтобы указать, что объект требует
обработки $ORIGIN.
.Pp
.It Cm pac-plt
Только AArch64, использовать аутентификацию указателей в PLT.
.Pp
.It Cm pack-relative-relocs
Аналогично
.Cm -pack-dyn-relocs=relr ,
но синтезирует зависимость версии GLIBC_ABI_DT_RELR, если есть зависимость версии GLIBC_2.*.
glibc ld.so отклоняет загрузку динамически компонуемого объекта без зависимости версии GLIBC_ABI_DT_RELR.
.Pp
.It Cm rel
Использовать формат REL для динамических перемещений.
.Pp
.It Cm rela
Использовать формат RELA для динамических перемещений.
.Pp
.It Cm retpolineplt
Создавать записи PLT в формате retpoline в качестве меры для CVE-2017-5715.
.Pp
.It Cm rodynamic
Сделать секцию
.Li .dynamic
доступной только для чтения.
Тег
.Dv DT_DEBUG
не будет создаваться.
.Pp
.It Cm separate-loadable-segments
.It Cm separate-code
.It Cm noseparate-code
Указывать, могут ли два смежных сегмента PT_LOAD перекрываться в страницах.
.Cm noseparate-code
(по умолчанию) разрешает перекрытие.
.Cm separate-code
разрешает перекрытие между двумя исполняемыми сегментами или двумя неисполняемыми сегментами.
.Cm separate-loadable-segments
запрещает перекрытие.
.Pp
.It Cm shstk
Только x86, использовать теневой стек.
.Pp
.It Cm stack-size Ns = Ns Ar размер
Установить размер стека основного потока в
.Ar размер .
Размер стека записывается как размер
.Ar размера
в программном сегменте
.Dv PT_GNU_STACK .
.Pp
.It Cm start-stop-gc
Не позволять ссылкам __start_/__stop_ удерживать связанные секции имён идентификаторов C (по умолчанию).
.Pp
.It Cm nostart-stop-gc
Позволять ссылкам __start_/__stop_ удерживать связанные секции имён идентификаторов C.
.Pp
.It Cm text
Не разрешать перемещения против сегментов только для чтения.
Это используется по умолчанию.
.Pp
.It Cm wxneeded
Создать сегмент
.Dv PT_OPENBSD_WXNEEDED .
.El
.El

.Sh ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ
.Bl -tag -width LC_CTYPE
.It Ev LLD_REPRODUCE
Создать архив воспроизведения с указанным именем файла. Если указан
.Fl -reproduce ,
имеет приоритет
.Fl -reproduce .
.It Ev LLD_VERSION
ld.lld создаёт секцию с именем
.Cm .comment ,
содержащую строку версии LLD. Эта строка версии может быть переопределена этой переменной окружения,
что полезно для устранения различий в двоичном файле, вызванных различиями в номере версии LLD.
.El

.Sh ЗАМЕЧАНИЯ ПО РЕАЛИЗАЦИИ
Обработка архивных файлов (с расширением
.Pa .a )
в
.Nm
отличается от обработки в традиционных компоновщиках, используемых в системах, подобных Unix.
.Pp
Традиционные компоновщики поддерживают набор неопределённых символов во время компоновки.
Компоновщик обрабатывает каждый файл в порядке их появления в командной строке, пока набор неопределённых символов не станет пустым.
Объектный файл компонуется в выходной объект, когда он встречается,
и его неопределённые символы добавляются в набор.
При встрече архивного файла традиционный компоновщик ищет содержащиеся в нём объекты
и обрабатывает те, которые удовлетворяют символам в неразрешённом наборе.
.Pp
Обработка взаимозависимых архивов может быть неудобной при использовании традиционного компоновщика.
Архивные файлы могут потребоваться указывать несколько раз, или могут использоваться специальные параметры командной строки
.Fl -start-group
и
.Fl -end-group ,
чтобы заставить компоновщик циклически обрабатывать файлы в группе, пока в набор не будут добавлены новые
символы.
.Pp
.Nm
записывает все символы, найденные в объектах и архивах, по мере итерации по
аргументам командной строки.
Когда
.Nm
встречает неопределённый символ, который может быть разрешён объектным файлом,
содержащимся в ранее обработанном архивном файле, он немедленно извлекает
и компонует его в выходной объект.
.Pp
При определённых входных архивных данных
.Nm
может давать разные результаты по сравнению с традиционными компоновщиками.
На практике большое количество стороннего программного обеспечения было скомпоновано с помощью
.Nm
без существенных проблем.
.Pp
Опция
.Fl -warn-backrefs
может быть использована для идентификации вызова компоновщика, который может быть несовместим
с поведением традиционных компоновщиков в стиле Unix.
