.\"-
.\" Copyright (c) 1989, 1990, 1993, 1994
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" the Institute of Electrical and Electronics Engineers, Inc.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)chmod.1	8.4 (Berkeley) 3/31/94
.\"
.\" FRDP path ./bin/chmod/chmod.1
.\" FRDP githash 90aea514c6249118e880d75972d063362f4bf492
.\" FRDP hash256 7eb38718238e83ca72337e5f5f65921daa11c223f9696dac05c852d5c345c33b
.Dd 7 января 2017
.Dt CHMOD 1
.Os
.Sh ИМЯ
.Nm chmod
.Nd изменение режимов файла
.Sh СИНТАКСИС
.Nm
.Op Fl fhv
.Op Fl R Op Fl H | L | P
.Ar режим
.Ar
.Sh ОПИСАНИЕ
Утилита
.Nm
изменяет биты режима файла для указанных файлов
в соответствии с операндом
.Ar режим .
.Pp
Параметры следующие:
.Bl -tag -width indent
.It Fl f
Не выводить диагностическое сообщение, если
.Nm
не может изменить режим для
.Va файла ,
и не изменять статус выхода для отражения таких сбоев.
.It Fl H
Если указана опция
.Fl R ,
символические ссылки в командной строке отслеживаются
и, следовательно, не затрагиваются командой.
(Символические ссылки, встреченные при обходе дерева, не отслеживаются.)
.It Fl h
Если файл является символической ссылкой, изменить режим самой ссылки,
а не файла, на который она указывает.
.It Fl L
Если указана опция
.Fl R ,
все символические ссылки отслеживаются.
.It Fl P
Если указана опция
.Fl R ,
никакие символические ссылки не отслеживаются.
Это поведение по умолчанию.
.It Fl R
Изменять режимы иерархий файлов, корнями которых являются указанные файлы,
а не только самих файлов.
Следует остерегаться непреднамеренного совпадения с
жесткой ссылкой на родительский каталог при использовании шаблонов, таких как
.It Fl v
Принудить
.Nm
к подробному выводу, показывающему имена файлов по мере изменения режима.
Если флаг
.Fl v
указан более одного раза, также будут выведены старый и новый режимы файла
в восьмеричной и символической нотации.
.El
.Pp
Параметры
.Fl H ,
.Fl L
и
.Fl P
игнорируются, если не указана опция
.Fl R .
Кроме того, эти параметры переопределяют друг друга, и
действия команды определяются последним указанным параметром.
.Pp
Если
.Nm
получает сигнал
.Dv SIGINFO
(см. аргумент
.Cm status
для
.Xr stty 1 ) ,
то отображаются текущее имя файла, а также старый и новый режимы.
.Pp
Только владелец файла или суперпользователь имеют право изменять
режим файла.
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh РЕЖИМЫ
Режимы могут быть абсолютными или символическими.
Абсолютный режим — это восьмеричное число, составленное из суммы
одного или нескольких следующих значений:
.Pp
.Bl -tag -width 6n -compact -offset indent
.It Li 4000
(бит setuid).
Исполняемые файлы с установленным этим битом
будут запускаться с эффективным uid, установленным в uid владельца файла.
Каталоги с установленным этим битом будут принудительно назначать
всем файлам и подкаталогам, созданным в них, владельца, совпадающего с владельцем каталога,
а не uid процесса-создателя, если базовая файловая
система поддерживает эту возможность: см.
.Xr chmod 2
и опцию
.Cm suiddir
для
.Xr mount 8 .
.It Li 2000
(бит setgid).
Исполняемые файлы с установленным этим битом
будут запускаться с эффективным gid, установленным в gid владельца файла.
.It Li 1000
(липкий бит).
См.
.Xr chmod 2
и
.Xr sticky 7 .
.It Li 0400
Разрешить чтение владельцем.
.It Li 0200
Разрешить запись владельцем.
.It Li 0100
Для файлов — разрешить выполнение владельцем.
Для каталогов — разрешить владельцу
осуществлять поиск в каталоге.
.It Li 0040
Разрешить чтение членам группы.
.It Li 0020
Разрешить запись членам группы.
.It Li 0010
Для файлов — разрешить выполнение членами группы.
Для каталогов — разрешить
членам группы осуществлять поиск в каталоге.
.It Li 0004
Разрешить чтение остальным.
.It Li 0002
Разрешить запись остальным.
.It Li 0001
Для файлов — разрешить выполнение остальным.
Для каталогов — разрешить остальным
осуществлять поиск в каталоге.
.El
.Pp
Например, абсолютный режим, разрешающий чтение, запись и выполнение
владельцем, чтение и выполнение членами группы, чтение и выполнение
остальными, без поведения set-uid или set-gid, равен 755
(400+200+100+040+010+004+001).
.Pp
Символический режим описывается следующей грамматикой:
.Bd -literal -offset indent
режим       ::= клауза [, клауза ...]
клауза      ::= [кто ...] [действие ...] действие
действие    ::= операция [права ...]
кто         ::= a | u | g | o
операция    ::= + | \- | =
права       ::= r | s | t | w | x | X | u | g | o
.Ed
.Pp
Символы
.Ar кто
``u'', ``g'' и ``o'' определяют части битов режима для пользователя, группы и остальных
соответственно.
Символ
.Ar кто
``a'' эквивалентен ``ugo''.
.Pp
Символы
.Ar права
представляют части битов режима следующим образом:
.Pp
.Bl -tag -width Ds -compact -offset indent
.It r
Биты чтения.
.It s
Биты set-user-ID-on-execution и set-group-ID-on-execution.
.It t
Липкий бит.
.It w
Биты записи.
.It x
Биты выполнения/поиска.
.It X
Биты выполнения/поиска, если файл является каталогом или любой из
битов выполнения/поиска установлен в исходном (немодифицированном) режиме.
Операции с символом
.Ar права
``X'' имеют смысл только в сочетании с символом
.Ar операция
``+'', и игнорируются во всех остальных случаях.
.It u
Биты прав пользователя в исходном режиме файла.
.It g
Биты прав группы в исходном режиме файла.
.It o
Биты прав остальных в исходном режиме файла.
.El
.Pp
Символы
.Ar операция
представляют выполняемую операцию следующим образом:
.Bl -tag -width 4n
.It +
Если значение для
.Ar права
не указано, операция ``+'' не имеет эффекта.
Если значение для
.Ar кто
не указано, каждый бит разрешения, указанный в
.Ar права ,
для которого соответствующий бит в маске создания режима файла
(см.
.Xr umask 2 )
очищен, устанавливается.
В противном случае устанавливаются биты режима, представленные указанными значениями
.Ar кто
и
.Ar права .
.It \&\-
Если значение для
.Ar права
не указано, операция ``\-'' не имеет эффекта.
Если значение для
.Ar кто
не указано, каждый бит разрешения, указанный в
.Ar права ,
для которого соответствующий бит в маске создания режима файла
установлен, очищается.
В противном случае очищаются биты режима, представленные указанными значениями
.Ar кто
и
.Ar права .
.It =
Биты режима, указанные значением
.Ar кто ,
очищаются, или, если значение
.Ar кто
не указано, очищаются биты режима владельца, группы
и остальных.
Затем, если значение для
.Ar кто
не указано, каждый бит разрешения, указанный в
.Ar права ,
для которого соответствующий бит в маске создания режима файла
очищен, устанавливается.
В противном случае устанавливаются биты режима, представленные указанными значениями
.Ar кто
и
.Ar права .
.El
.Pp
Каждая
.Ar клауза
определяет одну или несколько операций, выполняемых над битами
режима, и каждая операция применяется к битам режима в
указанном порядке.
.Pp
Операции только над правами остальных (указанные символом
``o'' отдельно), в сочетании с символами
.Ar права
``s'' или ``t'', игнорируются.
.Pp
Право ``w'' на каталогах разрешает создание, перемещение
и копирование файлов в этот каталог.
Файлы, созданные внутри самого каталога, унаследуют его идентификатор группы (GID).
.Sh ПРИМЕРЫ
.It Li 644
сделать файл читаемым для всех и записываемым только владельцем.
.Pp
.It Li go-w
запретить право записи группе и остальным.
.Pp
.It Li =rw,+X
установить права чтения и записи в значения по умолчанию, но
сохранить любые права выполнения, которые в настоящее время установлены.
.Pp
.It Li +X
сделать каталог или файл доступным для поиска/выполнения всеми, если он уже
доступен для поиска/выполнения кем-либо.
.Pp
.It Li 755
.It Li u=rwx,go=rx
.It Li u=rwx,go=u-w
сделать файл читаемым/исполняемым всеми и записываемым только владельцем.
.Pp
.It Li go=
очистить все биты режима для группы и остальных.
.Pp
.It Li g=u-w
установить биты группы равными битам пользователя, но очистить бит записи группы.
.El
.Sh СОВМЕСТИМОСТЬ
Опция
.Fl v
не является стандартной, и её использование в скриптах не рекомендуется.
.Sh СМ. ТАКЖЕ
.Xr chflags 1 ,
.Xr install 1 ,
.Xr setfacl 1 ,
.Xr chmod 2 ,
.Xr stat 2 ,
.Xr umask 2 ,
.Xr fts 3 ,
.Xr setmode 3 ,
.Xr sticky 7 ,
.Xr symlink 7 ,
.Xr chown 8 ,
.Xr mount 8
.Sh СТАНДАРТЫ
Ожидается, что утилита
.Nm
совместима со
.St -p1003.2
за исключением символа
.Ar права
.Dq t ,
который не включён в этот стандарт.
.Sh ИСТОРИЯ
Команда
.Nm
появилась в
.At v1 .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Нет опции
.Ar права
для неприличных битов лошади.
