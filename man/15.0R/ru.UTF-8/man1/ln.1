.\"-
.\" Copyright (c) 1980, 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" the Institute of Electrical and Electronics Engineers, Inc.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)ln.1	8.2 (Berkeley) 12/30/93
.\"
.\" FRDP path ./bin/ln/ln.1
.\" FRDP githash 90aea514c6249118e880d75972d063362f4bf492
.\" FRDP hash256 c1d3314bc184308ecfd510562eb3d2313d1bb7874d55582482acfa17e8a909da
.Dd 12 июня 2017
.Dt LN 1
.Os
.Sh ИМЯ
.Nm ln ,
.Nm link
.Nd создание ссылок на файлы
.Sh СИНТАКСИС
.Nm
.Op Fl L | Fl P | Fl s Op Fl F
.Op Fl f | iw
.Op Fl hnv
.Ar исходный_файл
.Op Ar целевой_файл
.Nm
.Op Fl L | Fl P | Fl s Op Fl F
.Op Fl f | iw
.Op Fl hnv
.Ar исходный_файл ...
.Ar целевая_директория
.Nm link
.Ar исходный_файл Ar целевой_файл
.Sh ОПИСАНИЕ
Утилита
.Nm
создает новую запись в директории (связанный файл) для имени файла,
указанного в
.Ar целевой_файл .
.Ar целевой_файл
будет создан с теми же правами доступа, что и
.Ar исходный_файл .
Это полезно для поддержания нескольких копий файла в разных местах
одновременно без расхода места на
.Dq копии ;
вместо этого ссылка
.Dq указывает
на оригинальную копию.
Существует два типа ссылок: жесткие ссылки и символические ссылки.
То, как ссылка
.Dq указывает
на файл, является одним из различий между жесткой и символической ссылкой.
.Pp
Параметры следующие:
.Bl -tag -width flag
.It Fl F
Если целевой файл уже существует и является директорией, то удалить его,
чтобы можно было создать ссылку.
Параметр
.Fl F
должен использоваться совместно с параметрами
.Fl f
или
.Fl i .
Если ни
.Fl f , ни
.Fl i
не указаны, подразумевается
.Fl f .
Параметр
.Fl F
не действует, если не указан
.Fl s .
.It Fl L
При создании жесткой ссылки на символическую ссылку
создать жесткую ссылку на цель символической ссылки.
Это поведение по умолчанию.
Этот параметр отменяет параметр
.Fl P .
.It Fl P
При создании жесткой ссылки на символическую ссылку
создать жесткую ссылку на саму символическую ссылку.
Этот параметр отменяет параметр
.Fl L .
.It Fl f
Если целевой файл уже существует,
то удалить его, чтобы можно было создать ссылку.
(Параметр
.Fl f
отменяет любые предыдущие параметры
.Fl i
и
.Fl w .)
.It Fl h
Если
.Ar целевой_файл
или
.Ar целевая_директория
является символической ссылкой, не следовать по ней.
Наиболее полезно с параметром
.Fl f
для замены символической ссылки, которая может указывать на директорию.
.It Fl i
Заставить
.Nm
выводить запрос на стандартный вывод ошибок, если целевой файл существует.
Если ответ со стандартного ввода начинается с символа
.Sq Li y
или
.Sq Li Y ,
то удалить целевой файл, чтобы можно было создать ссылку.
В противном случае не пытаться создать ссылку.
(Параметр
.Fl i
отменяет любые предыдущие параметры
.Fl f .)
.It Fl n
То же, что и
.Fl h ,
для совместимости с другими реализациями
.Nm .
.It Fl s
Создать символическую ссылку.
.It Fl v
Заставить
.Nm
работать подробно, показывая обрабатываемые файлы.
.It Fl w
Предупреждать, если источник символической ссылки в данный момент не существует.
.El
.Pp
По умолчанию
.Nm
создает
.Em жесткие
ссылки.
Жесткая ссылка на файл неотличима от оригинальной записи в директории;
любые изменения файла фактически не зависят от имени, используемого для обращения к
файлу.
Директории не могут иметь жестких ссылок, и жесткие ссылки не могут пересекать границы файловых систем.
.Pp
Символическая ссылка содержит имя файла,
на который она указывает.
На указанный файл ссылаются при выполнении операции
.Xr open 2
над ссылкой.
.Xr stat 2
над символической ссылкой вернет информацию о файле, на который она указывает;
.Xr lstat 2
необходимо выполнить для получения информации о самой ссылке.
Вызов
.Xr readlink 2
может быть использован для чтения содержимого символической ссылки.
Символические ссылки могут пересекать границы файловых систем и могут указывать на директории.
.Pp
При получении одного или двух аргументов
.Nm
создает ссылку на существующий файл
.Ar исходный_файл .
Если указан
.Ar целевой_файл ,
ссылка получает это имя;
.Ar целевой_файл
также может быть директорией, в которую следует поместить ссылку;
в противном случае она помещается в текущую директорию.
Если указана только директория, ссылка будет создана
на последний компонент
.Ar исходный_файл .
.Pp
При получении более двух аргументов
.Nm
создает ссылки в
.Ar целевая_директория
на все указанные исходные файлы.
Созданные ссылки будут иметь те же имена, что и файлы, на которые они ссылаются.
.Pp
Когда утилита вызывается как
.Nm link ,
должно быть предоставлено ровно два аргумента,
ни один из которых не может указывать на директорию.
В этом простом режиме работы нельзя указывать параметры,
выполняется операция
.Xr link 2
с использованием двух переданных аргументов.
.Sh ПРИМЕРЫ
Создать символическую ссылку с именем
.Pa /home/src ,
указывающую на
.Pa /usr/src :
.Pp
.Dl # ln -s /usr/src /home/src
.Pp
Создать жесткую ссылку
.Pa /usr/local/bin/fooprog
на файл
.Pa /usr/local/bin/fooprog-1.0 :
.Pp
.Dl # ln /usr/local/bin/fooprog-1.0 /usr/local/bin/fooprog
.Pp
В качестве упражнения попробуйте следующие команды:
.Bd -literal -offset indent
# ls -i /bin/[
11553 /bin/[
# ls -i /bin/test
11553 /bin/test
.Ed
.Pp
Обратите внимание, что оба файла имеют одинаковый индексный дескриптор (inode);
то есть
.Pa /bin/[
по сути является псевдонимом для команды
.Xr test 1 .
Эта жесткая ссылка существует для того, чтобы
.Xr test 1
могла вызываться из shell-скриптов, например, используя конструкцию
if [ ].
.Pp
В следующем примере второй вызов
.Nm
удаляет оригинальный
.Pa foo
и создает замену, указывающую на
.Pa baz :
.Bd -literal -offset indent
# mkdir bar baz
# ln -s bar foo
# ln -shf baz foo
.Ed
.Pp
Без параметра
.Fl h
это привело бы к тому, что
.Pa foo
указывал бы на
.Pa bar ,
а внутри
.Pa foo
была бы создана новая символическая ссылка
.Pa baz ,
указывающая сама на себя.
Это происходит из-за обхода директорий.
.Pp
Простое правило для запоминания: порядок аргументов для
.Nm
такой же, как для
.Xr cp 1 :
Первый аргумент должен существовать, второй — создается.
.Sh СОВМЕСТИМОСТЬ
Параметры
.Fl h ,
.Fl i ,
.Fl n ,
.Fl v
и
.Fl w
нестандартны, и их использование в сценариях не рекомендуется.
Они предоставлены исключительно для совместимости с другими реализациями
.Nm .
.Pp
Параметр
.Fl F
является расширением
.Fx
и не должен использоваться в переносимых сценариях.
.Sh СМ. ТАКЖЕ
.Xr link 2 ,
.Xr lstat 2 ,
.Xr readlink 2 ,
.Xr stat 2 ,
.Xr symlink 2 ,
.Xr symlink 7
.Sh СТАНДАРТЫ
Утилита
.Nm
соответствует
.St -p1003.2-92 .
.Pp
Упрощенная команда
.Nm link
соответствует
.St -susv2 .
.Sh ИСТОРИЯ
Команда
.Nm
появилась в
.At v1 .
