.\"-
.\" Copyright (c) 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" Keith Muller of the University of California, San Diego.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)dd.1	8.2 (Berkeley) 1/13/94
.\"
.\" FRDP path ./bin/dd/dd.1
.\" FRDP githash 90aea514c6249118e880d75972d063362f4bf492
.\" FRDP hash256 9e2056074ebfef6c4e99c8735dc6bb4103efdd0fcb2f353a715180417067d492
.Dd 4 июня, 2020
.Dt DD 1
.Os
.Sh ИМЯ
.Nm dd
.Nd конвертировать и копировать файл
.Sh СИНТАКСИС
.Nm
.Op Ар операнды ...
.Sh ОПИСАНИЕ
Утилита
.Nm
копирует стандартный ввод на стандартный вывод.
Входные данные читаются и записываются блоками по 512 байт.
Если чтения ввода короткие, входные данные из нескольких чтений объединяются,
чтобы сформировать выходной блок.
По завершении,
.Nm
отображает количество полных и частичных входных и выходных блоков
и усечённых входных записей на стандартный вывод ошибок.
.Pp
Доступны следующие операнды:
.It Cm bs Ns = Ns Ар n
Установить размер как входного, так и выходного блока равным
.Ар n
байтам, переопределяя операнды
.Cm ibs
и
.Cm obs .
Если не указаны другие значения преобразования, кроме
.Cm noerror ,
.Cm notrunc
или
.Cm sync ,
то каждый входной блок копируется на выход как
один блок без какого-либо объединения коротких блоков.
.It Cm cbs Ns = Ns Ар n
Установить размер записи преобразования равным
.Ар n
байтам.
Размер записи преобразования требуется для ориентированных на записи значений
преобразования.
.It Cm count Ns = Ns Ар n
Копировать только
.Ар n
входных блоков.
.It Cm files Ns = Ns Ар n
Скопировать
.Ар n
входных файлов перед завершением.
Этот операнд применим только тогда, когда входное устройство является лентой.
.It Cm fillchar Ns = Ns Ар c
При заполнении блока в режиме преобразования или из-за использования режимов
.Cm noerror
и
.Cm sync ,
заполнять указанным символом
.Tn ASCII ,
а не использовать пробел или
.Dv NUL .
.It Cm ibs Ns = Ns Ар n
Установить размер входного блока равным
.Ар n
байтам вместо стандартных 512.
.It Cm if Ns = Ns Ар файл
Читать ввод из
.Ар файла
вместо стандартного ввода.
.It Cm iflag Ns = Ns Ар значение Ns Op , Ns Ар значение ...
Где
.Cm значение
является одним из символов из следующего списка.
.It Cm fullblock
Чтение из входного файла может не получить полный блок.
Когда чтение возвращает короткий результат, продолжать чтение, чтобы заполнить блок.
Без этого флага,
.Cm count
ограничивает количество вызовов
.Xr read 2
на входе, а не количество полностью скопированных блоков.
Не может комбинироваться с
.Cm conv=sync .
.It Cm direct
Установить флаг O_DIRECT на входном файле, чтобы чтение обходило локальное кэширование.
.El
.It Cm iseek Ns = Ns Ар n
Переместиться во входном файле на
.Ар n
блоков.
Это синоним
.Cm skip Ns = Ns Ар n .
.It Cm obs Ns = Ns Ар n
Установить размер выходного блока равным
.Ар n
байтам вместо стандартных 512.
.It Cm of Ns = Ns Ар файл
Записывать вывод в
.Ар файл
вместо стандартного вывода.
Любой обычный выходной файл усекается, если не указано значение преобразования
.Cm notrunc .
Если начальная часть выходного файла пропускается (см. операнд
.Cm oseek ),
выходной файл усекается в этой точке.
.It Cm oflag Ns = Ns Ар значение Ns Op , Ns Ар значение ...
Где
.Cm значение
является одним из символов из следующего списка.
.It Cm fsync
Установить флаг O_FSYNC на выходном файле, чтобы сделать запись синхронной.
.It Cm sync
Установить флаг O_SYNC на выходном файле, чтобы сделать запись синхронной.
Это синоним значения
.Cm fsync .
.It Cm direct
Установить флаг O_DIRECT на выходном файле, чтобы запись обходила локальное кэширование.
.El
.It Cm oseek Ns = Ns Ар n
Переместиться в выходном файле на
.Ар n
блоков.
Это синоним
.Cm seek Ns = Ns Ар n .
.It Cm seek Ns = Ns Ар n
Переместиться на
.Ар n
блоков от начала вывода перед копированием.
На устройствах, не являющихся лентами, используется операция
.Xr lseek 2 .
В противном случае существующие блоки читаются, а данные отбрасываются.
Если у пользователя нет разрешения на чтение ленты, она позиционируется
с использованием вызовов функции
.Xr ioctl 2
для ленты.
Если операция перемещения находится за пределами конца файла, пространство от текущего
конца файла до указанного смещения заполняется блоками
.Dv NUL
байтов.
.It Cm skip Ns = Ns Ар n
Пропустить
.Ар n
блоков от начала ввода перед копированием.
На входе, поддерживающем перемещение, используется операция
.Xr lseek 2 .
В противном случае входные данные читаются и отбрасываются.
Для каналов считывается правильное количество байтов.
Для всех других устройств считывается правильное количество блоков без
различения между частичным или полным читаемым блоком.
.It Cm speed Ns = Ns Ар n
Ограничить скорость копирования до
.Ар n
байт в секунду.
.It Cm status Ns = Ns Ар значение
Где
.Cm значение
является одним из символов из следующего списка.
.It Cm noxfer
Не печатать статистику передачи в качестве последней строки вывода состояния.
.It Cm none
Не печатать вывод состояния.
Сообщения об ошибках отображаются; информационные сообщения - нет.
.It Cm progress
Печатать базовую статистику передачи раз в секунду.
.El
.It Cm conv Ns = Ns Ар значение Ns Op , Ns Ар значение ...
Где
.Cm значение
является одним из символов из следующего списка.
.It Cm ascii , oldascii
То же, что и значение
.Cm unblock ,
за исключением того, что символы переводятся из
.Tn EBCDIC
в
.Tn ASCII
до преобразования записей.
(Эти значения подразумевают
.Cm unblock ,
если также указан операнд
.Cm cbs .)
Существует две карты преобразования для
.Tn ASCII .
Значение
.Cm ascii
определяет рекомендуемую, совместимую с
.At V .
Значение
.Cm oldascii
определяет ту, что использовалась в исторических
.At
и
.No pre- Ns Bx 4.3 reno
системах.
.It Cm block
Рассматривает ввод как последовательность записей переменной длины, завершаемых переводом строки или концом файла, независимо от границ входного и выходного блоков.
Любой завершающий символ новой строки отбрасывается.
Каждая входная запись преобразуется в запись фиксированной длины на выходе, где
длина задаётся операндом
.Cm cbs .
Входные записи короче размера записи преобразования дополняются пробелами.
Входные записи длиннее размера записи преобразования усекаются.
Количество усечённых входных записей, если таковые имеются, выводится на стандартный
вывод ошибок по завершении копирования.
.It Cm ebcdic , ibm , oldebcdic , oldibm
То же, что и значение
.Cm block ,
за исключением того, что символы переводятся из
.Tn ASCII
в
.Tn EBCDIC
после преобразования записей.
(Эти значения подразумевают
.Cm block ,
если также указан операнд
.Cm cbs .)
Существует четыре карты преобразования для
.Tn EBCDIC .
Значение
.Cm ebcdic
определяет рекомендуемую, совместимую с
.At V .
Значение
.Cm ibm
- это немного другое отображение, совместимое со значением
.Cm ibm
.At V .
Значения
.Cm oldebcdic
и
.Cm oldibm
- это карты, использовавшиеся в исторических
.At
и
.No pre- Ns Bx 4.3 reno
системах.
.It Cm fdatasync
Выполнить
.Xr fdatasync 2
для выходного файла перед его закрытием.
.It Cm fsync
Выполнить
.Xr fsync 2
для выходного файла перед его закрытием.
.It Cm lcase
Преобразовывать символы верхнего регистра в символы нижнего регистра.
.It Cm pareven , parnone , parodd , parset
Выводить данные с указанной чётностью.
Бит чётности на входе удаляется, если также не указано преобразование
.Tn EBCDIC
в
.Tn ASCII .
.It Cm noerror
Не останавливать обработку при ошибке ввода.
При возникновении ошибки ввода диагностическое сообщение, за которым следуют текущие
счетчики входных и выходных блоков, будут записаны в стандартный вывод ошибок
в том же формате, что и стандартное сообщение о завершении.
Если также указано преобразование
.Cm sync ,
любые отсутствующие входные данные будут заменены
.Dv NUL
байтами (или пробелами, если было указано ориентированное на блоки значение преобразования) и обработаны как обычный входной буфер.
Если указана опция
.Cm fillchar ,
символ заполнения, указанный в командной строке, будет иметь приоритет
над автоматическим выбором символа заполнения.
Если преобразование
.Cm sync
не указано, входной блок пропускается на выходе.
На входных файлах, не являющихся лентами или каналами, смещение файла
будет установлено за блоком, в котором произошла ошибка, с помощью
.Xr lseek 2 .
.It Cm notrunc
Не усекать выходной файл.
Это позволит сохранить любые блоки в выходном файле, явно не записанные
.Nm .
Значение
.Cm notrunc
не поддерживается для лент.
.It Cm osync
Дополнить последний выходной блок до полного размера выходного блока.
Если входной файл не кратен размеру выходного блока
после преобразования, это преобразование заставляет последний выходной блок
быть того же размера, что и предыдущие блоки, для использования на устройствах, требующих
записи блоков регулярного размера.
Эта опция несовместима с использованием спецификации размера блока
.Cm bs Ns = Ns Ар n .
.It Cm sparse
Если один или несколько выходных блоков будут состоять исключительно из
.Dv NUL
байтов, попытаться переместить выходной файл на необходимое пространство вместо
заполнения их
.Dv NUL Ns сями,
что приводит к разреженному файлу.
.It Cm swab
Менять местами каждую пару входных байтов.
Если входной буфер имеет нечётное число байтов, последний байт будет
проигнорирован при обмене.
.It Cm sync
Дополнять каждый входной блок до размера входного буфера.
Пробелы используются для байтов заполнения, если указано ориентированное на блоки значение преобразования,
в противном случае используются
.Dv NUL
байты.
.It Cm ucase
Преобразовывать символы нижнего регистра в символы верхнего регистра.
.It Cm unblock
Рассматривает ввод как последовательность записей фиксированной длины, независимо от границ входного
и выходного блоков.
Длина входных записей задаётся операндом
.Cm cbs .
Любые завершающие символы пробела отбрасываются, и добавляется символ новой строки.
.El
.El
.Pp
Там, где указаны размеры или скорость, ожидается десятичное, восьмеричное или шестнадцатеричное число
байтов.
Если число оканчивается на
.Dq Li b ,
.Dq Li k ,
.Dq Li m ,
.Dq Li g ,
.Dq Li t ,
.Dq Li p ,
или
.Dq Li w ,
то
число умножается на 512, 1024 (1K), 1048576 (1M), 1073741824 (1G),
1099511627776 (1T), 1125899906842624 (1P)
или количество байтов в целом числе соответственно.
Два или более чисел могут быть разделены символом
.Dq Li x ,
чтобы указать произведение.
.Pp
По завершении,
.Nm
отображает количество полных и частичных входных и выходных блоков,
усечённых входных записей и блоков с нечётной длиной для обмена байтами на
стандартный вывод ошибок.
Частичный входной блок — это блок, в котором было прочитано меньше, чем размер входного блока.
Частичный выходной блок — это блок, в котором было записано меньше, чем размер выходного блока.
Частичные выходные блоки на устройствах лент считаются фатальными ошибками.
В противном случае остаток блока будет записан.
Частичные выходные блоки на символьных устройствах будут вызывать предупреждающее сообщение.
Усечённый входной блок — это блок, в котором было указано ориентированное на записи переменной длины
значение преобразования, и входная строка была слишком длинной для
помещения в запись преобразования или не была завершена символом новой строки.
.Pp
Обычно данные, полученные из ввода или преобразования или обоих, объединяются
в выходные блоки указанного размера.
После достижения конца ввода любые оставшиеся выходные данные записываются как
блок.
Это означает, что последний выходной блок может быть короче размера
выходного блока.
.Pp
Если
.Nm
получает сигнал
.Dv SIGINFO
(см. аргумент
.Cm status
для
.Xr stty 1 ),
текущие счетчики входных и выходных блоков будут
записаны в стандартный вывод ошибок
в том же формате, что и стандартное сообщение о завершении.
Если
.Nm
получает сигнал
.Dv SIGINT ,
текущие счетчики входных и выходных блоков будут
записаны в стандартный вывод ошибок
в том же формате, что и стандартное сообщение о завершении, и
.Nm
завершит работу.
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh ПРИМЕРЫ
Проверить, что дисковый накопитель не содержит плохих блоков:
.Pp
.Pp
Обновить дисковый накопитель, чтобы предотвратить переход в настоящее время
восстанавливаемых ошибок чтения в невосстанавливаемые ошибки чтения:
.Pp
.Pp
Удалить бит чётности из файла:
.Pp
.Pp
Проверить файл на ошибки чётности (чётные):
.Pp
.Pp
Чтобы создать образ CD-ROM режима 1, который является часто используемым форматом
для дисков CD-ROM с данными, используйте размер блока 2048 байт:
.Pp
.Pp
Записать образ файловой системы на USB-флеш-накопитель, при необходимости дополняя конец нулями
до границы 1 МиБ:
.Pp
.Sh СМ. ТАКЖЕ
.Xr cp 1 ,
.Xr mt 1 ,
.Xr recoverdisk 1 ,
.Xr tr 1 ,
.Xr geom 4 ,
.Xr trim 8
.Sh СТАНДАРТЫ
Ожидается, что утилита
.Nm
будет надмножеством стандарта
.St -p1003.2 .
Операнды
.Cm files
и
.Cm status
и значения
.Cm ascii ,
.Cm ebcdic ,
.Cm ibm ,
.Cm oldascii ,
.Cm oldebcdic
и
.Cm oldibm
являются расширениями стандарта
.Tn POSIX .
.Sh ИСТОРИЯ
Команда
.Nm
появилась в
.At v5 .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Механизмы защиты в подсистеме
.Xr geom 4
могут предотвратить запись блоков на диск суперпользователем.
Инструкции по временному отключению этих механизмов защиты можно найти в
странице руководства
.Xr geom 4 .
