.\" @(#)rpcgen.1 1.35 93/06/02 SMI
.\" Copyright 1985-1993 Sun Microsystems, Inc.
.\"
.\" FRDP path ./usr.bin/rpcgen/rpcgen.1
.\" FRDP githash bdcbfde31e8e9b343f113a1956384bdf30d1ed62
.\" FRDP hash256 e8e3bdf749131b30e1e26ddd5aec5598e802b0c6e6ec138a23965cedf4f1ce50
.Dd September 2, 2005
.Dt RPCGEN 1
.Os
.Sh ИМЯ
.Nm rpcgen
.Nd компилятор протокола RPC
.Sh СИНТАКСИС
.Nm
.Ar infile
.Nm
.Op Fl a
.Op Fl b
.Op Fl C
.Oo
.Fl D Ns Ar name Ns Op Ar =value
.Oc
.Op Fl i Ar size
.Op Fl I Fl P Op Fl K Ar seconds
.Op Fl L
.Op Fl M
.Op Fl N
.Op Fl T
.Op Fl Y Ar pathname
.Ar infile
.Nm
.Oo
.Fl c |
.Fl h |
.Fl l |
.Fl m |
.Fl t |
.Fl \&Sc |
.Fl \&Ss |
.Fl \&Sm
.Oc
.Op Fl o Ar outfile
.Op Ar infile
.Nm
.Op Fl s Ar nettype
.Op Fl o Ar outfile
.Op Ar infile
.Nm
.Op Fl n Ar netid
.Op Fl o Ar outfile
.Op Ar infile
.Sh ОПИСАНИЕ
Утилита
.Nm
является инструментом, который генерирует код на C для реализации
протокола
.Tn RPC .
Входные данные для
.Nm
— это язык, подобный C, известный как
.Tn RPC
Language (язык удалённого вызова процедур).
.Pp
Утилита
.Nm
обычно используется, как в первом синтаксисе, где
она принимает входной файл и генерирует три выходных файла.
Если
.Ar infile
имеет имя
.Pa proto.x ,
то
.Nm
генерирует заголовочный файл в
.Pa proto.h ,
подпрограммы XDR в
.Pa proto_xdr.c ,
серверные заглушки в
.Pa proto_svc.c ,
и клиентские заглушки в
.Pa proto_clnt.c .
С опцией
.Fl T ,
она также генерирует таблицу диспетчеризации RPC в
.Pa proto_tbl.i .
.Pp
Утилита
.Nm
также может генерировать примеры клиентских и серверных файлов,
которые могут быть настроены для конкретного приложения.
Опции
.Fl \&Sc ,
.Fl \&Ss
и
.Fl \&Sm
генерируют пример клиента, сервера и Makefile, соответственно.
Опция
.Fl a
генерирует все файлы, включая примеры.
Если
.Ar infile
это
.Pa proto.x ,
то пример клиентского файла записывается в
.Pa proto_client.c ,
пример серверного файла в
.Pa proto_server.c
и пример Makefile в
.Pa makefile.proto .
.Pp
Если установлена опция
.Fl I ,
созданный сервер может быть запущен как мониторами портов
(например,
.Xr inetd 8 )
или самостоятельно.
Когда он запускается монитором портов,
он создаёт серверы только для транспорта, для которого
был передан файловый дескриптор
.Em 0 .
Имя транспорта может быть указано
путём установки переменной окружения
.Ev NLSPROVIDER .
Когда сгенерированный
.Nm
сервер выполняется,
он создаёт серверные обработчики для всех транспортов,
указанных в переменной окружения
.Ev NETPATH ,
или, если она не установлена,
создает серверные обработчики для всех видимых транспортов из
файла
.Pa /etc/netconfig .
Примечание:
транспорты выбираются во время выполнения, а не во время компиляции.
Когда сервер запускается самостоятельно,
он по умолчанию переходит в фоновый режим.
Специальный символ определения
.Em RPC_SVC_FG
может быть использован для запуска серверного процесса на переднем плане.
.Pp
Второй синтаксис предоставляет специальные возможности, которые позволяют
создавать более сложные
.Tn RPC
серверы.
Эти возможности включают поддержку пользовательских
.Em #defines
и таблиц диспетчеризации
.Tn RPC .
Записи в таблице диспетчеризации
.Tn RPC
содержат:
.Bl -bullet -offset indent -compact
.It
указатели на сервисную подпрограмму, соответствующую этой процедуре,
.It
указатель на входные и выходные аргументы,
.It
размер этих подпрограмм.
.El
Сервер может использовать таблицу диспетчеризации для проверки авторизации
и затем выполнения сервисной подпрограммы;
клиентская библиотека может использовать её для обработки деталей управления
памятью и преобразования данных XDR.
.Pp
Остальные три синтаксиса, показанные выше, используются, когда
не нужно генерировать все выходные файлы,
а только определённые.
Смотрите раздел
.Sx ПРИМЕРЫ
ниже для примеров использования
.Nm .
Когда
.Nm
выполняется с опцией
.Fl s ,
она создаёт серверы для этого конкретного класса транспортов.
Когда
выполняется с опцией
.Fl n ,
она создаёт сервер для транспорта, указанного
.Ar netid .
Если
.Ar infile
не указан,
.Nm
принимает стандартный ввод.
.Pp
C-препроцессор,
.Em cc -E
запускается на входном файле перед тем, как он будет интерпретирован
.Nm .
Для каждого типа выходного файла,
.Nm
определяет специальный символ препроцессора для использования
программистом
.Nm :
.Bl -tag -width indent
.It RPC_HDR
определяется при компиляции в заголовки
.It RPC_XDR
определяется при компиляции в подпрограммы XDR
.It RPC_SVC
определяется при компиляции в серверные заглушки
.It RPC_CLNT
определяется при компиляции в клиентские заглушки
.It RPC_TBL
определяется при компиляции в таблицы диспетчеризации RPC
.El
.Pp
Любая строка, начинающаяся с
.Dq %
передаётся непосредственно в выходной файл,
без интерпретации
.Nm .
Чтобы указать путь к C-препроцессору, используйте
флаг
.Fl Y .
.Pp
Для каждого типа данных, упомянутого в
.Ar infile ,
.Nm
предполагает, что существует
подпрограмма со строкой
.Em xdr_
добавленной к имени типа данных.
Если эта подпрограмма не существует в библиотеке
.Tn RPC/XDR ,
она должна быть предоставлена.
Предоставление неопределённого типа данных
позволяет настраивать подпрограммы
.Xr xdr 3 .
.Sh ПАРАМЕТРЫ
Доступны следующие параметры:
.Bl -tag -width indent
.It Fl a
Генерировать все файлы, включая примеры.
.It Fl b
Режим обратной совместимости.
Генерировать транспортно-специфичный код RPC для более старых версий
операционной системы.
.It Fl c
Компилировать в подпрограммы XDR.
.It Fl C
Генерировать код ANSI C.
Это всегда делается, флаг предоставлен только для обратной совместимости.
.It Fl D Ns Ar name
.It Fl D Ns Ar name=value
Определить символ
.Ar name .
Эквивалентно директиве
.Em #define
в исходном коде.
Если
.Ar value
не задано,
.Ar value
определяется как
.Em 1 .
Этот параметр может быть указан более одного раза.
.It Fl h
Компилировать в определения данных C (заголовок).
.Fl T
параметр может быть использован в сочетании для создания
заголовка, который поддерживает таблицы диспетчеризации RPC.
.It Fl i Ar size
Размер, с которого начинать генерацию встроенного кода.
Этот параметр полезен для оптимизации.
По умолчанию размер равен 5.
.Pp
Примечание: для обеспечения обратной совместимости со старыми версиями
.Nm
на платформе
.Fx ,
по умолчанию фактически 0 (что означает,
что генерация встроенного кода отключена по умолчанию).
Вы должны явно указать
ненулевое значение, чтобы переопределить это значение по умолчанию.
.It Fl I
Компилировать поддержку
.Xr inetd 8
в серверных заглушках.
Такие серверы могут быть запущены самостоятельно или могут быть запущены
.Xr inetd 8 .
Когда сервер запускается самостоятельно, он по умолчанию переходит в фоновый режим.
Специальный символ определения
.Em RPC_SVC_FG
может быть использован для запуска
серверного процесса на переднем плане, или пользователь может просто компилировать без
параметра
.Fl I .
.Pp
Если нет ожидающих запросов от клиентов, серверы
.Xr inetd 8
завершаются через 120 секунд (по умолчанию).
Значение по умолчанию может быть изменено с помощью параметра
.Fl K .
Все сообщения об ошибках для серверов
.Xr inetd 8
всегда регистрируются с помощью
.Xr syslog 3 .
.Pp
Примечание:
В отличие от некоторых систем, в
.Fx
этот параметр необходим для генерации
серверов, которые могут быть вызваны через мониторы портов и
.Xr inetd 8 .
.It Fl K Ar seconds
По умолчанию, службы, созданные с помощью
.Nm
и вызываемые через
мониторы портов, ждут 120 секунд
после обработки запроса перед завершением.
Этот интервал может быть изменён с помощью флага
.Fl K .
Чтобы создать сервер, который завершается сразу после обработки запроса,
используйте
.Fl K Ar 0 .
Чтобы создать сервер, который никогда не завершается, соответствующий аргумент —
.Fl K Ar -1 .
.Pp
При мониторинге сервера,
некоторые мониторы портов
.Em всегда
порождают новый процесс в ответ на запрос службы.
Если известно, что сервер будет использоваться с таким монитором, сервер
должен завершаться сразу после выполнения.
Для таких серверов,
.Nm
должен быть использован с
.Fl K Ar 0 .
.It Fl l
Компилировать в клиентские заглушки.
.It Fl L
Когда серверы запускаются на переднем плане, использовать
.Xr syslog 3
для регистрации ошибок сервера вместо вывода их на стандартный
вывод ошибок.
.It Fl m
Компилировать в серверные заглушки,
но не генерировать
.Qq main
подпрограмму.
Этот параметр полезен для реализации обратных вызовов
и для пользователей, которым нужно написать свою собственную
.Qq main
подпрограмму для выполнения инициализации.
.It Fl M
Генерировать многопоточные заглушки для передачи аргументов и результатов между
кодом, сгенерированным rpcgen, и кодом, написанным пользователем.
Этот параметр полезен
для пользователей, которые хотят использовать потоки в своём коде.
Однако, функции
.Xr rpc_svc_calls 3
ещё не являются MT-безопасными, что означает, что сгенерированный rpcgen серверный код
не будет MT-безопасным.
.It Fl N
Разрешить процедурам иметь несколько аргументов.
Также использует стиль передачи параметров, который близко напоминает C.
Таким образом, при передаче аргумента удалённой процедуре, вам не нужно
передавать указатель на аргумент, а можно передать сам аргумент.
Это поведение отличается от старого стиля
.Nm
сгенерированного кода.
Для поддержания обратной совместимости,
этот параметр не является параметром по умолчанию.
.It Fl n Ar netid
Компилировать в серверные заглушки для транспорта,
указанного
.Ar netid .
Должна быть запись для
.Ar netid
в базе данных netconfig.
Этот параметр может быть указан более одного раза,
чтобы скомпилировать сервер, который обслуживает несколько транспортов.
.It Fl o Ar outfile
Указать имя выходного файла.
Если не указано,
используется стандартный вывод
.Fl ( c ,
.Fl h ,
.Fl l ,
.Fl m ,
.Fl n ,
.Fl s ,
.Fl \&Sc ,
.Fl \&Sm ,
.Fl \&Ss ,
и
.Fl t
режимы только).
.It Fl P
Компилировать поддержку
мониторов портов
в серверных заглушках.
.Pp
Примечание:
В отличие от некоторых систем, в
.Fx
этот параметр необходим для генерации
серверов, которые могут быть мониторинги.
.Pp
Если параметр
.Fl I
был указан,
.Fl P
автоматически отключается.
.It Fl s Ar nettype
Компилировать в серверные заглушки для всех
транспортов, принадлежащих классу
.Ar nettype .
Поддерживаемые классы:
.Em netpath ,
.Em visible ,
.Em circuit_n ,
.Em circuit_v ,
.Em datagram_n ,
.Em datagram_v ,
.Em tcp ,
и
.Em udp
(смотрите
.Xr rpc 3
для значений, связанных с этими классами).
Этот параметр может быть указан более одного раза.
Примечание:
транспорты выбираются во время выполнения, а не во время компиляции.
.It Fl \&Sc
Генерировать пример клиентского кода, который использует удалённые вызовы процедур.
.It Fl \&Sm
Генерировать пример
.Pa Makefile ,
который может быть использован для компиляции приложения.
.It Fl \&Ss
Генерировать пример серверного кода, который использует удалённые вызовы процедур.
.It Fl t
Компилировать в таблицу диспетчеризации RPC.
.It Fl T
Генерировать код для поддержки таблиц диспетчеризации RPC.
.Pp
Параметры
.Fl c ,
.Fl h ,
.Fl l ,
.Fl m ,
.Fl s ,
.Fl \&Sc ,
.Fl \&Sm ,
.Fl \&Ss ,
и
.Fl t
используются исключительно для генерации определённого типа файла,
в то время как параметры
.Fl D
и
.Fl T
являются глобальными и могут быть использованы с другими параметрами.
.It Fl Y Ar pathname
Указать имя каталога, где
.Nm
начнёт искать C-препроцессор.
.El
.Sh ОКРУЖЕНИЕ
Если переменная окружения
.Ev RPCGEN_CPP
установлена, её значение используется как командная строка
C-препроцессора, который будет запущен на входном файле.
.Sh ПРИМЕРЫ
Следующий пример:
.Dl example% rpcgen -T prot.x
.Pp
генерирует все пять файлов:
.Pa prot.h ,
.Pa prot_clnt.c ,
.Pa prot_svc.c ,
.Pa prot_xdr.c
и
.Pa prot_tbl.i .
.Pp
Следующий пример отправляет определения данных C (заголовок)
на стандартный вывод.
.Dl example% rpcgen -h prot.x
.Pp
Чтобы отправить тестовую версию с
.Fl D Ns Ar TEST ,
серверные заглушки для
всех транспортов, принадлежащих классу
.Ar datagram_n
на стандартный вывод, используйте:
.Dl example% rpcgen -s datagram_n -DTEST prot.x
.Pp
Чтобы создать серверные заглушки для транспорта, указанного
.Ar netid
tcp,
используйте:
.Dl example% rpcgen -n tcp -o prot_svc.c prot.x
.Sh СМ. ТАКЖЕ
.Xr cc 1 ,
.Xr rpc 3 ,
.Xr rpc_svc_calls 3 ,
.Xr syslog 3 ,
.Xr xdr 3 ,
.Xr inetd 8
.Rs
.%T Глава rpcgen в руководстве NETP
.Re
