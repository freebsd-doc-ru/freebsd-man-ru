.\" Copyright (c) 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)rs.1	8.2 (Berkeley) 12/30/93
.\"
.\" FRDP path ./usr.bin/rs/rs.1
.\" FRDP githash bdcbfde31e8e9b343f113a1956384bdf30d1ed62
.\" FRDP hash256 3568e66e09d9cc73c6f444bf775cfd624c195ccbbc863c8f345ac324ae76cdfe
.Dd 7 апреля 2015
.Dt RS 1
.Os
.Sh ИМЯ
.Nm rs
.Nd преобразование массива данных
.Sh СИНТАКСИС
.Nm
.Oo
.Fl Oo Cm csCS Oc Ns Op Ar x
.Oo Cm kKgGw Oc Ns Op Ar N
.Cm tTeEnyjhHmz
.Oc
.Op Ar строки Op Ar столбцы
.Sh ОПИСАНИЕ
Утилита
.Nm
читает стандартный ввод, интерпретируя каждую строку как строку
массива, состоящую из элементов, разделённых пробелами,
преобразует массив в соответствии с указанными параметрами
и выводит результат на стандартный вывод.
Без аргументов она преобразует потоковый ввод в столбцовый
формат, удобный для просмотра на терминале.
.Pp
Форма входного массива определяется по количеству строк
и количеству столбцов в первой строке.
Если эта форма неудобна, более полезную можно
получить, пропустив часть входных данных с помощью параметра
.Fl k .
Другие параметры управляют интерпретацией входных столбцов.
.Pp
Форма выходного массива определяется указаниями
.Ar строки
и
.Ar столбцы ,
которые должны быть положительными целыми числами.
Если указано только одно положительное целое число,
.Nm
вычисляет значение для другого так, чтобы вместить
все данные.
При необходимости недостающие данные добавляются способом,
указанным параметрами, а избыточные данные удаляются.
Существуют параметры для управления отображением выходных столбцов,
включая транспонирование строк и столбцов.
.Pp
Доступны следующие параметры:
.Bl -tag -width indent
.It Fl c Ns Ar x
Входные столбцы разделяются одиночным символом
.Ar x .
Если
.Ar x
не указан, используется `^I'.
.It Fl s Ns Ar x
Аналогично
.Fl c ,
но в качестве разделителей выступают максимальные последовательности символа
.Ar x .
.It Fl C Ns Ar x
Выходные столбцы разделяются одиночным символом
.Ar x .
Если
.Ar x
не указан, используется `^I'.
.It Fl S Ns Ar x
Аналогично
.Fl C ,
но в качестве разделителей выступают дополненные последовательности символа
.Ar x .
.It Fl t
Заполнять строки выходного массива, используя столбцы
входного массива, то есть транспонировать входные данные с учётом любых
указаний
.Ar строки
и
.Ar столбцы .
.It Fl T
Выводить чистое транспонирование входных данных, игнорируя любые
указания
.Ar строки
или
.Ar столбцы .
.It Fl k Ns Ar N
Игнорировать первые
.Ar N
строк входных данных.
.It Fl K Ns Ar N
Аналогично
.Fl k ,
но выводить игнорируемые строки.
.It Fl g Ns Ar N
Ширина промежутка (межстолбцовое пространство), обычно равная 2, принимается равной
.Ar N .
.It Fl G Ns Ar N
К ширине промежутка добавляется
.Ar N
процентов от максимальной ширины столбца.
.It Fl e
Рассматривать каждую строку входных данных как элемент массива.
.It Fl n
В строках с меньшим количеством элементов, чем в первой строке,
использовать пустые элементы для выравнивания строки.
Обычно недостающие элементы берутся из следующей строки входных данных.
.It Fl y
Если элементов недостаточно для формирования выходных размеров,
дополнить выходные данные, циклически повторяя входные данные с начала.
Обычно выходные данные дополняются пробелами.
.It Fl h
Вывести форму входного массива и больше ничего не делать.
Форма — это просто количество строк и количество
элементов в первой строке.
.It Fl H
Аналогично
.Fl h ,
но также выводит длину каждой строки.
.It Fl j
Выравнивать элементы по правому краю внутри столбцов.
.It Fl w Ns Ar N
Ширина области отображения, обычно равная 80, принимается равной положительному целому числу
.Ar N .
.It Fl m
Не обрезать лишние разделители в концах выходного массива.
.It Fl z
Настраивать ширину столбцов по размеру самого большого элемента, встречающегося в них.
.El
.Pp
Без аргументов
.Nm
транспонирует свои входные данные и предполагает один элемент массива на входную строку,
если первая неигнорируемая строка не длиннее ширины отображения.
Буквы параметров, принимающие числовые аргументы, интерпретируют отсутствующий
аргумент как ноль, если не указано иное.
.Sh ПРИМЕРЫ
Утилиту
.Nm
можно использовать как фильтр для преобразования потокового вывода
некоторых программ (например,
.Xr spell 1 ,
.Xr du 1 ,
.Xr file 1 ,
.Xr look 1 ,
.Xr nm 1 ,
.Xr who 1 ,
и
.Xr wc 1 )
в удобный "оконный" формат, как в
.Bd -literal -offset indent
% who | rs
.Ed
.Pp
Эта функция была встроена в программу
.Xr ls 1 ,
хотя для большинства программ с аналогичным выводом
достаточно
.Nm .
.Pp
Чтобы преобразовать потоковый ввод в векторный вывод и обратно, используйте
.Bd -literal -offset indent
% rs 1 0 | rs 0 1
.Ed
.Pp
Массив случайных чисел от 1 до 100 размером 10 на 10 и
его транспонирование можно сгенерировать с помощью
.Bd -literal -offset indent
% jot \-r 100 | rs 10 10 | tee array | rs \-T > tarray
.Ed
.Pp
В редакторе
.Xr vi 1
файл, состоящий из многострочного вектора с 9 элементами в строке,
может быть подвергнут вставкам и удалениям,
а затем аккуратно преобразован в 9 столбцов с помощью
.Bd -literal -offset indent
:1,$!rs 0 9
.Ed
.Pp
Наконец, чтобы отсортировать базу данных по первой строке каждого поля из 4 строк, можно попробовать
.Bd -literal -offset indent
% rs \-eC 0 4 | sort | rs \-c 0 1
.Ed
.Sh СМ. ТАКЖЕ
.Xr jot 1 ,
.Xr pr 1 ,
.Xr sort 1 ,
.Xr vi 1
.Sh ИСТОРИЯ
Утилита
.Nm
впервые появилась в
.Bx 4.2 .
.Sh АВТОРЫ
.An John A. Kunze
.Sh ИЗВЕСТНЫЕ ОШИБКИ
.Bl -item
.It
Обрабатывает только двумерные массивы.
.It
Текущий алгоритм считывает весь файл в память,
поэтому файлы, не помещающиеся в память, не могут быть преобразованы.
.It
Поля ещё нельзя определять по позициям символов.
.It
Переупорядочивание столбцов пока невозможно.
.It
Слишком много параметров.
.It
Многобайтовые символы не распознаются.
.It
Строки длиннее
.Dv LINE_MAX
(2048) байт не обрабатываются и приводят к немедленному завершению работы
.Nm .
.El
