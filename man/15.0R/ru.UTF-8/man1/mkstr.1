.\" Copyright (c) 1980, 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)mkstr.1	8.1 (Berkeley) 6/6/93
.\"
.\" FRDP path ./usr.bin/mkstr/mkstr.1
.\" FRDP githash bdcbfde31e8e9b343f113a1956384bdf30d1ed62
.\" FRDP hash256 a4ec79b10ce8f2c2cefe3e3c603c8a421f245224ed0b8d392444d266780cde66
.Dd 6 июня 2015
.Dt MKSTR 1
.Os
.Sh ИМЯ
.Nm mkstr
.Nd создание файла сообщений об ошибках путем обработки исходного кода на C
.Sh СИНТАКСИС
.Nm
.Op Fl
.Ar файл_сообщений
.Ar префикс Ar
.Sh ОПИСАНИЕ
Утилита
.Nm
создает файл, содержащий сообщения об ошибках, извлеченные из исходного кода на C,
и реструктурирует тот же исходный код на C для использования созданного файла сообщений об ошибках.
Целью
.Nm
было уменьшение размера больших программ и
снижение свопинга (см. раздел
.Sx ИЗВЕСТНЫЕ ОШИБКИ
ниже).
.Pp
Утилита
.Nm
обрабатывает каждый из указанных файлов,
размещая реструктурированную версию входных данных в файле, имя которого
состоит из указанного
.Ar префикса
и исходного имени.
Типичное использование
.Nm
выглядит так:
.Pp
.Pp
Эта команда приводит к тому, что все сообщения об ошибках из исходных файлов на C
в текущем каталоге помещаются в файл
.Pa pistrings
, а реструктурированные копии исходников размещаются в
файлах, имена которых начинаются с
.Dq Li xx .
.Pp
Опции:
.Bl -tag -width indent
.It Fl
Сообщения об ошибках помещаются в конец указанного
файла сообщений для перекомпиляции части большой
.Nm Ns ed
программы.
.El
.Pp
Утилита
.Nm
находит сообщения об ошибках в исходном коде,
ища строку
во входном потоке.
Каждый раз, когда она встречается, строка C, начинающаяся с
, сохраняется
в файле сообщений, за которым следует нулевой символ и символ новой строки;
Новый исходный код реструктурируется с помощью
указателей
.Xr lseek 2
в файл сообщений об ошибках для извлечения.
.Bd -literal -offset indent
int efil = -1;

error(a1, a2, a3, a4)
{
	char buf[256];

	if (efil < 0) {
		efil = open(efilname, 0);
		if (efil < 0)
	}
	if (lseek(efil, (off_t)a1, SEEK_SET) < 0 ||
	    read(efil, buf, 256) <= 0)
	printf(buf, a2, a3, a4);
}
.Ed
.Sh СМ. ТАКЖЕ
.Xr gencat 1 ,
.Xr xstr 1 ,
.Xr lseek 2
.Sh ИСТОРИЯ
Утилита
.Nm
впервые появилась в
.Bx 1 .
.Sh АВТОРЫ
.An -nosplit
.An Билл Джой
и
.An Чак Хейли ,
1977.
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Утилита
.Nm
была предназначена для ограниченной архитектуры семейства PDP 11.
Очень немногие программы фактически используют её.
Экономия памяти в современных компьютерах незначительна.
