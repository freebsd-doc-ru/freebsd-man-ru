.\" Copyright (c) 1983, 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)gprof.1	8.1 (Berkeley) 6/6/93
.\"
.\" FRDP path ./usr.bin/gprof/gprof.1
.\" FRDP githash bdcbfde31e8e9b343f113a1956384bdf30d1ed62
.\" FRDP hash256 65722c108b4256ced858063632df63c2b57f2fac7ed3d2f29fce9eb1d0297f32
.Dd 27 ноября 2017
.Dt GPROF 1
.Os
.Sh ИМЯ
.Nm gprof
.Nd отображение данных профиля графа вызовов
.Sh СИНТАКСИС
.Nm
.Op Fl abKlLsuz
.Op Fl C Ar количество
.Op Fl e Ar имя
.Op Fl E Ar имя
.Op Fl f Ar имя
.Op Fl F Ar имя
.Op Fl k Ar от_имени к_имени
.Op Ar a.out Op Ar a.out.gmon ...
.Sh ОПИСАНИЕ
Утилита
.Nm
создает профиль выполнения программ на C, Pascal или Fortran77.
Влияние вызываемых подпрограмм учитывается в профиле каждого вызывающего.
Данные профиля берутся из файла профиля графа вызовов,
который создается программами, скомпилированными с опцией
.Fl pg
для
.Xr cc 1 ,
.Xr pc 1 ,
и
.Xr f77 1 .
Опция
.Fl pg
также связывает версии библиотечных подпрограмм,
скомпилированных для профилирования.
По соглашению имена этих библиотек имеют суффикс
.Pa _p ,
т.е. профилируемая версия
.Pa libc.a
это
.Pa libc_p.a ,
и если вы указываете библиотеки непосредственно компилятору или
компоновщику, вы можете использовать
.Fl l Ns Ar c_p
вместо
.Fl l Ns Ar c .
Программа читает заданный объектный файл (по умолчанию
.Pa a.out )
и устанавливает связь между его таблицей символов
и профилем графа вызовов.
Имя файла профиля графа по умолчанию — это имя
исполняемого файла с добавленным суффиксом
.Pa .gmon .
Если указано более одного файла профиля,
вывод
.Nm
показывает сумму информации профиля из заданных файлов профиля.
.Pp
Утилита
.Nm
вычисляет количество времени, проведенного в каждой подпрограмме.
Затем эти времена распространяются по ребрам графа вызовов.
Обнаруживаются циклы, и вызовы в цикле заставляют делить время
цикла.
Первый список показывает функции,
отсортированные в соответствии с представляемым ими временем,
включая время их потомков в графе вызовов.
Под каждой записью функции показаны ее (прямые) потомки в графе вызовов,
и как их времена распространяются на эту функцию.
Аналогичное отображение над функцией показывает, как время этой функции и
время ее потомков распространяется на ее (прямых) предков в графе вызовов.
.Pp
Циклы также показаны, с записью для цикла в целом и
списком членов цикла и их вклада во
время и количество вызовов цикла.
.Pp
Во-вторых, приводится плоский профиль,
аналогичный предоставляемому
.Xr prof 1 .
Этот список дает общее время выполнения, количество вызовов,
время, которое вызов провел в самой подпрограмме, и
время, которое вызов провел в самой подпрограмме, включая
ее потомков.
Единицы измерения для времени на вызов обычно миллисекунды,
но они наносекунды, если частота тактирования профилирования
равна 10 миллионам или больше,
и если функция, по-видимому, никогда не вызывается, то ее общее собственное время
выводится как процент в столбце собственного времени на вызов.
Очень высокие частоты тактирования профилирования, необходимые для получения достаточной
точности во времени на вызов для короткоживущих программ, реализованы только
для
.Dq высокоразрешающего
(не статистического) профилирования ядра.
.Pp
Наконец, предоставляется индекс имен функций.
.Pp
Доступны следующие опции:
.Bl -tag -width indent
.It Fl a
Подавить вывод статически объявленных функций.
Если задана эта опция, вся соответствующая информация о статической функции
(например, временные выборки, вызовы других функций, вызовы из других функций)
принадлежит функции, загруженной непосредственно перед статической функцией в файле
.Pa a.out .
.It Fl b
Подавить вывод описания каждого поля в профиле.
.It Fl C Ar количество
Найти минимальный набор дуг, которые можно разорвать, чтобы устранить все циклы с
.Ar количеством
или более членов.
Внимание: используемый алгоритм разрыва циклов экспоненциальный,
поэтому использование этой опции может заставить
.Nm
работать очень долго.
.It Fl e Ar имя
Подавить вывод записи профиля графа для подпрограммы
.Ar имя
и всех ее потомков
(если только у них нет других неподавленных предков).
Может быть задано более одной опции
.Fl e .
Только одно
.Ar имя
может быть задано с каждой опцией
.Fl e .
.It Fl E Ar имя
Подавить вывод записи профиля графа для подпрограммы
.Ar имя
(и ее потомков), как в
.Fl e
выше, а также исключить время, проведенное в
.Ar имя
(и ее потомках), из вычислений общего времени и процентного времени.
(Например,
.Fl E
.Ar mcount
.Fl E
.Ar mcleanup
используется по умолчанию.)
.It Fl f Ar имя
Вывести запись профиля графа только для указанной подпрограммы
.Ar имя
и ее потомков.
Может быть задано более одной опции
.Fl f .
Только одно
.Ar имя
может быть задано с каждой опцией
.Fl f .
.It Fl F Ar имя
Вывести запись профиля графа только для подпрограммы
.Ar имя
и ее потомков (как в
.Fl f
выше), а также использовать только времена выведенных подпрограмм
в вычислениях общего времени и процентов.
Может быть задано более одной опции
.Fl F .
Только одно
.Ar имя
может быть задано с каждой опцией
.Fl F .
Опция
.Fl F
переопределяет
опцию
.Fl E .
.It Fl k Ar от_имени Ar к_имени
Удалить любые дуги от подпрограммы
.Ar от_имени
к подпрограмме
.Ar к_имени .
Это может использоваться для разрыва нежелательных циклов.
Может быть задано более одной опции
.Fl k .
Только одна пара имен подпрограмм может быть задана с каждой опцией
.Fl k .
.It Fl K
Собрать информацию о символах из текущего запущенного ядра, используя интерфейсы
.Xr sysctl 3
и
.Xr kldsym 2 .
Это заставляет игнорировать аргумент
.Pa a.out
и позволяет использовать символы в модулях
.Xr kld 4 .
.It Fl l
Подавить вывод профиля графа вызовов.
.It Fl L
Подавить вывод плоского профиля.
.It Fl s
Создается файл профиля
.Pa gmon.sum , который представляет
сумму информации профиля во всех указанных файлах профиля.
Этот суммарный файл профиля может быть передан последующим
запускам gprof (возможно, также с опцией
.Fl s )
для накопления данных профиля за несколько запусков файла
.Pa a.out .
.It Fl u
Подавить вывод функций, имена которых не видны
программам на C.
Для формата объектных файлов ELF это означает имена, которые
содержат символ
.Ql .\& .
Для формата объектных файлов a.out это означает имена, которые не
начинаются с символа
.Ql _ .
Вся соответствующая информация о таких функциях принадлежит
(неподавленной) функции со следующим по величине адресом
внутри других функций.
.It Fl z
Отображать подпрограммы с нулевым использованием (как показано счетчиками вызовов
и накопленным временем).
.El
.Sh ФАЙЛЫ
.Bl -tag -width a.out.gmon -compact
.It Pa a.out
Пространство имен и текста.
.It Pa a.out.gmon
Динамический граф вызовов и профиль.
.It Pa gmon.sum
Суммарный динамический граф вызовов и профиль.
.El
.Sh СМ. ТАКЖЕ
.Xr cc 1 ,
.Xr profil 2 ,
.Xr clocks 7 ,
.Xr pmcstat 8
.Rs
.%A S. Graham
.%A P. Kessler
.%A M. McKusick
.%V 13
.%P pp. 671-685
.%D 1983
.Re
.Rs
.%A S. Graham
.%A P. Kessler
.%A M. McKusick
.%V 17
.%N 6
.%P pp. 120-126
.%D June 1982
.Re
.Sh ИСТОРИЯ
Профилировщик
.Nm
появился в
.Bx 4.2 .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Гранулярность выборки показана, но остается
в лучшем случае статистической.
Мы предполагаем, что время каждого выполнения функции
может быть выражено общим временем функции, деленным
на количество раз, когда функция вызывалась.
Таким образом, время, распространяемое по дугам графа вызовов к предкам функции,
прямо пропорционально количеству прохождений этой
дуги.
.Pp
Предки, которые сами не профилируются, получат распространенное время
их профилируемых потомков, но они будут появляться
как спонтанно вызванные в списке графа вызовов, и их
время не будет распространяться дальше.
Аналогично, перехватчики сигналов, даже если профилируются, будут появляться
как спонтанные (хотя по более obscure причинам).
Любые профилируемые потомки перехватчиков сигналов должны иметь свои времена
распространенными правильно, если только перехватчик сигнала не был вызван во время
выполнения подпрограммы профилирования, в этом случае все потеряно.
.Pp
Профилируемая программа должна вызывать
.Xr exit 3
или возвращаться нормально, чтобы информация профилирования была сохранена
в файле профиля графа.
