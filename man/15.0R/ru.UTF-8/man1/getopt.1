.\"
.\" FRDP path ./usr.bin/getopt/getopt.1
.\" FRDP githash b2c76c41be32f904179efed29c0ca04d53f3996c
.\" FRDP hash256 aca378f9e06a249382a0d81fe5ac62fd322d0a6d75e7ebdeb4b4b8cb8b2c5308
.Dd 1 августа 2015
.Dt GETOPT 1
.Os
.Sh ИМЯ
.Nm getopt
.Nd разбор опций командной строки
.Sh СИНТАКСИС
.Nm args=\`getopt Ar строка_опций $*\`
; errcode=$?; set \-\- $args
.Sh ОПИСАНИЕ
Утилита
.Nm
используется для разделения опций в командных строках для удобного
разбора процедурами оболочки, а также для проверки допустимости опций.
.Ar Строка_опций
представляет собой строку распознаваемых букв опций (см.
.Xr getopt 3 ) ;
если за буквой следует двоеточие, ожидается, что опция
имеет аргумент, который может быть отделён от неё пробелом или нет.
Специальная опция
.Ql \-\-
используется для обозначения конца опций.
Утилита
.Nm
поместит
.Ql \-\-
в аргументы в конце опций
или распознает её, если она используется явно.
Аргументы оболочки
(\fB$1 $2\fR ...) сбрасываются так, что каждая опция
предваряется символом
.Ql \-
и находится в собственном аргументе оболочки;
каждый аргумент опции также находится в собственном аргументе оболочки.
.Sh СТАТУС ВЫХОДА
Утилита
.Nm
выводит сообщение об ошибке на стандартный вывод ошибок и завершается со
статусом > 0, когда встречает букву опции, не входящую в
.Ar строка_опций .
.Sh ПРИМЕРЫ
Следующий фрагмент кода показывает, как можно обрабатывать аргументы
для команды, которая принимает опции
.Fl a
и
.Fl b ,
а также опцию
.Fl o ,
требующую аргумента.
.Bd -literal -offset indent
args=\`getopt abo: $*\`
# аргументы по-другому, чем делает команда set ниже.
if [ $? -ne 0 ]; then
	echo 'Использование: ...'
	exit 2
fi
set \-\- $args
# Нельзя использовать команду set непосредственно с getopt в обратных кавычках,
# так как код выхода от getopt был бы скрыт кодом выхода от set,
# который по определению равен нулю.
while :; do
	\-a|\-b)
		shift
		;;
	\-o)
		shift; shift
		;;
	\-\-)
		shift; break
		;;
	esac
done
.Ed
.Pp
Этот код будет принимать любые из следующих вариантов как эквивалентные:
.Bd -literal -offset indent
cmd \-aoarg file1 file2
cmd \-a \-o arg file1 file2
cmd \-oarg -a file1 file2
cmd \-a \-oarg \-\- file1 file2
.Ed
.Sh СМ. ТАКЖЕ
.Xr getopts 1 ,
.Xr sh 1 ,
.Xr getopt 3
.Sh ИСТОРИЯ
Написана
.An Henry Spencer ,
на основе страницы руководства из Bell Labs.
Поведение считается идентичным версии Bell.
Пример изменён в версиях
.Fx
3.2 и 4.0.
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Те же, что и у
.Xr getopt 3 .
.Pp
Аргументы, содержащие пробелы или встроенные метасимволы оболочки,
обычно не сохраняются в целости; это кажется легко исправить, но
это не так.
Люди, пытающиеся исправить
.Nm
или пример на этой странице руководства, должны проверить историю этого файла
в
.Fx .
.Pp
Сообщение об ошибке для недопустимой опции идентифицируется как исходящее
от
.Nm ,
а не от процедуры оболочки, содержащей вызов
.Nm ;
это также трудно исправить.
.Pp
Точный наилучший способ использования команды
.Nm set
для установки аргументов без нарушения значения (значений)
опций оболочки варьируется от одной версии оболочки к другой.
.Pp
Каждый скрипт оболочки должен содержать сложный код для более-менее
правильного разбора аргументов (как в примере, представленном здесь).
Более совершенный инструмент, подобный getopt,
перенёс бы большую часть сложности в сам инструмент и оставил бы
клиентские скрипты оболочки более простыми.
