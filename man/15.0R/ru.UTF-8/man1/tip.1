.\"	$OpenBSD: tip.1,v 1.37 2006/06/07 06:35:59 mbalmer Exp $
.\"	$NetBSD: tip.1,v 1.7 1994/12/08 09:31:05 jtc Exp $
.\"
.\" Copyright (c) 1980, 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)tip.1	8.4 (Berkeley) 4/18/94
.\"
.\" FRDP path ./usr.bin/tip/tip/tip.1
.\" FRDP githash bdcbfde31e8e9b343f113a1956384bdf30d1ed62
.\" FRDP hash256 e4b3e3b8fe3cdb3d1fb8b69c7df52e1bb6b9f4e3577c077d2d946e71da4f90d4
.Dd 28 апреля 2018
.Dt TIP 1
.Os
.Sh ИМЯ
.Nm tip
.Nd подключение к удалённой системе
.Sh СИНТАКСИС
.Nm
.Op Fl nv
.Op Fl Ar скорость
.Op Ar имя-системы
.Sh ОПИСАНИЕ
Утилита
.Nm
устанавливает полнодуплексное соединение с другой машиной, создавая впечатление прямого входа в систему на удалённом ЦП.
Само собой разумеется, у вас должна быть учётная запись на машине (или её эквивалент), к которой вы хотите подключиться.
.Pp
Параметры:
.Bl -tag -width indent
.It Fl n
Без escape-символа (отключить тильду).
.It Fl v
Установить подробный режим.
.El
.Pp
Если указана
.Ar скорость ,
она переопределит любую скорость передачи, указанную в используемом описании системы.
.Pp
Если не указаны ни
.Ar скорость ,
ни
.Ar имя-системы ,
значение
.Ar имя-системы
будет установлено из переменной окружения
.Ev HOST .
.Pp
Если указана
.Ar скорость ,
но не указано
.Ar имя-системы ,
значение
.Ar имя-системы
будет установлено в
.Dq Li tip
с добавлением
.Ar скорости .
Например,
.Nm Fl 1200
установит
.Ar имя-системы
в
.Dq Li tip1200 .
.Pp
Введённые символы обычно передаются напрямую на удалённую машину (которая также выполняет эхо-вывод).
Тильда
.Pq Ql ~ ,
появляющаяся первым символом строки, является escape-сигналом; распознаются следующие последовательности:
.Bl -tag -width indent
.It Ic ~^D No или Ic ~.
Разорвать соединение и выйти.
Только соединение разрывается — сеанс входа в систему не завершается.
.It Ic ~c Op Ar имя
Сменить каталог на
.Ar имя
(без аргумента означает переход в домашний каталог).
.It Ic ~!
Выйти в оболочку (выход из оболочки вернёт в
.Nm ) .
.It Ic ~>
Копировать файл с локальной машины на удалённую.
Утилита
.Nm
запрашивает имя локального файла для передачи.
.It Ic ~<
Копировать файл с удалённой машины на локальную.
Утилита
.Nm
сначала запрашивает имя отправляемого файла, затем команду для выполнения на удалённой машине.
.It Ic ~p Ar откуда Op Ar куда
Отправить файл на удалённый хост
.Ux .
Эта команда заставляет удалённую систему
.Ux
выполнить следующую строку команды, отправляя ей файл
.Ar откуда :
.Pp
.Pp
Если файл
.Ar куда
не указан, используется имя файла
.Ar откуда .
Эта команда, по сути, является версией команды
.Ic ~>
специфичной для
.Ux .
.It Ic ~t Ar откуда Op Ar куда
Принять файл с удалённого хоста
.Ux .
Как и в команде
.Ic ~p ,
файл
.Ar куда
по умолчанию совпадает с именем файла
.Ar откуда ,
если он не указан.
Удалённый хост выполняет следующую строку команды, чтобы отправить файл в
.Nm :
.Pp
.It Ic ~|
Перенаправить вывод удалённой команды в локальный процесс
.Ux .
Строка команды, отправленная в локальную систему
.Ux ,
обрабатывается оболочкой.
.It Ic ~$
Перенаправить вывод локального процесса
.Ux
на удалённый хост.
Строка команды, отправленная в локальную систему
.Ux ,
обрабатывается оболочкой.
.It Ic ~C
Породить дочерний процесс в локальной системе для выполнения специальных протоколов, таких как
.Tn XMODEM .
Дочерняя программа будет запущена со следующей организацией файловых дескрипторов:
.Bd -literal -offset indent
0 <-> удалённый tty вход
1 <-> удалённый tty выход
2 <-> локальный tty stderr
.Ed
.It Ic ~#
Послать
.Dv BREAK
на удалённую систему.
Для систем, которые не поддерживают необходимый вызов
.Fn ioctl ,
BREAK имитируется последовательностью изменений скорости линии и символов
.Dv DEL .
.It Ic ~s
Установить переменную (см. обсуждение ниже).
.It Ic ~v
Вывести список всех переменных и их значений (если установлены).
.It Ic ~^Z
Остановить
.Nm
(доступно только с управлением заданиями).
.It Ic ~^Y
Остановить только
сторону ввода
.Nm
(доступно только с управлением заданиями); сторона вывода
.Nm ,
которая отображает вывод с удалённого хоста, продолжает работать.
.It Ic ~?
Получить сводку по escape-последовательностям с тильдой.
.El
.Pp
Чтобы найти описание системы и, следовательно, рабочие характеристики
.Ar имя-системы ,
.Nm
ищет описание системы с именем, идентичным
.Ar имя-системы .
Порядок поиска следующий:
.Bl -enum -offset indent
.It
Если переменная окружения
.Ev REMOTE
не начинается с
.Ql / ,
она считается описанием системы и рассматривается первой.
.It
Если переменная окружения
.Ev REMOTE
начинается с
.Ql / ,
она считается путём к базе данных
.Xr remote 5 ,
и выполняется поиск в указанной базе данных.
.It
Выполняется поиск в базе данных
.Xr remote 5
по умолчанию,
.Pa /etc/remote .
.El
.Pp
Полную документацию по описаниям систем см. в
.Xr remote 5 .
.Pp
Возможность
.Va br
используется в описаниях систем для указания скорости передачи, с которой устанавливается соединение.
Если указанное значение не подходит, скорость передачи, которую следует использовать, может быть задана в командной строке, например:
.Pp
Когда
.Nm
устанавливает соединение, он отправляет сообщение о соединении, указанное в возможности
.Va cm
используемого описания системы.
.Pp
Когда
.Nm
запрашивает аргумент, например, во время настройки передачи файла, введённую строку можно редактировать стандартными символами стирания и удаления.
Пустая строка в ответ на запрос или прерывание прервёт диалог и вернёт пользователя к удалённой машине.
.Pp
Утилита
.Nm
защищает от подключения нескольких пользователей к удалённой системе, открывая модемы и терминальные линии с эксклюзивным доступом, а также соблюдая протокол блокировки, используемый
.Xr uucico 8 Pq Pa ports/net/freebsd-uucp .
.Pp
Во время передачи файлов
.Nm
предоставляет текущий счётчик количества переданных строк.
При использовании команд
.Ic ~>
и
.Ic ~<
переменные
.Va eofread
и
.Va eofwrite
используются для распознавания конца файла при чтении и указания конца файла при записи (см. ниже).
Передача файлов обычно зависит от аппаратного управления потоком или тандемного режима для управления потоком.
Если удалённая система не поддерживает аппаратное управление потоком или тандемный режим,
может быть установлена переменная
.Va echocheck ,
чтобы указать, что
.Nm
должен синхронизироваться с удалённой системой по эху каждого переданного символа.
.Pp
Когда
.Nm
должен набрать номер телефона для подключения к системе, он будет выводить различные сообщения, указывающие на его действия.
Утилита
.Nm
поддерживает различные автонабиратели и модемы с возможностью
.Va at
в описаниях систем.
.Pp
Поддержка Ventel 212+ (ventel), Hayes AT-style (hayes),
USRobotics Courier (courier), Telebit T3000 (t3000) и
Racal-Vadic 831 (vadic) включена по умолчанию.
.Pp
Поддержку для Bizcomp 1031[fw] (biz31[fw]), Bizcomp 1022[fw]
(biz22[fw]), DEC DF0[23]-AC (df0[23]), DEC DN-11 (dn11) и
Racal-Vadic 3451 (v3451) можно добавить, пересобрав
.Nm
с соответствующими директивами.
.Pp
Обратите внимание, что если поддержка как Racal-Vadic 831, так и 3451 включена,
они называются v831 и v3451 соответственно.
Если поддерживается только один из двух, он называется vadic.
.Ss Переменные
Утилита
.Nm
поддерживает набор переменных, которые управляют её работой.
Некоторые из этих переменных доступны только для чтения обычным пользователям (root может изменять всё, что представляет интерес).
Переменные можно отображать и устанавливать с помощью escape-последовательности
.Ic ~s .
Синтаксис переменных построен по образцу
.Xr vi 1
и
.Xr Mail 1 .
Указание
.Dq Li all
в качестве аргумента команды set отображает все переменные, доступные для чтения пользователю.
Кроме того, пользователь может запросить отображение конкретной переменной, добавив в конец
.Ql \&? .
Например,
.Dq Li escape?
отображает текущий escape-символ.
.Pp
Переменные бывают числовыми, строковыми, символьными или логическими.
Логические переменные устанавливаются простым указанием их имени; их можно сбросить, добавив перед именем
.Ql \&! .
Другие типы переменных устанавливаются путём добавления
.Ql =
и значения.
Во всём присваивании не должно быть пробелов.
Одна команда set может использоваться как для запроса, так и для установки нескольких переменных.
Переменные могут быть инициализированы во время выполнения путём размещения команд set
(без префикса
.Ic ~s )
в файле инициализации
.Pa ~/.tiprc ;
параметр
.Fl v
дополнительно заставляет
.Nm
отображать установки по мере их выполнения.
Некоторые распространённые переменные имеют сокращения.
Следующий список представляет распространённые переменные, их сокращения и значения по умолчанию:
.Bl -tag -width indent
.It Va baudrate
.Pq Vt num
Скорость передачи, на которой было установлено соединение;
сокращённо
.Va ba .
.It Va beautify
.Pq Vt bool
Отбрасывать непечатаемые символы при ведении журнала сеанса;
сокращённо
.Va be .
.It Va dialtimeout
.Pq Vt num
При наборе номера телефона время (в секундах) ожидания установления соединения;
сокращённо
.Va dial .
.It Va echocheck
.Pq Vt bool
Синхронизироваться с удалённым хостом во время передачи файла,
ожидая эхо последнего переданного символа; по умолчанию
.Cm off .
.It Va eofread
.Pq Vt str
Набор символов, обозначающих конец передачи во время
команды передачи файла
.Ic ~< ;
сокращённо
.Va eofr .
.It Va eofwrite
.Pq Vt str
Строка, отправляемая для обозначения конца передачи во время
команды передачи файла
.Ic ~> ;
сокращённо
.Va eofw .
.It Va eol
.Pq Vt str
Набор символов, обозначающих конец строки.
Утилита
.Nm
будет распознавать escape-символы только после конца строки.
.It Va escape
.Pq Vt char
Символ префикса команды (escape);
сокращённо
.Va es ;
значение по умолчанию —
.Ql ~ .
.It Va exceptions
.Pq Vt str
Набор символов, которые не должны отбрасываться из-за
переключателя beautify;
сокращённо
.Va ex ;
значение по умолчанию —
.Dq Li \et\en\ef\eb .
.It Va force
.Pq Vt char
Символ, используемый для принудительной передачи литеральных данных;
сокращённо
.Va fo ;
значение по умолчанию —
.Ql ^P .
.It Va framesize
.Pq Vt num
Объём данных (в байтах) для буферизации между записями в файловую систему
при приёме файлов;
сокращённо
.Va fr .
.It Va hardwareflow
.Pq Vt bool
Включено ли аппаратное управление потоком (CRTSCTS) для
соединения;
сокращённо
.Va hf ;
значение по умолчанию —
.Cm off .
.It Va host
.Pq Vt str
Имя хоста, к которому вы подключены;
сокращённо
.Va ho .
.It Va linedisc
.Pq Vt num
Используемая дисциплина линии;
сокращённо
.Va ld .
.It Va prompt
.Pq Vt char
Символ, обозначающий конец строки на удалённом
хосте;
сокращённо
.Va pr ;
значение по умолчанию —
.Ql \en .
Это значение используется для синхронизации во время передачи данных.
Счётчик строк, переданных во время команды передачи файла, основан
на получении этого символа.
.It Va raise
.Pq Vt bool
Режим отображения в верхний регистр;
сокращённо
.Va ra ;
значение по умолчанию —
.Cm off .
Когда этот режим включён, все строчные буквы будут отображаться в
верхний регистр в
.Nm
для передачи на удалённую машину.
.It Va raisechar
.Pq Vt char
Входной символ, используемый для переключения режима отображения в верхний регистр;
сокращённо
.Va rc ;
по умолчанию не установлен.
.It Va record
.Pq Vt str
Имя файла, в который записывается журнал сеанса;
сокращённо
.Va rec ;
значение по умолчанию —
.Pa tip.record .
.It Va script
.Pq Vt bool
Режим ведения журнала сеанса;
сокращённо
.Va sc ;
по умолчанию
.Cm off .
Когда
.Va script
равно
.Cm true ,
.Nm
будет записывать всё, переданное удалённой машиной, в файл журнала,
указанный в
.Va record .
Если переключатель
.Va beautify
включён, в файл журнала будут включаться только печатаемые
.Tn ASCII
символы (символы между 040 и 0177).
Переменная
.Va exceptions
используется для указания символов, которые являются исключением из обычных
правил beautify.
.It Va tabexpand
.Pq Vt bool
Разворачивать табуляции в пробелы во время передачи файлов;
сокращённо
.Va tab ;
значение по умолчанию —
.Cm false .
Каждая табуляция разворачивается в 8 пробелов.
.It Va tandem
.Pq Vt bool
Использовать управление потоком XON/XOFF для регулирования данных с удалённого хоста;
сокращённо
.Va ta .
Значение по умолчанию —
.Cm true ,
если только возможность
.Va nt
не была указана в
.Pa /etc/remote ,
в этом случае значение по умолчанию —
.Cm false .
.It Va verbose
.Pq Vt bool
Подробный режим;
сокращённо
.Va verb ;
по умолчанию
.Cm true .
Когда подробный режим включён,
.Nm
выводит сообщения при наборе номера, показывает текущее количество строк,
переданных во время операций передачи файлов, и многое другое.
.El
.Sh ОКРУЖЕНИЕ
.Bl -tag -width indent
.It Ev HOME
Домашний каталог для использования в команде
.Ic ~c .
.It Ev HOST
Значение по умолчанию для
.Ar имя-системы ,
если оно не указано через командную строку.
.It Ev PHONES
Путь к базе данных
.Xr phones 5 .
.It Ev REMOTE
Описание системы или абсолютный путь к базе данных описаний систем
.Xr remote 5 .
.It Ev SHELL
Имя оболочки для использования в команде
.Ic ~! ;
значение по умолчанию —
.Dq Li /bin/sh .
.El
.Sh ФАЙЛЫ
.It Pa ~/.tiprc
файл инициализации
.It Pa tip.record
файл журнала
.It Pa /etc/phones
файл
.Xr phones 5
по умолчанию
.It Pa /etc/remote
глобальная база данных
.Xr remote 5
.It Pa /var/log/aculog
журнал доступа к линии
.It Pa /var/spool/lock/LCK..*
файл блокировки для избежания конфликтов с
.Xr uucp 1 Pq Pa ports/net/freebsd-uucp
.El
.Sh ПРИМЕРЫ
Подключиться к первому последовательному порту USB на скорости 115200 бод:
.Bd -literal -offset indent
tip ucom1 -115200
.Ed
.Sh СМ. ТАКЖЕ
.Xr cu 1 ,
.Xr phones 5 ,
.Xr remote 5
.Sh ИСТОРИЯ
Команда
.Nm
появилась в
.Bx 4.2 .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Полный набор переменных не документирован и, вероятно, должен быть сокращён.
