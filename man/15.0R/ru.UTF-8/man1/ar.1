.\" Copyright (c) 2007,2009-2012 Joseph Koshy.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" This software is provided by Joseph Koshy ``as is'' and
.\" any express or implied warranties, including, but not limited to, the
.\" implied warranties of merchantability and fitness for a particular purpose
.\" are disclaimed.  in no event shall Joseph Koshy be liable
.\" for any direct, indirect, incidental, special, exemplary, or consequential
.\" damages (including, but not limited to, procurement of substitute goods
.\" or services; loss of use, data, or profits; or business interruption)
.\" however caused and on any theory of liability, whether in contract, strict
.\" liability, or tort (including negligence or otherwise) arising in any way
.\" out of the use of this software, even if advised of the possibility of
.\" such damage.
.\"
.\" $Id: ar.1 3642 2018-10-14 14:24:28Z jkoshy $
.\"
.\" FRDP path ./contrib/elftoolchain/ar/ar.1
.\" FRDP githash ae500c1ff8974130f7f2692772cf288b90349e0d
.\" FRDP hash256 ee041fc76a53e1fb954212bafd5b77b89ff6574d2c10ffeca44d5ad6cd84cba5
.Dd 30 сентября 2018
.Dt AR 1
.Os
.Sh ИМЯ
.Nm ar
.Nd управление архивами
.Sh СИНТАКСИС
.Nm
.Fl d
.Op Fl f
.Op Fl j
.Op Fl T
.Op Fl v
.Op Fl z
.Ar архив
.Ar
.Nm
.Fl m
.Op Fl a Ar позиция-после
.Op Fl b Ar позиция-до
.Op Fl f
.Op Fl i Ar позиция-до
.Op Fl j
.Op Fl s | Fl S
.Op Fl T
.Op Fl z
.Ar архив
.Ar
.Nm
.Fl p
.Op Fl f
.Op Fl s
.Op Fl T
.Op Fl v
.Ar архив
.Op Ar
.Nm
.Fl q
.Op Fl c
.Op Fl D
.Op Fl f
.Op Fl F Ar вариант | Fl -flavor Ar вариант
.Op Fl s | Fl S
.Op Fl T
.Op Fl U
.Op Fl v
.Op Fl z
.Ar архив
.Ar
.Nm
.Fl r
.Op Fl a Ar позиция-после
.Op Fl b Ar позиция-до
.Op Fl c
.Op Fl D
.Op Fl f
.Op Fl F Ar вариант | Fl -flavor Ar вариант
.Op Fl i Ar позиция-до
.Op Fl j
.Op Fl s | Fl S
.Op Fl T
.Op Fl u
.Op Fl U
.Op Fl v
.Op Fl z
.Ar архив
.Ar
.Nm
.Fl s
.Op Fl D
.Op Fl j
.Op Fl U
.Op Fl z
.Ar архив
.Nm
.Fl t
.Op Fl f
.Op Fl s
.Op Fl T
.Op Fl v
.Ar архив
.Op Ar
.Nm
.Fl x
.Op Fl C
.Op Fl f
.Op Fl o
.Op Fl s
.Op Fl T
.Op Fl u
.Op Fl v
.Ar архив
.Op Ar
.Nm
.Fl M
.Nm
.Fl V
.Sh ОПИСАНИЕ
Утилита
.Nm
создает и обслуживает группы файлов, объединенных в архив.
После создания архива в него можно добавлять новые файлы,
а существующие файлы можно извлекать, удалять или заменять.
.Pp
Файлы в архиве именуются по последнему компоненту их имени,
поэтому если архивируется файл, указанный путем, содержащим
.Dq / ,
он будет назван по последнему компоненту пути.
Аналогично, при сопоставлении путей, указанных в командной строке,
с именами файлов, хранящихся в архиве, будет сравниваться только
последний компонент пути.
.Pp
Обычно
.Nm
используется для создания и обслуживания библиотек, пригодных для
использования с редактором связей
.Xr ld 1 ,
хотя не ограничивается этой целью.
Утилита
.Nm
может создавать и управлять таблицей символов архива (см.
.Xr ar 5 ),
используемой для ускорения операций редактирования связей.
Если таблица символов присутствует в архиве, она будет
поддерживаться в актуальном состоянии последующими операциями над архивом.
.Sh ПАРАМЕТРЫ
Утилита
.Nm
поддерживает следующие параметры:
.Bl -tag -width indent
.It Fl a Ar член-после
При использовании с параметром
.Fl m
этот параметр указывает, что члены архива, указанные аргументами
.Ar ,
перемещаются после члена архива, указанного аргументом
.Ar член-после .
При использовании с параметром
.Fl r
этот параметр указывает, что файлы, указанные аргументами
.Ar ,
добавляются после члена архива, указанного аргументом
.Ar член-после .
.It Fl b Ar член-до
При использовании с параметром
.Fl m
этот параметр указывает, что члены архива, указанные аргументами
.Ar ,
перемещаются до члена архива, указанного аргументом
.Ar член-до .
При использовании с параметром
.Fl r
этот параметр указывает, что файлы, указанные аргументами
.Ar ,
добавляются до члена архива, указанного аргументом
.Ar член-до .
.It Fl c
Подавлять информационное сообщение, выводимое при создании нового архива
с помощью параметров
.Fl r
и
.Fl q .
.It Fl C
Запрещать извлеченным файлам заменять одноименные файлы
в файловой системе.
.It Fl d
Удалить членов, указанных аргументами
.Ar ,
из архива, указанного аргументом
.Ar архив .
Таблица символов архива, если она присутствует, обновляется в соответствии
с новым содержимым архива.
.It Fl D
При использовании в комбинации с параметром
.Fl r
или
.Fl q
вставлять 0 вместо реальных значений mtime, uid и gid
и 0644 вместо режима файла из членов, указанных аргументами
.Ar .
Это гарантирует, что контрольные суммы результирующих архивов будут
воспроизводимыми, когда содержимое членов идентично.
Если несколько параметров
.Fl D
и
.Fl U
указаны в командной строке, последний имеет приоритет.
.It Fl f
Синоним параметра
.Fl T .
.It Fl F Ar вариант | Fl -flavor Ar вариант
Создавать архивы с указанным форматом архива.
Допустимые значения для аргумента
.Ar вариант :
.Bl -tag -width indent -compact
.It Ar bsd
Создавать архивы формата BSD.
.It Ar gnu
Псевдоним для
.Ar svr4 .
.It Ar svr4
Создавать архивы формата SVR4.
.El
Если этот параметр не указан,
.Nm
будет создавать архивы в формате SVR4.
.It Fl i Ar член-до
Синоним параметра
.Fl b .
.It Fl j
Этот параметр принимается для совместимости с версией
.Nm
в
.Tn FreeBSD ,
но игнорируется.
.It Fl l
Этот параметр принимается для совместимости с GNU
.Xr ar 1 ,
но игнорируется.
.It Fl m
Переместить членов архива, указанных аргументами
.Ar ,
внутри архива.
Если позиция была указана одним из параметров
.Fl a ,
.Fl b
или
.Fl i ,
члены перемещаются до или после указанной позиции.
Если позиция не была указана, указанные члены перемещаются
в конец архива.
Если архив имеет таблицу символов, она обновляется в соответствии с
новым содержимым архива.
.It Fl M
Читать и выполнять команды библиотекаря MRI из стандартного ввода.
Команды, понимаемые утилитой
.Nm ,
описаны в разделе
.It Fl o
Сохранять исходные времена модификации членов при их извлечении.
.It Fl p
Вывести содержимое указанных членов архива, указанных аргументами
.Ar ,
на стандартный вывод.
Если члены не были указаны, содержимое всех файлов в архиве
выводится в порядке их появления в архиве.
.It Fl q
Добавить файлы, указанные аргументами
.Ar ,
в архив, указанный аргументом
.Ar архив ,
без проверки наличия файлов в архиве.
Таблица символов архива будет обновляться по мере необходимости.
Если файл, указанный аргументом
.Ar архив ,
еще не существует, будет создан новый архив.
.It Fl r
Заменить (добавить) файлы, указанные аргументами
.Ar ,
в архиве, указанном аргументом
.Ar архив ,
создав архив при необходимости.
Замена существующих членов не изменит порядок членов в архиве.
Если файл, указанный в аргументах
.Ar ,
не существует, существующие члены в архиве, совпадающие с этим
именем, не изменяются.
Новые файлы добавляются в конец архива, если не указан один из
параметров позиционирования
.Fl a ,
.Fl b
или
.Fl i .
Таблица символов архива, если она существует, обновляется в соответствии с
новым состоянием архива.
.It Fl s
Добавить таблицу символов архива (см.
.Xr ar 5 )
к архиву, указанному аргументом
.Ar архив .
Вызов
.Nm
с параметром
.Fl s
эквивалентен вызову
.Xr ranlib 1 .
.It Fl S
Не генерировать таблицу символов архива.
.It Fl t
Для
.Nm
вывести список файлов, указанных аргументами
.Ar ,
в порядке их появления в архиве, по одному в строке.
Если файлы не указаны, выводятся все файлы в архиве.
.It Fl T
Использовать только первые пятнадцать символов имени члена архива или
аргумента командной строки с именем файла при именовании членов архива.
.It Fl u
Условно обновлять архив или извлекать членов.
При использовании с параметром
.Fl r
файлы, указанные аргументами
.Ar ,
будут заменены в архиве, если они новее их
архивных версий.
При использовании с параметром
.Fl x
члены, указанные аргументами
.Ar ,
будут извлечены только если они новее соответствующих
файлов в файловой системе.
.It Fl U
При использовании в комбинации с параметром
.Fl r
или
.Fl q
вставлять реальные значения mtime, uid и gid, а также режима файла
из членов, указанных аргументами
.Ar .
Если несколько параметров
.Fl D
и
.Fl U
указаны в командной строке, последний имеет приоритет.
.It Fl v
Обеспечивать подробный вывод.
При использовании с параметрами
.Fl d ,
.Fl m ,
.Fl q
или
.Fl x ,
.Nm
дает пофайловое описание выполняемой модификации архива, которое состоит
из трех полей, разделенных пробелами:
буква параметра, дефис
и имя файла.
При использовании с параметром
.Fl r ,
.Nm
отображает описание, как указано выше, но начальная буква -
.Dq a ,
если файл добавлен в архив, или
.Dq r ,
если файл заменяет файл, уже находящийся в архиве.
При использовании с параметром
.Fl p
имя файла, заключенное в символы
.Dq <
и
.Dq > ,
записывается в стандартный вывод, предваренное одним символом новой строки
и за которым следуют два символа новой строки.
Содержимое именованного файла следует за именем файла.
При использовании с параметром
.Fl t ,
.Nm
отображает восемь полей, разделенных пробелами:
права доступа к файлу, как отображаемые
.Xr strmode 3 ,
десятичные идентификаторы пользователя и группы, разделенные косой чертой (
.Dq / Ns ) ,
размер файла в байтах, время модификации файла в формате
.Xr strftime 3
и имя файла.
.It Fl V
Вывести идентификатор версии и завершить работу.
.It Fl x
Извлечь членов архива, указанных аргументами
.Ar ,
в текущий каталог.
Если члены не были указаны, извлекаются все члены архива.
Если файл, соответствующий извлекаемому члену, не существует, он
будет создан.
Если файл, соответствующий извлекаемому члену, существует, его владелец
и группа не будут изменены, в то время как его содержимое будет перезаписано,
а его права доступа будут установлены в соответствии с архивом.
Время доступа и модификации файла будет соответствовать времени
извлечения, если не указан параметр
.Fl o .
.It Fl z
Этот параметр принимается для совместимости с версией
.Nm
в
.Tn FreeBSD ,
но игнорируется.
.El
Если указан параметр
.Fl M ,
утилита
.Nm
будет читать и выполнять команды со стандартного ввода.
Если стандартный ввод является терминалом, утилита
.Nm
будет отображать приглашение
перед чтением строки и продолжит работу даже при возникновении ошибок.
Если стандартный ввод не является терминалом, утилита
.Nm
не будет отображать приглашение и завершит выполнение при
возникновении ошибки.
.Pp
Каждая строка ввода содержит одну команду.
Слова в строке ввода разделяются пробельными символами.
Первое слово строки - команда, остальные слова -
аргументы команды.
Слово команды может быть указано в любом регистре.
Аргументы могут быть разделены запятыми или пробелами.
.Pp
Пустые строки разрешены и игнорируются.
Длинные строки продолжаются путем их завершения символом
.Dq Li + .
.Pp
Символы
.Dq Li *
и
начинают комментарий.
Комментарии продолжаются до конца строки.
.Pp
При выполнении скрипта библиотекаря MRI утилита
.Nm
работает с временной копией архива.
Изменения в копии становятся постоянными с помощью команды
.Ic save .
.Pp
Команды, понимаемые утилитой
.Nm :
.Bl -tag -width indent
.It Ic addlib Ar архив | Ic addlib Ar архив Pq Ar член Oo Li , Ar член Oc Ns ...
Добавить содержимое архива, указанного аргументом
.Ar архив ,
в текущий архив.
Если конкретные члены указаны с помощью аргументов
.Ar член ,
то эти члены добавляются в текущий архив.
Если члены не указаны, все содержимое архива
добавляется в текущий архив.
.It Ic addmod Ar член Oo Li , Ar член Oc Ns ...
Добавить файлы, указанные аргументами
.Ar член ,
в текущий архив.
.It Ic clear
Отбросить все содержимое текущего архива.
.It Ic create Ar архив
Создать новый архив с именем, указанным аргументом
.Ar архив ,
и сделать его текущим архивом.
Если именованный архив уже существует, он будет перезаписан
при выполнении команды
.Ic save .
.It Ic delete Ar модуль Oo Li , Ar член Oc Ns ...
Удалить модули, указанные аргументами
.Ar член ,
из текущего архива.
.It Ic directory Ar архив Po Ar член Oo Li , Ar член Oc Ns ... Pc Op Ar выходнойфайл
Вывести список каждого именованного модуля в архиве.
Формат вывода зависит от настройки подробности, установленной с помощью
команды
.Ic verbose .
Вывод отправляется в стандартный вывод или в файл, указанный аргументом
.Ar выходнойфайл .
.It Ic end
Успешно выйти из утилиты
.Nm .
Любые несохраненные изменения в текущем архиве будут отброшены.
.It Ic extract Ar член Oo Li , Ar член Oc Ns ...
Извлечь членов, указанных аргументами
.Ar член ,
из текущего архива.
.It Ic list
Отобразить содержимое текущего архива в подробном стиле.
.It Ic open Ar архив
Открыть архив с именем, указанным аргументом
.Ar архив ,
и сделать его текущим архивом.
.It Ic replace Ar член Oo Li , Ar член Oc Ns ...
Заменить именованных членов в текущем архиве файлами, указанными
аргументами
.Ar член .
Файлы должны присутствовать в текущем каталоге, а именованные
модули уже должны существовать в текущем архиве.
.It Ic save
Сохранить все изменения в текущем архиве.
.It Ic verbose
Переключить подробность вывода команды
.Ic directory .
.El
.Sh ПРИМЕРЫ
Чтобы создать новый архив
.Pa ex.a ,
содержащий три файла
.Pa ex1.o ,
.Pa ex2.o
и
.Pa ex3.o ,
используйте:
.Pp
Чтобы добавить таблицу символов архива в существующий архив
.Pa ex.a ,
используйте:
.Pp
Чтобы удалить файл
.Pa ex1.o
из архива
.Pa ex.a ,
используйте:
.Pp
Чтобы подробно вывести содержимое архива
.Pa ex.a ,
используйте:
.Pp
Чтобы создать новый архив
.Pa ex.a ,
содержащий файлы
.Pa ex1.o
и
.Pa ex2.o ,
используя команды библиотекаря MRI, используйте следующий скрипт:
.Bd -literal -offset indent
create ex.a		 * указать выходной архив
addmod ex1.o ex2.o	 * добавить модули
save			 * сохранить ожидающие изменения
end			 * выйти из утилиты
.Ed
.Sh ДИАГНОСТИКА
.Ex -std
.Sh СМ. ТАКЖЕ
.Xr ld 1 ,
.Xr ranlib 1 ,
.Xr archive 3 ,
.Xr elf 3 ,
.Xr strftime 3 ,
.Xr strmode 3 ,
.Xr ar 5
.Sh СОВМЕСТИМОСТЬ СО СТАНДАРТАМИ
Поддержка утилитой
.Nm
параметров
.Fl a ,
.Fl b ,
.Fl c ,
.Fl i ,
.Fl m ,
.Fl p ,
.Fl q ,
.Fl r ,
.Fl s ,
.Fl t ,
.Fl u ,
.Fl v ,
.Fl C
и
.Fl T
соответствует
.St -p1003.2 .
.Sh ИСТОРИЯ
Команда
.Nm
впервые появилась в AT&T UNIX Version 1.
В
.Fx 8.0 ,
.An Кай Ван Aq Mt kaiw@FreeBSD.org
переработал
.Nm
с использованием
.Lb libarchive
и
.Lb libelf .
