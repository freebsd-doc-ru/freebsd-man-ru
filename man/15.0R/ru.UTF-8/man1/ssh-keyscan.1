.\"	$OpenBSD: ssh-keyscan.1,v 1.52 2024/06/17 08:30:29 djm Exp $
.\"
.\" Copyright 1995, 1996 by David Mazieres <dm@lcs.mit.edu>.
.\"
.\" Modification and redistribution in source and binary forms is
.\" permitted provided that due credit is given to the author and the
.\" OpenBSD project by leaving this copyright notice intact.
.\"
.\" FRDP path ./crypto/openssh/ssh-keyscan.1
.\" FRDP githash 0fdf8fae8b569bf9fff3b5171e669dcd7cf9c79e
.\" FRDP hash256 971142d8a06dc83f334a76f42bc50ba3d488976e238de3ff67f0f679e98744fe
.Dd $Mdocdate: June 17 2024 $
.Dt SSH-KEYSCAN 1
.Os
.Sh ИМЯ
.Nm ssh-keyscan
.Nd сбор открытых SSH-ключей с серверов
.Sh СИНТАКСИС
.Nm ssh-keyscan
.Op Fl 46cDHqv
.Op Fl f Ar файл
.Op Fl O Ar опция
.Op Fl p Ar порт
.Op Fl T Ar таймаут
.Op Fl t Ar тип
.Op Ar узел | список_адресов список_имён
.Sh ОПИСАНИЕ
.Nm
— это утилита для сбора открытых SSH-ключей узлов ряда
хостов.
Она была разработана для помощи в построении и проверке
файлов
.Pa ssh_known_hosts ,
формат которых документирован в
.Xr sshd 8 .
.Nm
предоставляет минимальный интерфейс, подходящий для использования в shell- и perl-скриптах.
.Pp
.Nm
использует неблокирующий ввод-вывод через сокеты для связи с максимально возможным количеством хостов
параллельно, поэтому она очень эффективна.
Ключи из домена, содержащего 1000
хостов, могут быть собраны за десятки секунд, даже если некоторые из этих
хостов недоступны или на них не запущен
.Xr sshd 8 .
Для сканирования не требуется
доступ для входа на сканируемые машины, и сам процесс
сканирования не включает какое-либо шифрование.
.Pp
Хосты для сканирования могут быть указаны по имени узла, адресу или диапазону сети в формате CIDR
(например, 192.168.16/28).
Если указан диапазон сети, то будут
просканированы все адреса в этом диапазоне.
.Pp
Параметры следующие:
.Bl -tag -width Ds
.It Fl 4
Принудительное использование
.Nm
только адресов IPv4.
.It Fl 6
Принудительное использование
.Nm
только адресов IPv6.
.It Fl c
Запрашивать сертификаты у целевых хостов вместо обычных ключей.
.It Fl D
Выводить найденные ключи в виде DNS-записей SSHFP.
По умолчанию ключи выводятся в формате, пригодном для использования в файле
.Xr ssh 1
.Pa known_hosts .
.It Fl f Ar файл
Читать хосты или пары
.Dq список_адресов список_имён
из
.Ar файла ,
по одной строке на запись.
Если вместо имени файла указано
.Sq - ,
то
.Nm
будет читать со стандартного ввода.
Имена, прочитанные из файла, должны начинаться с адреса, имени хоста или диапазона сети CIDR,
который нужно сканировать.
Адреса и имена хостов могут дополнительно сопровождаться разделёнными запятыми псевдонимами имён
или адресов, которые будут скопированы в вывод.
Например:
.Bd -literal
192.168.11.0/24
10.20.1.1
happy.example.org
10.0.0.1,sad.example.org
.Ed
.It Fl H
Хешировать все имена хостов и адреса в выводе.
Хешированные имена могут нормально использоваться
.Xr ssh 1
и
.Xr sshd 8 ,
но они не раскрывают идентифицирующую информацию, если содержимое файла
будет скомпрометировано.
.It Fl O Ar опция
Указать опцию в формате ключ/значение.
В настоящее время поддерживается только одна опция:
.Bl -tag -width Ds
.It Cm hashalg Ns = Ns Ar алгоритм
Выбирает алгоритм хеширования для использования при выводе записей SSHFP с помощью флага
.Fl D .
Допустимые алгоритмы:
.Dq sha1
и
.Dq sha256 .
По умолчанию выводятся оба.
.El
.It Fl p Ar порт
Подключаться к
.Ar порту
на удалённом хосте.
.It Fl q
Тихий режим:
не выводить имя сервера и баннеры в комментариях.
.It Fl T Ar таймаут
Установить таймаут для попыток соединения.
Если с момента инициации соединения с хостом или с момента последнего
чтения данных с этого хоста прошло
.Ar таймаут
секунд, соединение закрывается, и рассматриваемый хост считается недоступным.
По умолчанию — 5 секунд.
.It Fl t Ar тип
Указать тип ключа для получения от сканируемых хостов.
Возможные значения:
.Dq ecdsa ,
.Dq ed25519 ,
.Dq ecdsa-sk ,
.Dq ed25519-sk ,
или
.Dq rsa .
Несколько значений могут быть указаны через запятую.
По умолчанию извлекаются все перечисленные типы ключей.
.It Fl v
Подробный режим:
выводить отладочные сообщения о ходе выполнения.
.El
.Pp
Если файл ssh_known_hosts создан с использованием
.Nm
без проверки ключей, пользователи будут уязвимы к
.Em атакам типа "человек посередине" .
С другой стороны, если модель безопасности допускает такой риск,
.Nm
может помочь в обнаружении подделанных файлов ключей или атак "человек посередине",
которые начались после создания файла ssh_known_hosts.
.Sh ФАЙЛЫ
.Pa /etc/ssh/ssh_known_hosts
.Sh ПРИМЕРЫ
Вывести RSA-ключ узла для машины
.Ar имя_узла :
.Pp
.Dl $ ssh-keyscan -t rsa имя_узла
.Pp
Поиск в диапазоне сети с выводом всех поддерживаемых типов ключей:
.Pp
.Dl $ ssh-keyscan 192.168.0.64/25
.Pp
Найти все хосты из файла
.Pa ssh_hosts ,
которые имеют новые или отличающиеся ключи по сравнению с отсортированным файлом
.Pa ssh_known_hosts :
.Bd -literal -offset indent
$ ssh-keyscan -t rsa,ecdsa,ed25519 -f ssh_hosts | \e
	sort -u - ssh_known_hosts | diff ssh_known_hosts -
.Ed
.Sh СМ. ТАКЖЕ
.Xr ssh 1 ,
.Xr sshd 8
.Rs
.%D 2006
.%R RFC 4255
.%T Использование DNS для безопасной публикации отпечатков ключей Secure Shell (SSH)
.Re
.Sh АВТОРЫ
.An -nosplit
.An David Mazieres Aq Mt dm@lcs.mit.edu
написал первоначальную версию, а
.An Wayne Davison Aq Mt wayned@users.sourceforge.net
добавил поддержку протокола версии 2.
