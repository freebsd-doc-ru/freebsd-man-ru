.\"
.\" SPDX-License-Identifier: BSD-2-Clause
.\"
.\" Copyright (c) 2003-2007 Tim Kientzle
.\" All rights reserved.
.\"
.\" FRDP path ./contrib/libarchive/cpio/bsdcpio.1
.\" FRDP githash bd66c1b43e33540205dbc1187c2f2a15c58b57ba
.\" FRDP hash256 2ae64cddd025d4b9346df380e710f09e3f5a38519333bb0a24b208ceb2c59bbe
.Dd 16 сентября 2014
.Dt CPIO 1
.Os
.Sh ИМЯ
.Nm cpio
.Nd копирование файлов в архивы и из архивов
.Sh СИНТАКСИС
.Nm
.Fl i
.Op Ar опции
.Op Ar шаблон ...
.Op Ar < архив
.Nm
.Fl o
.Op Ar опции
.Ar < список-имен
.Op Ar > архив
.Nm
.Fl p
.Op Ar опции
.Ar целевой-каталог
.Ar < список-имен
.Sh ОПИСАНИЕ
.Nm
копирует файлы между архивами и каталогами.
Данная реализация может извлекать из образов tar, pax, cpio, zip, jar, ar,
и компакт-дисков ISO 9660, а также создавать архивы tar, pax, cpio, ar,
и shar.
.Pp
Первая опция для
.Nm
является индикатором режима из следующего списка:
.Bl -tag -compact -width indent
.It Fl i
Ввод.
Читает архив из стандартного ввода (если не указано иное) и извлекает
содержимое на диск или (если указана опция
.Fl t )
выводит список содержимого в стандартный вывод.
Если указан один или несколько шаблонов файлов, будут извлечены только файлы,
соответствующие одному из шаблонов.
.It Fl o
Вывод.
Читает список имён файлов из стандартного ввода и создаёт новый архив
в стандартном выводе (если не указано иное), содержащий указанные элементы.
.It Fl p
Сквозная передача.
Читает список имён файлов из стандартного ввода и копирует файлы в
указанный каталог.
.El
.Sh ОПЦИИ
Если не указано иное, опции применяются во всех режимах работы.
.Bl -tag -width indent
.It Fl 0 , Fl Fl null
Читать имена файлов, разделённые символами NUL, вместо символов новой строки.
Это необходимо, если какие-либо читаемые имена файлов могут содержать символы новой строки.
.It Fl 6 , Fl Fl pwb
При чтении архива в двоичном формате предполагать, что это более ранний формат
из варианта PWB 6-го издания UNIX.
При записи архива cpio использовать формат PWB.
.It Fl 7 , Fl Fl binary
(только режим o)
При записи архива cpio использовать (более новый, не-PWB) двоичный формат.
.It Fl A
(только режим o)
Дописать к указанному архиву.
(Ещё не реализовано.)
.It Fl a
(режимы o и p)
Сбрасывать время доступа к файлам после их чтения.
.It Fl B
(только режим o)
Блочный вывод записями по 5120 байт.
.It Fl C Ar размер
(только режим o)
Блочный вывод записями по
.Ar размер
байт.
.It Fl c
(только режим o)
Использовать старый переносимый символьный формат POSIX.
Эквивалентно
.Fl Fl format Ar odc .
.It Fl d , Fl Fl make-directories
(режимы i и p)
Создавать каталоги по мере необходимости.
.It Fl E Ar файл
(только режим i)
Прочитать список шаблонов имён файлов из
.Ar файла
для перечисления и извлечения.
.It Fl F Ar файл , Fl Fl file Ar файл
Читать архив из или записывать архив в
.Ar файл .
.It Fl f Ar шаблон
(только режим i)
Игнорировать файлы, соответствующие
.Ar шаблону .
.It Fl H Ar формат , Fl Fl format Ar формат
(только режим o)
Создавать выходной архив в указанном формате.
Поддерживаемые форматы включают:
.Pp
.It Ar cpio
Синоним для
.Ar odc .
.It Ar newc
Переносимый формат cpio SVR4.
.It Ar odc
Старый ориентированный на октеты переносимый формат cpio POSIX.1.
.It Ar pax
Формат pax POSIX.1, расширение формата ustar.
.It Ar ustar
Формат tar POSIX.1.
.El
.Pp
Формат по умолчанию —
.Ar odc .
См.
.Xr libarchive-formats 5
для получения более полной информации о
форматах, в настоящее время поддерживаемых базовой
библиотекой
.Xr libarchive 3 .
.It Fl h , Fl Fl help
Вывести информацию об использовании.
.It Fl I Ar файл
Читать архив из
.Ar файла .
.It Fl i , Fl Fl extract
Режим ввода.
Описание см. выше.
.It Fl Fl insecure
(только режимы i и p)
Отключить проверки безопасности во время извлечения или копирования.
Это позволяет извлекать через символические ссылки, абсолютные пути
и имена путей, содержащие
.Sq ..
в имени.
.It Fl J , Fl Fl xz
(только режим o)
Сжимать файл с использованием совместимого с xz сжатия перед записью.
В режиме ввода эта опция игнорируется; сжатие xz распознаётся
автоматически при вводе.
.It Fl j
Синоним для
.Fl y .
.It Fl L
(режимы o и p)
Все символические ссылки будут отслеживаться.
Обычно символические ссылки архивируются и копируются как символические ссылки.
С этой опцией вместо ссылки будет архивироваться или копироваться её цель.
.It Fl l , Fl Fl link
(только режим p)
Создавать ссылки из целевого каталога на исходные файлы
вместо копирования.
.It Fl Fl lrzip
(только режим o)
Сжимать результирующий архив с помощью
.Xr lrzip 1 .
В режиме ввода эта опция игнорируется.
.It Fl Fl lz4
(только режим o)
Сжимать архив с помощью совместимого с lz4 сжатия перед записью.
В режиме ввода эта опция игнорируется; сжатие lz4 распознаётся
автоматически при вводе.
.It Fl Fl zstd
(только режим o)
Сжимать архив с помощью совместимого с zstd сжатия перед записью.
В режиме ввода эта опция игнорируется; сжатие zstd распознаётся
автоматически при вводе.
.It Fl Fl lzma
(только режим o)
Сжимать файл с помощью совместимого с lzma сжатия перед записью.
В режиме ввода эта опция игнорируется; сжатие lzma распознаётся
автоматически при вводе.
.It Fl Fl lzop
(только режим o)
Сжимать результирующий архив с помощью
.Xr lzop 1 .
В режиме ввода эта опция игнорируется.
.It Fl Fl passphrase Ar парольная-фраза
.Pa Парольная фраза
используется для извлечения или создания зашифрованного архива.
В настоящее время zip — единственный формат, который
.Nm
может обрабатывать как зашифрованные архивы.
Вам не следует использовать эту опцию, если вы не осознаёте,
насколько небезопасно её использование.
.It Fl m , Fl Fl preserve-modification-time
(режимы i и p)
Устанавливать время модификации файлов при создании в соответствии
со временем в источнике.
.It Fl n , Fl Fl numeric-uid-gid
(режим i, только с
.Fl t )
Отображать числовые uid и gid.
По умолчанию,
.Nm
отображает имена пользователей и групп, когда они предоставлены в
архиве, или ищет имена пользователей и групп в системной
базе данных паролей.
.It Fl Fl no-preserve-owner
(только режим i)
Не пытаться восстановить владельца файла.
Это поведение по умолчанию при запуске непривилегированными пользователями.
.It Fl O Ar файл
Записывать архив в
.Ar файл .
.It Fl o , Fl Fl create
Режим вывода.
Описание см. выше.
.It Fl p , Fl Fl pass-through
Режим сквозной передачи.
Описание см. выше.
.It Fl Fl preserve-owner
(только режим i)
Восстанавливать владельца файла.
Это поведение по умолчанию при запуске суперпользователем.
.It Fl Fl quiet
Подавлять ненужные сообщения.
.It Fl R Oo пользователь Oc Ns Oo : Oc Ns Oo группа Oc , Fl Fl owner Oo пользователь Oc Ns Oo : Oc Ns Oo группа Oc
Установить владельца и/или группу для файлов в выводе.
Если группа указана без пользователя
(например,
.Fl R Ar :wheel ),
то будет установлена только группа, но не пользователь.
Если пользователь указан с завершающим двоеточием и без группы
(например,
.Fl R Ar root: ),
то группа будет установлена в группу по умолчанию пользователя.
Если пользователь указан без завершающего двоеточия, то
будет установлен пользователь, но не группа.
В режимах
.Fl i
и
.Fl p
эта опция может использоваться только суперпользователем.
(Для совместимости точка может использоваться вместо двоеточия.)
.It Fl r
(Все режимы.)
Переименовывать файлы в интерактивном режиме.
Для каждого файла приглашение выводится в
.Pa /dev/tty ,
содержащее имя файла, и строка читается из
.Pa /dev/tty .
Если прочитанная строка пуста, файл пропускается.
Если строка содержит одну точку, файл обрабатывается как обычно.
В противном случае строка принимается за новое имя файла.
.It Fl t , Fl Fl list
(только режим i)
Вывести содержимое архива в стандартный вывод;
не восстанавливать содержимое на диск.
.It Fl u , Fl Fl unconditional
(режимы i и p)
Безусловно перезаписывать существующие файлы.
Обычно более старый файл не перезаписывает более новый файл на диске.
.It Fl V , Fl Fl dot
Выводить точку в stderr для каждого обрабатываемого файла.
Заменена опцией
.Fl v .
.It Fl v , Fl Fl verbose
Выводить имя каждого файла в stderr по мере его обработки.
С опцией
.Fl t
предоставляет подробный список для каждого файла.
.It Fl Fl version
Вывести информацию о версии программы и завершить работу.
.It Fl y
(только режим o)
Сжимать архив с помощью совместимого с bzip2 сжатия перед записью.
В режиме ввода эта опция игнорируется;
сжатие bzip2 распознаётся автоматически при вводе.
.It Fl Z
(только режим o)
Сжимать архив с помощью совместимого с compress сжатия перед записью.
В режиме ввода эта опция игнорируется;
сжатие распознаётся автоматически при вводе.
.It Fl z
(только режим o)
Сжимать архив с помощью совместимого с gzip сжатия перед записью.
В режиме ввода эта опция игнорируется;
сжатие gzip распознаётся автоматически при вводе.
.El
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh ОКРУЖЕНИЕ
На выполнение
.Nm
влияют следующие переменные окружения:
.It Ev LANG
Используемая локаль.
См.
.Xr environ 7
для получения дополнительной информации.
.It Ev TZ
Часовой пояс, используемый при отображении дат.
См.
.Xr environ 7
для получения дополнительной информации.
.El
.Sh ПРИМЕРЫ
Команда
.Nm
традиционно используется для копирования иерархий файлов в сочетании
с командой
.Xr find 1 .
Первый пример здесь просто копирует все файлы из
.Pa src
в
.Pa dest :
.Dl Nm find Pa src | Nm Fl pmud Pa dest
.Pp
Путем тщательного выбора опций команды
.Xr find 1
и её объединения с другими стандартными утилитами
можно осуществлять очень точный контроль над тем, какие файлы копируются.
Следующий пример копирует файлы из
.Pa src
в
.Pa dest ,
которые старше 2 дней и имена которых соответствуют определённому шаблону:
.Dl Nm find Pa src Fl mtime Ar +2 | Nm grep foo[bar] | Nm Fl pdmu Pa dest
.Pp
Этот пример копирует файлы из
.Pa src
в
.Pa dest ,
которые старше 2 дней и содержат слово
.Dq foobar :
.Dl Nm find Pa src Fl mtime Ar +2 | Nm xargs Nm grep -l foobar | Nm Fl pdmu Pa dest
.Sh СОВМЕСТИМОСТЬ
Опции режимов i, o и p, а также опции
a, B, c, d, f, l, m, r, t, u и v соответствуют SUSv2.
.Pp
Старый стандарт POSIX.1 указывал, что только
.Fl i ,
.Fl o ,
и
.Fl p
интерпретировались как параметры командной строки.
Каждый принимал один аргумент — список модифицирующих
символов.
Например, стандартный синтаксис допускает
.Fl imu ,
но не поддерживает
.Fl miu
или
.Fl i Fl m Fl u ,
поскольку
.Ar m
и
.Ar u
являются только модификаторами для
.Fl i ,
а не самостоятельными параметрами командной строки.
Синтаксис, поддерживаемый этой реализацией, обратно совместим
со стандартом.
Для наилучшей совместимости скриптам следует ограничиваться
стандартным синтаксисом.
.Sh СМ. ТАКЖЕ
.Xr bzip2 1 ,
.Xr gzip 1 ,
.Xr mt 1 ,
.Xr pax 1 ,
.Xr tar 1 ,
.Xr libarchive 3 ,
.Xr cpio 5 ,
.Xr libarchive-formats 5 ,
.Xr tar 5
.Sh СТАНДАРТЫ
В настоящее время не существует стандарта POSIX для команды cpio; она появилась
в
.St -p1003.1-96 ,
но была исключена из
.St -p1003.1-2001 .
.Pp
Форматы обмена файлами cpio, ustar и pax определены в
.St -p1003.1-2001
для команды pax.
.Sh ИСТОРИЯ
Исходные утилиты
.Nm cpio
и
.Nm find
были написаны Диком Хайтом
во время работы в группе поддержки Unix AT&T.
Впервые они появились в 1977 году в PWB/UNIX 1.0,
системе
.Dq Programmer's Work Bench ,
разработанной для использования внутри AT&T.
Впервые они были выпущены за пределами AT&T как часть System III Unix в 1981 году.
В результате
.Nm cpio
фактически предшествует
.Nm tar ,
хотя он не был хорошо известен за пределами AT&T до некоторого времени спустя.
.Pp
Это полная повторная реализация, основанная на
библиотеке
.Xr libarchive 3 .
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Формат архива cpio имеет несколько фундаментальных ограничений:
Он не хранит имена пользователей и групп, только числа.
В результате его нельзя надёжно использовать для передачи
файлов между системами с различной нумерацией пользователей и групп.
Старые форматы cpio ограничивают номера пользователей и групп
16 или 18 битами, что недостаточно для современных систем.
Форматы архивов cpio не могут поддерживать файлы размером более 4 гигабайт,
за исключением варианта
.Dq odc ,
который может поддерживать файлы до 8 гигабайт.
