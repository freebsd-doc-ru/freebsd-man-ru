.\"
.\" Copyright (c) 2004-2005
.\"	Hartmut Brandt.
.\"	All rights reserved.
.\" Copyright (c) 2001-2003
.\"	Fraunhofer Institute for Open Communication Systems (FhG Fokus).
.\"	All rights reserved.
.\"
.\" Author: Harti Brandt <harti@FreeBSD.org>
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" $Begemot: bsnmp/snmpd/bsnmpd.1,v 1.12 2006/02/27 09:50:03 brandt_h Exp $
.\"
.\" FRDP path ./contrib/bsnmp/snmpd/bsnmpd.1
.\" FRDP githash 9ea0bf43e58287466ad183fe758a01498ede4259
.\" FRDP hash256 86702ff3b05ca0a835bc5420c96d547ce30b19c738f3d03befd2e2dea3f753c1
.Dd 14 мая 2016
.Dt BSNMPD 1
.Os
.Sh ИМЯ
.Nm bsnmpd
.Sh СИНТАКСИС
.Nm
.Op Fl dh
.Op Fl c Ar файл
.Op Fl D Ar опции
.Op Fl e Ar файл
.Op Fl I Ar пути
.Op Fl l Ar префикс
.Op Fl m Ar переменная Ns Op = Ns Ar значение
.Op Fl p Ar файл
.Sh ОПИСАНИЕ
Демон
.Nm
обслуживает интернет-протокол SNMP (Simple Network Management Protocol).
Он предназначен для обслуживания только абсолютно базовых MIB, а все остальные
MIB реализуются через загружаемые модули.
Таким образом,
.Nm
можно использовать неожиданными способами.
.Pp
Параметры следующие:
.It Fl d
Не становиться демоном.
Используется для отладки.
.It Fl h
Вывести краткое сообщение об использовании.
.It Fl c Ar файл
Использовать
.Ar файл
в качестве файла конфигурации вместо стандартного.
.It Fl D Ar опции
Опции отладки указываются с помощью флага
.Fl D ,
за которым следует строка опций, разделённых запятыми.
Доступны следующие опции.
.It Cm dump
Выводить все отправленные и полученные PDU на терминал.
.It Cm events
Установить уровень отладки библиотеки событий (см.
.Xr eventlib 3 )
равным 10.
.It Cm trace Ns Cm = Ns Cm уровень
Установить флаг трассировки библиотеки snmp в указанное
значение.
.El
Значение можно указать в обычном синтаксисе C для чисел.
.It Fl e Ar файл
Указать альтернативный файл, в котором сохраняются идентификатор движка агента и количество загрузок.
.It Fl I Ar пути
Указать список каталогов, разделённых двоеточием, для поиска включаемых файлов конфигурации.
По умолчанию:
.Pa /etc:/usr/etc/:/usr/local/etc .
Эти пути ищутся только для включений, указанных в угловых скобках <>.
.It Fl l Ar префикс
Использовать
.Ar префикс
в качестве базового имени по умолчанию для pid-файла и файлов конфигурации.
.It Fl m Ar переменная Ns Op = Ns Ar значение
Определить переменную конфигурации.
.It Fl p Ar файл
Указать альтернативный pid-файл вместо используемого по умолчанию.
.El
.Sh КОНФИГУРАЦИЯ
.Nm
читает свою конфигурацию из файла конфигурации по умолчанию или указанного пользователем.
Файл конфигурации состоит из следующих типов строк:
.Bl -bullet -offset indent
.It
присваивания переменных
.It
разделители секций
.It
директивы включения
.It
присваивания переменных MIB
.El
.Pp
Если строка слишком длинная, её можно продолжить на следующей строке, завершив обратной косой чертой.
Пустые строки и строки, в которых первый непробельный символ является знаком
.Dq # ,
игнорируются.
.Pp
Все присваивания переменных MIB всей конфигурации (включая вложенные
файлы конфигурации) обрабатываются как одна транзакция, т.е. как если бы они поступили
в одном PDU SET.
Любой сбой во время первоначального чтения конфигурации приводит к завершению работы
.Nm .
Сбой при чтении конфигурации, вызванный загрузкой модуля,
приводит к неудачной загрузке модуля.
.Pp
Конфигурация читается во время инициализации
.Nm ,
при загрузке модуля и когда
.Nm
получает сигнал SIGHUP.
.Ss ПРИСВАИВАНИЕ ПЕРЕМЕННЫХ
Присваивание переменных может принимать одну из двух форм:
.Bd -unfilled -offset indent
переменная := строка
переменная ?= строка
.Ed
.Pp
Строка начинается с первого непробельного символа после знака равенства
и продолжается до первого символа новой строки или
.Dq # .
В первом случае
строка присваивается переменной безусловно, во втором случае
переменной присваивается значение только если она ещё не существует.
.Pp
Имена переменных должны начинаться с буквы или подчёркивания и содержать только буквы,
цифры или подчёркивания.
.Ss РАЗДЕЛИТЕЛИ СЕКЦИЙ
Конфигурация состоит из именованных секций.
Присваивания переменных MIB в секции с именем
.Dq snmpd
выполняются только во время начальной настройки или когда
.Nm
получает сигнал SIGHUP.
Все остальные секции выполняются, когда либо модуль
с тем же именем, что и секция, загружается, либо
.Nm
получает сигнал SIGHUP и этот модуль уже загружен.
Секция по умолчанию в начале конфигурации —
.Dq snmpd .
Переключиться на другую секцию можно с помощью синтаксиса
.Bd -unfilled -offset indent
%имясекции
.Ed
.Pp
Где
.Ar имясекции
— это имя секции.
Одно и то же
.Ar имясекции
может использоваться в нескольких местах конфигурации.
Все эти части собираются в одну секцию.
.Ss ДИРЕКТИВЫ ВКЛЮЧЕНИЯ
Другой файл конфигурации может быть включён в текущий с помощью
директивы включения, которая принимает одну из двух форм:
.Bd -unfilled -offset indent
.Ed
.Pp
Первая форма заставляет искать файл в текущем каталоге,
вторая форма заставляет искать файл в каталогах, указанных в
системном пути включения.
Глубина вложенности ограничена только доступной памятью.
.Ss ПРИСВАИВАНИЯ ПЕРЕМЕННЫХ MIB
Переменной MIB присваивается значение с помощью синтаксиса
.Bd -unfilled -offset indent
oid [ под-oid ] = значение
.Ed
.Pp
.Va oid
— это имя устанавливаемой переменной.
Здесь используется только последний компонент полного имени.
Если переменная является скаляром, индекс (.0) автоматически
добавляется и его не нужно указывать.
Если переменная является столбцом таблицы, индекс
.Pq Va под-oid
должен быть указан.
Индекс состоит из элементов, каждый из которых отделён от
предыдущего точкой.
Элементами могут быть числа, строки или имена хостов,
заключённые в квадратные скобки [].
Если элемент является числом, он добавляется
к текущему oid.
Если элемент является строкой, её длина и
.Tn ASCII
код каждого её символа добавляются к текущему oid.
Если
элемент является именем хоста, ищется IP-адрес хоста, и четыре
элемента IP-адреса добавляются к oid.
.Pp
Например, oid вида
.Bd -unfilled -offset indent
.Ed
.Pp
приводит к oid
.Bd -unfilled -offset indent
myvariable.27.102.111.111.111.108.108.127.0.0.1.38.94.33
.Ed
.Pp
Значение присваивания может быть пустым, строкой или числом.
Если строка начинается с буквы или подчёркивания и состоит только из
букв, цифр, подчёркиваний и знаков минус, её можно записывать без
кавычек.
Во всех остальных случаях строка должна быть заключена в двойные кавычки.
.Sh ПОДСТАНОВКИ
Подстановка переменной записывается как
.Bd -unfilled -offset indent
$(переменная)
.Ed
.Pp
где
.Ar переменная
— это имя подставляемой переменной.
Использование неопределённой переменной считается ошибкой.
.Sh ФАЙЛЫ
.It Pa /etc/ Ns Ao Ar префикс Ac Ns \&.config
Файл конфигурации по умолчанию, где
.Aq префикс
по умолчанию —
.Dq snmpd .
.It Pa /var/ Ns Ao Ar префикс Ac Ns \&.engine
Файл идентификатора движка по умолчанию.
.It Pa /var/run/ Ns Ao Ar префикс Ac Ns \&.pid
Pid-файл по умолчанию.
.It Pa /etc:/usr/etc/:/usr/local/etc
Путь поиска системных включаемых файлов по умолчанию.
.It Pa @MIBSPATH@FOKUS-MIB.txt
.It Pa @MIBSPATH@BEGEMOT-MIB.txt
.It Pa @MIBSPATH@BEGEMOT-SNMPD.txt
Определения для MIB, реализованных в демоне.
.It Pa /etc/hosts.allow, /etc/hosts.deny
Здесь определяются элементы управления доступом, которые должны применяться TCP-обёртками.
Подробнее описано в
.Xr hosts_access 5 .
.El
.Sh СМ. ТАКЖЕ
.Xr gensnmptree 1 ,
.Xr hosts_access 5
.Sh СТАНДАРТЫ
.Nm
соответствует применимым RFC IETF.
.Sh АВТОРЫ
.An Хартмут Брандт Aq harti@FreeBSD.org
.Sh ИЗВЕСТНЫЕ ОШИБКИ
Конечно.
