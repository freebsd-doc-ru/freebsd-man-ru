.\" $Id: apropos.1,v 1.51 2020/10/01 22:50:00 schwarze Exp $
.\"
.\" Copyright (c) 2011, 2012 Kristaps Dzonsons <kristaps@bsd.lv>
.\" Copyright (c) 2011,2012,2014,2017,2018 Ingo Schwarze <schwarze@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.\" FRDP path ./contrib/mandoc/apropos.1
.\" FRDP githash 6d38604fc532a3fc060788e3ce40464b46047eaf
.\" FRDP hash256 6926a0cfcc6f3f82fdfc235a9f37fdea698f3122cafe1d7316973c5a28eb39d8
.Dd $Mdocdate: 1 октября 2020 $
.Dt APROPOS 1
.Os
.Sh ИМЯ
.Nm apropos ,
.Nm whatis
.Nd поиск в базах данных руководств
.Sh СИНТАКСИС
.Nm
.Op Fl afk
.Op Fl C Ar файл
.Op Fl M Ar путь
.Op Fl m Ar путь
.Op Fl O Ar ключ_вывода
.Op Fl S Ar архитектура
.Op Fl s Ar раздел
.Ar выражение ...
.Sh ОПИСАНИЕ
Утилиты
.Nm apropos
и
.Nm whatis
запрашивают базы данных руководств, созданные
.Xr makewhatis 8 ,
вычисляя
.Ar выражение
для каждого файла в каждой базе данных.
По умолчанию они отображают имена, номера разделов и строки описаний
всех подходящих руководств.
.Pp
По умолчанию
.Nm
ищет базы данных
.Xr makewhatis 8
в путях по умолчанию, установленных
.Xr man 1 ,
и использует регистронезависимое сравнение расширенных регулярных выражений
по именам и описаниям руководств
.Pq ключи макросов Li \&Nm No и Li \&Nd .
Несколько терминов подразумевают попарный
.Fl o .
.Pp
.Nm whatis
является синонимом для
.Nm
.Fl f .
.Pp
Параметры следующие:
.Bl -tag -width Ds
.It Fl a
Вместо показа только строк заголовков показывать полные страницы руководств,
как это делает
.Xr man 1
.Fl a .
Если стандартный вывод является терминальным устройством и
.Fl c
не указан, использовать
.Xr less 1
для постраничного вывода.
В режиме
.Fl a
также доступны параметры
.Fl IKOTW ,
описанные в руководстве
.Xr mandoc 1 .
.It Fl C Ar файл
Указать альтернативный конфигурационный
.Ar файл
в формате
.Xr man.conf 5 .
.It Fl f
Искать все слова из
.Ar выражения
только в именах страниц руководств.
Поиск регистронезависимый и соответствует только целым словам.
В этом режиме ключи макросов, операторы сравнения и логические операторы
недоступны.
.It Fl k
Поддерживать полный синтаксис
.Ar выражения .
Является значением по умолчанию для
.Nm .
.It Fl M Ar путь
Использовать разделённый двоеточиями путь вместо списка путей по умолчанию
для поиска баз данных
.Xr makewhatis 8 .
Недопустимые пути или пути без баз данных руководств игнорируются.
.It Fl m Ar путь
Добавить разделённые двоеточиями пути в начало списка путей для поиска
баз данных
.Xr makewhatis 8 .
Недопустимые пути или пути без баз данных руководств игнорируются.
.It Fl O Ar ключ_вывода
Показывать значения, связанные с ключом
.Ar ключ_вывода ,
вместо описаний руководств.
.It Fl S Ar архитектура
Ограничить поиск страницами для указанной архитектуры
.Xr machine 1 .
.Ar архитектура
регистронезависима.
По умолчанию показываются страницы для всех архитектур.
.It Fl s Ar раздел
Ограничить поиск указанным разделом руководства.
По умолчанию показываются страницы из всех разделов.
См.
.Xr man 1
для перечисления разделов.
.El
.Pp
Параметры
.Fl chlw
также поддерживаются и описаны в
.Xr man 1 .
Параметры
.Fl fkl
взаимоисключающие и переопределяют друг друга.
.Pp
.Ar Выражение
состоит из поисковых терминов, соединённых логическими операторами
.Fl a
.Pq И
и
.Fl o
.Pq ИЛИ .
Оператор
.Fl a
имеет приоритет над
.Fl o ,
и оба вычисляются слева направо.
.Bl -tag -width Ds
.It \&( Ar выражение No \&)
Истинно, если подвыражение
.Ar выражение
истинно.
.It Ar выражение1 Fl a Ar выражение2
Истинно, если оба
.Ar выражение1
и
.Ar выражение2
истинны (логическое
.Sq И ) .
.It Ar выражение1 Oo Fl o Oc Ar выражение2
Истинно, если
.Ar выражение1
и/или
.Ar выражение2
истинны (логическое
.Sq ИЛИ ) .
.It Ar термин
Истинно, если
.Ar термин
удовлетворён.
Имеет синтаксис
.Sm off
.Oo
.Op Ar ключ Op , Ar ключ ...
.Pq Cm = | \(ti
.Oc
.Ar значение ,
.Sm on
где
.Ar ключ
— макрос
.Xr mdoc 7
для запроса, а
.Ar значение
— его значение.
См.
.Sx Ключи макросов
для списка доступных ключей.
Оператор
.Cm =
оценивает подстроку, а
.Cm \(ti
оценивает регистрозависимое расширенное регулярное выражение.
.It Fl i Ar термин
Если
.Ar термин
является регулярным выражением, оно
оценивается регистронезависимо.
Не влияет на термины-подстроки.
.El
.Pp
Результаты сортируются сначала по номеру раздела в порядке возрастания,
затем по имени страницы в порядке возрастания
.Xr ascii 7
алфавитного порядка, регистронезависимо.
.Pp
Каждая строка вывода форматируется как
.Pp
.D1 имя[, имя...](раздел) \- описание
.Pp
Где
.Dq имя
— название руководства,
.Dq раздел
— раздел руководства, а
.Dq описание
— краткое описание руководства.
Если для руководства указана архитектура, она отображается как
.Pp
.D1 имя(раздел/архитектура) \- описание
.Pp
Полученные руководства могут быть открыты с помощью
.Pp
.Dl $ man \-s раздел имя
.Pp
Если в выводе указана архитектура, используйте
.Pp
.Dl $ man \-s раздел \-S архитектура имя
.Ss Ключи макросов
Запросы оцениваются по подмножеству макросов
.Xr mdoc 7 ,
индексированных
.Xr makewhatis 8 .
В дополнение к перечисленным ниже ключам макросов, специальный ключ
.Cm любой
может использоваться для соответствия любому доступному ключу макроса.
.Pp
Имена и описание:
.It Li \&Nm Ta имя руководства
.It Li \&Nd Ta однострочное описание руководства
.It Li архитектура Ta архитектура машины (регистронезависимо)
.It Li раздел  Ta номер раздела руководства
.El
.Pp
Разделы и перекрёстные ссылки:
.It Li \&Sh Ta заголовок раздела (исключая стандартные разделы)
.It Li \&Ss Ta заголовок подраздела
.It Li \&Xr Ta перекрёстная ссылка на другую страницу руководства
.It Li \&Rs Ta библиографическая ссылка
.El
.Pp
Семантическая разметка для утилит командной строки:
.It Li \&Fl Ta параметры командной строки (флаги)
.It Li \&Cm Ta модификатор команды
.It Li \&Ar Ta аргумент команды
.It Li \&Ic Ta внутренняя или интерактивная команда
.It Li \&Ev Ta переменная окружения
.It Li \&Pa Ta путь файловой системы
.El
.Pp
Семантическая разметка для библиотек функций:
.It Li \&Lb Ta имя библиотеки функций
.It Li \&In Ta включаемый файл
.It Li \&Ft Ta тип возвращаемого значения функции
.It Li \&Fn Ta имя функции
.It Li \&Fa Ta тип и имя аргумента функции
.It Li \&Vt Ta тип переменной
.It Li \&Va Ta имя переменной
.It Li \&Dv Ta определённая переменная или препроцессорная константа
.It Li \&Er Ta константа ошибки
.It Li \&Ev Ta переменная окружения
.El
.Pp
Различная семантическая разметка:
.It Li \&An Ta имя автора
.It Li \&Lk Ta гиперссылка
.It Li \&Mt Ta Do mailto Dc гиперссылка
.It Li \&Cd Ta объявление конфигурации ядра
.It Li \&Ms Ta математический символ
.It Li \&Tn Ta торговая марка
.El
.Pp
Физическая разметка:
.It Li \&Em Ta курсив или подчёркивание
.It Li \&Sy Ta полужирный шрифт
.It Li \&Li Ta моноширинный шрифт
.El
.Pp
Текстовое оформление:
.It Li \&St Ta ссылка на стандартный документ
.It Li \&At Ta At No ссылка на версию
.It Li \&Bx Ta Bx No ссылка на версию
.It Li \&Bsx Ta Bsx No ссылка на версию
.It Li \&Nx Ta Nx No ссылка на версию
.It Li \&Fx Ta Fx No ссылка на версию
.It Li \&Ox Ta Ox No ссылка на версию
.It Li \&Dx Ta Dx No ссылка на версию
.El
.Pp
В общем случае, ключи макросов предназначены для предоставления полных результатов без
ожидания, что пользователь будет учитывать фактическое использование макросов.
Например, результаты включают:
.Pp
.Bl -tag -width 3n -offset 3n -compact
.It Li \&Fa
аргументы функций, появляющиеся в строках
.Ic \&Fn
.It Li \&Fn
имена функций, размеченные с помощью макросов
.Ic \&Fo
.It Li \&In
имена включаемых файлов, размеченные с помощью макросов
.Ic \&Fd
.It Li \&Vt
типы, появляющиеся как типы возвращаемых значений функций, и
.It \&
типы, появляющиеся в аргументах функций в СИНТАКСИСЕ
.El
.Sh ОКРУЖЕНИЕ
.Bl -tag -width MANPAGER
.It Ev MANPAGER
Любое непустое значение переменной окружения
.Ev MANPAGER
используется вместо стандартной программы постраничного вывода
.Xr less 1 ;
подробности см. в
.Xr man 1 .
Используется только если указан
.Fl a
или
.Fl l .
.It Ev MANPATH
Разделённый двоеточиями список каталогов для поиска страниц руководств; подробности см. в
.Xr man 1 .
Переопределяется параметром
.Fl M ,
игнорируется, если указан
.Fl l .
.It Ev PAGER
Задаёт программу постраничного вывода для использования, когда
.Ev MANPAGER
не определена.
Если ни PAGER, ни MANPAGER не определены, используется
.Xr less 1 .
Используется только если указан
.Fl a
или
.Fl l .
.El
.Sh ФАЙЛЫ
.It Pa mandoc.db
имя базы данных ключевых слов
.Xr makewhatis 8
.It Pa /etc/man.conf
конфигурационный файл
.Xr man 1
по умолчанию
.El
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh ПРИМЕРЫ
Поиск
.Qq .cf
как подстроки в именах и описаниях руководств:
.Pp
.Dl $ apropos =.cf
.Pp
Включить также соответствия для
.Qq .cnf
и
.Qq .conf :
.Pp
.Dl $ apropos =.cf =.cnf =.conf
.Pp
Поиск в именах и описаниях с использованием регистрозависимого регулярного выражения:
.Pp
.Dl $ apropos \(aq\(tiset.?[ug]id\(aq
.Pp
Поиск всех страниц руководств в заданном разделе:
.Pp
.Dl $ apropos \-s 9 \&.
.Pp
Поиск руководств в разделе библиотек, упоминающих как переменную
.Qq optind ,
так и переменную
.Qq optarg :
.Pp
.Dl $ apropos \-s 3 Va=optind \-a Va=optarg
.Pp
Сделать точно то же, что и вызов
.Nm whatis
с аргументом
.Qq ssh :
.Pp
.Dl $ apropos \-\- \-i \(aqNm\(ti[[:<:]]ssh[[:>:]]\(aq
.Pp
Следующие два вызова эквивалентны:
.Pp
.D1 Li $ apropos -S Ar архитектура Li -s Ar раздел выражение
.Bd -ragged -offset indent
.Li $ apropos \e( Ar выражение Li \e)
.Li -a архитектура\(ti^( Ns Ar архитектура Ns Li |любой)$
.Li -a раздел\(ti^ Ns Ar раздел Ns Li $
.Ed
.Sh СМ. ТАКЖЕ
.Xr man 1 ,
.Xr re_format 7 ,
.Xr makewhatis 8
.Sh СТАНДАРТЫ
Утилита
.Nm
соответствует спецификации
.St -p1003.1-2008
для
.Xr man 1
.Fl k .
.Pp
Все параметры, команда
.Nm whatis ,
поддержка логических операторов, ключи макросов,
поиск подстрок, сортировка результатов, переменные окружения
.Ev MANPAGER
и
.Ev MANPATH ,
формат базы данных и конфигурационный файл
являются расширениями этой спецификации.
.Sh ИСТОРИЯ
Часть функциональности
.Nm whatis
уже предоставлялась утилитой
.Nm manwhere
в
.Bx 1 .
Утилиты
.Nm
и
.Nm whatis
впервые появились в
.Bx 2 .
Они были полностью переписаны для
.Ox 5.6 .
.Pp
Параметр
.Fl M
и переменная
.Ev MANPATH
впервые появились в
.Bx 4.3 ;
.Fl m
в
.Bx 4.3 Reno ;
.Fl C
в
.Bx 4.4 Lite1 ;
а
.Fl S
и
.Fl s
в
.Ox 4.5
для
.Nm
и в
.Ox 5.6
для
.Nm whatis .
Параметры
.Fl acfhIKklOTWw
появились в
.Ox 5.7 .
.Sh АВТОРЫ
.An -nosplit
.An Билл Джой
написал
.Nm manwhere
в 1977 году и оригинальные версии
.Bx
.Nm
и
.Nm whatis
в феврале 1979 года.
Текущая версия была написана
.An Кристапсом Дзонсонсом Aq Mt kristaps@bsd.lv
и
.An Инго Шварце Aq Mt schwarze@openbsd.org .
